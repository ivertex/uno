/*! Uno - v0.3.0 - 2016-03-20
* Copyright (c) 2016 Ruslan Murashko; Licensed  */
!function(){if(window){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}}(),function(){"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var a=Array.prototype.slice;return function(b){function c(){var f=e.concat(a.call(arguments));d.apply(this instanceof c?this:b,f)}var d=this,e=a.call(arguments,1);if("function"!=typeof d)throw new TypeError;return c.prototype=function f(a){return a&&(f.prototype=a),this instanceof f?void 0:new f}(d.prototype),c}}())}(),function(){var a=this,b=b||{};b.time=function(){return window&&window.perfomance?window.perfomance.now():Date.now()},b.log=function(a){var c=Array.prototype.slice.call(arguments);if(b.Browser.any&&window.console){var d=b.Browser;d.firefox||d.safari&&d.version>7||d.chrome&&d.version>24?console.log("%cUno: "+c.join(" "),"color: blue"):console.log("Uno: "+c.join(" "))}return!0},b.warn=function(a){var c=Array.prototype.slice.call(arguments);if(b.Browser.any&&window.console){var d=b.Browser;d.firefox||d.safari&&d.version>7||d.chrome&&d.version>24?console.warn("%cUno: "+c.join(" "),"color: orange"):console.warn("Uno: "+c.join(" "))}return!1},b.error=function(a){var c=Array.prototype.slice.call(arguments);return b.Browser.any&&window.console&&console.error("Uno: "+c.join(" ")),!1},b.Utils={},b.Math={RAD_TO_DEG:180/Math.PI,DEG_TO_RAD:Math.PI/180,PI:Math.PI,TWO_PI:2*Math.PI,HALF_PI:.5*Math.PI},b.Math.isPOT=function(a){return 0===(a&a-1)},b.Math.nextPOT=function(a){if(a>0&&0===(a&a-1))return a;for(var b=1;a>b;)b<<=1;return b},b.Arc=function(a,b,c,d,e,f){this.x=0,this.y=0,this.radius=0,this.startAngle=0,this.endAngle=0,this.antiClockwise=!1,void 0!==a&&this.set(a,b,c,d,e,f)},b.Arc.prototype.clone=function(){return new b.Arc(this)},b.Arc.prototype.set=function(a,c,d,e,f,g){return void 0!==a&&void 0!==a.x?(this.x=a.x,this.y=a.y,this.radius=a.radius,this.startAngle=a.startAngle,this.endAngle=a.endAngle,this.antiClockwise=a.antiClockwise,this):(this.x=a||0,this.y=c||0,this.radius=d||0,this.startAngle=e||0,this.endAngle=f||b.Math.TWO_PI,this.antiClockwise=g||!1,this)},b.Arc.prototype.equal=function(a){return a&&this.x===a.x&&this.y===a.y&&this.radius===a.radius&&this.startAngle===a.startAngle&&this.endAngle===a.endAngle&&this.antiClockwise===a.antiClockwise},b.Arc.prototype.contains=function(a,b){return this.radius<=0?!1:void 0!==a.x?(this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y)<=this.radius*this.radius:(this.x-a)*(this.x-a)+(this.y-b)*(this.y-b)<=this.radius*this.radius},b.Circle=function(a,b,c){this.x=0,this.y=0,this.radius=0,void 0!==a&&this.set(a,b,c)},b.Circle.prototype.clone=function(){return new b.Circle(this)},b.Circle.prototype.set=function(a,b,c){return void 0!==a&&void 0!==a.x?(this.x=a.x,this.y=a.y,this.radius=a.radius,this):(this.x=a||0,this.y=b||0,this.radius=c||0,this)},b.Circle.prototype.equal=function(a){return a&&this.x===a.x&&this.y===a.y&&this.radius===a.radius},b.Circle.prototype.contains=function(a,b){return this.radius<=0?!1:void 0!==a.x?(this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y)<=this.radius*this.radius:(this.x-a)*(this.x-a)+(this.y-b)*(this.y-b)<=this.radius*this.radius},b.Ellipse=function(a,b,c,d){this.x=0,this.y=0,this.width=0,this.height=0,void 0!==a&&this.set(a,b,c,d)},b.Ellipse.prototype.clone=function(){return new b.Ellipse(this)},b.Ellipse.prototype.set=function(a,b,c,d){if(void 0!==a){if(void 0!==a.width)return this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this;if(void 0!==a.x)return this.x=a.x,this.y=a.y,this.width=b.x,this.height=b.y,this}return this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0,this},b.Ellipse.prototype.equal=function(a){return a&&void 0!==a.radius?this.x===a.x&&this.y===a.y&&this.width===a.radius&&this.height===a.radius:a&&this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height},b.Ellipse.prototype.contains=function(a,b){return this.width<=0||this.height<=0?!1:void 0!==a.x?(a.x-this.x)/this.width*((a.x-this.x)/this.width)+(a.y-this.y)/this.height*((a.y-this.y)/this.height)<=1:(a-this.x)/this.width*((a-this.x)/this.width)+(b-this.y)/this.height*((b-this.y)/this.height)<=1},b.Line=function(a,b,c,d){this.x1=0,this.y1=0,this.x2=0,this.y2=0,void 0!==a&&this.set(a,b,c,d)},b.Line.prototype.clone=function(){return new b.Line(this.x1,this.y1,this.x2,this.y2)},b.Line.prototype.set=function(a,b,c,d){return void 0!==a&&void 0!==a.x1?(this.x1=a.x1,this.y1=a.y1,this.x2=a.x2,this.y2=a.y2,this):void 0!==a&&void 0!==a.x?(this.x1=a.x,this.y1=a.y,this.x2=b.x,this.y2=b.y,this):(this.x1=a||0,this.y1=b||0,this.x2=c||0,this.y2=d||0,this)},b.Line.prototype.equal=function(a){return a&&this.x1===a.x1&&this.y1===a.y1&&this.x2===a.x2&&this.y2===a.y2},b.Line.prototype.contains=function(a,b){return void 0!==a.x?a.x>=Math.min(this.x1,this.x2)&&a.x<=Math.max(this.x1,this.x2)&&a.y>=Math.min(this.y1,this.y2)&&a.y<=Math.max(this.y1,this.y2)&&(a.x-this.x1)*(this.y2-this.y1)===(this.x2-this.x1)*(a.y-this.y1):a>=Math.min(this.x1,this.x2)&&a<=Math.max(this.x1,this.x2)&&b>=Math.min(this.y1,this.y2)&&b<=Math.max(this.y1,this.y2)&&(a-this.x1)*(this.y2-this.y1)===(this.x2-this.x1)*(b-this.y1)},b.Matrix=function(a,b,c,d,e,f){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this._rotation=0,this._sin=0,this._cos=1,void 0!==a&&this.set(a,b,c,d,e,f)},b.Matrix.prototype.clone=function(){return new b.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)},b.Matrix.prototype.set=function(a,b,c,d,e,f){return void 0!==a&&void 0!==a.a?(this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.tx=a.tx,this.ty=a.ty,this):(this.a=a||1,this.b=b||0,this.c=c||0,this.d=d||1,this.tx=e||0,this.ty=f||0,this)},b.Matrix.prototype.reset=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},b.Matrix.prototype.equal=function(a){return a&&this.a===a.a&&this.b===a.b&&this.c===a.c&&this.d===a.d&&this.tx===a.tx&&this.ty===a.ty},b.Matrix.prototype.identity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.tx&&0===this.ty},b.Matrix.prototype.array=function(a){var b=this._array;return b||(b=this._array=new Float32Array(9)),a?(b[0]=this.a,b[1]=this.b,b[2]=0,b[3]=this.c,b[4]=this.d,b[5]=0,b[6]=this.tx,b[7]=this.ty,b[8]=1):(b[0]=this.a,b[1]=this.b,b[2]=this.tx,b[3]=this.c,b[4]=this.d,b[5]=this.ty,b[6]=0,b[7]=0,b[8]=1),b},b.Matrix.prototype.transform=function(a,c,d,e,f){this._rotation!==d&&(this._sin=Math.sin(d),this._cos=Math.cos(d),this._rotation=d),f=f||b.Matrix.IDENTITY;var g=this._cos*c.x,h=-this._sin*c.y,i=this._sin*c.x,j=this._cos*c.y,k=a.x-g*e.x-e.y*h,l=a.y-j*e.y-e.x*i,m=f.a,n=f.b,o=f.c,p=f.d;return this.a=m*g+n*i,this.b=m*h+n*j,this.tx=m*k+n*l+f.tx,this.c=o*g+p*i,this.d=o*h+p*j,this.ty=o*k+p*l+f.ty,this},b.Matrix.prototype.apply=function(a){var b=this.a*a.x+this.b*a.y+this.tx;return a.y=this.c*a.x+this.d*a.y+this.ty,a.x=b,this},b.Matrix.prototype.applyInverse=function(a){var b=1/(this.a*this.d+this.c*-this.b),c=this.d*b*a.x+-this.c*b*a.y+(this.ty*this.c-this.tx*this.d)*b;return a.y=this.a*b*a.y+-this.b*b*c+(-this.ty*this.a+this.tx*this.b)*b,a.x=c,this},b.Matrix.prototype.translate=function(a,b){return void 0!==a.x?(this.tx+=a.x,this.ty+=a.y,this):(this.tx+=a,this.ty+=b||a,this)},b.Matrix.prototype.scale=function(a,b){return this.a*=a,this.d*=b||a,this.c*=a,this.b*=b||a,this.tx*=a,this.ty*=b||a,this},b.Matrix.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.a,e=this.c,f=this.tx;return this.a=d*b-this.b*c,this.b=d*c+this.b*b,this.c=e*b-this.d*c,this.d=e*c+this.d*b,this.tx=f*b-this.ty*c,this.ty=f*c+this.ty*b,this},b.Matrix.prototype.append=function(a){var b=this.a,c=this.b,d=this.c,e=this.d;return this.a=a.a*b+a.b*d,this.b=a.a*c+a.b*e,this.c=a.c*b+a.d*d,this.d=a.c*c+a.d*e,this.tx=a.tx*b+a.ty*d+this.tx,this.ty=a.tx*c+a.ty*e+this.ty,this},b.Matrix.prototype.prepend=function(a){var b=this.tx;if(1!==a.a||0!==a.b||0!==a.c||1!==a.d){var c=this.a,d=this.c;this.a=c*a.a+this.b*a.c,this.b=c*a.b+this.b*a.d,this.c=d*a.a+this.d*a.c,this.d=d*a.b+this.d*a.d}return this.tx=b*a.a+this.ty*a.c+a.tx,this.ty=b*a.b+this.ty*a.d+a.ty,this},b.Matrix.prototype.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=a*d-b*c;return this.a=d/f,this.b=-b/f,this.c=-c/f,this.d=a/f,this.tx=(c*this.ty-d*e)/f,this.ty=-(a*this.ty-b*e)/f,this},b.Matrix.concat=function(a,b,c){var d=a.a,e=a.b,f=a.c,g=a.d,h=a.tx,i=a.ty,j=b.a,k=b.b,l=b.c,m=b.d,n=b.tx,o=b.ty;c.a=j*d+k*f,c.b=j*e+k*g,c.tx=j*h+k*i+n,c.c=l*d+m*f,c.d=l*e+m*g,c.ty=l*h+m*i+o},b.Matrix.IDENTITY=new b.Matrix,b.Point=function(a,b){this.x=0,this.y=0,void 0!==a&&this.set(a,b)},b.Point.prototype.clone=function(){return new b.Point(this)},b.Point.prototype.set=function(a,b){return void 0===a?(this.x=this.y=0,this):void 0!==a.x?(this.x=a.x,this.y=a.y,this):(this.x=a||0,this.y=void 0===b?this.x:b,this)},b.Point.prototype.add=function(a,b){return void 0===a?this:void 0!==a.x?(this.x+=a.x,this.y+=a.y,this):(this.x+=a,this.y+=void 0===b?a:b,this)},b.Point.prototype.subtract=function(a,b){return void 0===a?this:void 0!==a.x?(this.x-=a.x,this.y-=a.y,this):(this.x-=a,this.y-=void 0===b?a:b,this)},b.Point.prototype.multiply=function(a,b){return void 0===a?(this.x=this.y=0,this):void 0!==a.x?(this.x*=a.x,this.y*=a.y,this):(this.x*=a,this.y*=void 0===b?a:b,this)},b.Point.prototype.divide=function(a,b){return void 0===a?this:void 0!==a.x?(this.x/=a.x,this.y/=a.y,this):(this.x/=a,this.y/=void 0===b?a:b,this)},b.Point.prototype.normalize=function(){if(this.zero())return this;var a=Math.sqrt(this.x*this.x+this.y*this.y);return this.x/=a,this.y/=a,this},b.Point.prototype.invert=function(){return this.x=-this.x,this.y=-this.y,this},b.Point.prototype.clamp=function(a,b){return this.x<a?this.x=a:this.x>b&&(this.x=b),this.y<a?this.y=a:this.y>b&&(this.y=b),this},b.Point.prototype.distance=function(a,b){return void 0===a?Math.sqrt(this.x*this.x+this.y*this.y):void 0!==a.x?Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y)):Math.sqrt((a-this.x)*(a-this.x)+(b-this.y)*(b-this.y))},b.Point.prototype.angle=function(a,b){return void 0===a?Math.atan2(-this.y,-this.x):void 0!==a.x?Math.atan2(a.y-this.y,a.x-this.x):Math.atan2(b-this.y,a-this.x)},b.Point.prototype.equal=function(a,b){return void 0===a||null===a?!1:void 0!==a.x?this.x===a.x&&this.y===a.y:this.x===a&&this.y===b},b.Point.prototype.zero=function(){return 0===this.x&&0===this.y},b.Poly=function(a){this.points=[],void 0!==a[0]||void 0!==a.points?this.set(a):this.set(Array.prototype.slice.call(arguments))},b.Poly.prototype.clone=function(){return new b.Poly(this.points)},b.Poly.prototype.set=function(a){if(void 0!==a.points)return this.points=a.slice(),this;if(a[0]||(a=Array.prototype.slice.call(arguments)),"number"==typeof a[0]){for(var c=[],d=0,e=a.length;e>d;d+=2)c.push(new b.Point(a[d],a[d+1]));this.points=c}else this.points=a.slice();return this},b.Poly.prototype.equal=function(a){if(!a)return!1;if(this.points.length!==a.points.length)return!1;for(var b=this.points,c=a.points,d=b.length;--d;)if(b[d].x!==c[d].x||b[d].y!==c[d].y)return!1;return!0},b.Poly.prototype.closed=function(){return this.points.length<3?!1:this.points[0].equal(this.points[this.points.length-1])},b.Poly.prototype.contains=function(a,b){var c=!1,d=this.points,e=a,f=b;void 0!==a.x&&(e=a.x,f=a.y);for(var g=0,h=this.points.length,i=h-1;h>g;i=++g){var j=d[g],k=d[i];j.y>f!=k.y>f&&e<(k.x-j.x)*(f-j.y)/(k.y-j.y)+j.x&&(c=!c)}return c},b.Rect=function(a,b,c,d){this.x=0,this.y=0,this.width=0,this.height=0,void 0!==a&&this.set(a,b,c,d)},b.Rect.prototype.clone=function(){return new b.Rect(this.x,this.y,this.width,this.height)},b.Rect.prototype.set=function(a,b,c,d){if(void 0!==a){if(void 0!==a.width)return this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this;if(void 0!==a.x)return this.x=a.x,this.y=a.y,this.width=b.x,this.height=b.y,this}return this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0,this},b.Rect.prototype.equal=function(a,b,c,d){return void 0===a||null===a?!1:void 0!==a.width?this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height:this.x===a&&this.y===b&&this.width===c&&this.height===d},b.Rect.prototype.contains=function(a,b){return this.width<=0||this.height<=0?!1:void 0!==a.x?this.x<=a.x&&this.y<=a.y&&this.x+this.width>=a.x&&this.y+this.height>=a.y:this.x<=a&&this.y<=b&&this.x+this.width>=a&&this.y+this.height>=b},b.Rect.prototype.clamp=function(a,b,c,d){return void 0!==a.width?(this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.x+this.width>a.x+a.width&&(this.width=a.x+a.width-this.x),void(this.y+this.height>a.y+a.height&&(this.height=a.y+a.height-this.y))):(this.x<a&&(this.x=a),this.y<b&&(this.y=b),this.x+this.width>a+c&&(this.width=a+c-this.x),void(this.y+this.height>b+d&&(this.height=b+d-this.y)))},b.Browser=function(){this.any=!1,this.version=0,this.mobile=!1,this.opera=!1,this.silk=!1,this.ie=!1,this.edge=!1,this.chrome=!1,this.safari=!1,this.android=!1,this.firefox=!1,this._initialize()},b.Browser.prototype._initialize=function(){if(navigator&&navigator.userAgent){var a,b=navigator.userAgent,c=[{name:"opera",exp:/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,version:3,mobile:!0},{name:"opera",exp:/\s(opr)\/((\d+)?[\w\.]+)/i,version:3,mobile:!1},{name:"opera",exp:/(opera).+version\/((\d+)?[\w\.]+)/i,version:3,mobile:!1},{name:"silk",exp:/(silk)\/((\d+)?[\w\.]+)/i,version:3,mobile:!0},{name:"ie",exp:/(iemobile)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,version:3,mobile:!0},{name:"ie",exp:/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,version:3,mobile:!1},{name:"ie",exp:/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i,version:3,mobile:!1},{name:"edge",exp:/(edge)\/((\d+)?[\w\.]+)/i,version:3,mobile:!1},{name:"chrome",exp:/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+))/i,version:3,mobile:!1},{name:"chrome",exp:/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i,version:3,mobile:!0},{name:"android",exp:/(android).+version\/((\d+)?[\w\.]+)/i,version:2,mobile:!0},{name:"safari",exp:/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i,version:2,mobile:!0},{name:"safari",exp:/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i,version:2,mobile:!1},{name:"firefox",exp:/(firefox)\/((\d+)?[\w\.-]+)/i,version:3,mobile:!1}];this.any=!0;for(var d=0,e=c.length;e>d;++d){var f=c[d];if(a=f.exp.exec(b))return this[f.name]=!0,this.version=parseInt(a[f.version]),void(this.mobile=f.mobile)}}else this.any=!1},b.Browser=new b.Browser,b.Capabilities=function(){this.canvas=!1,this.webgl=!1,this.opengl=!1,this._initialize()},b.Capabilities.prototype._checkCanvas=function(){try{var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}catch(b){return!1}},b.Capabilities.prototype._checkWebgl=function(){try{if(!window.WebGLRenderingContext)return!1;var a=document.createElement("canvas"),b=a.getContext("webgl")||a.getContext("experimental-webgl"),c=b.getParameter(b.VERSION);return parseFloat(/WebGL\s(\d+\.\d+)/i.exec(c)[1])}catch(d){return!1}},b.Capabilities.prototype._initialize=function(){window&&(this.canvas=this._checkCanvas(),this.webgl=this._checkWebgl())},b.Capabilities=new b.Capabilities,b.Os=function(){this.mobile=!1,this.name="",this.version="",this.windows=!1,this.linux=!1,this.android=!1,this.mac=!1,this.ios=!1,this.blackberry=!1,this.tizen=!1,this.sailfish=!1,this.firefox=!1,this.chromium=!1,this._initialize()},b.Os.prototype._initialize=function(){if(navigator&&navigator.userAgent)for(var a,b=navigator.userAgent,c=[{name:"windows",exp:/microsoft\s(windows)\s(vista|xp)/i,version:2,mobile:!1},{name:"windows",exp:/(windows)\snt\s([\w\s\.]+);/i,version:2,mobile:!1},{name:"windows",exp:/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i,version:2,mobile:!0},{name:"blackberry",exp:/\((bb)(10);/i,version:2,mobile:!0},{name:"blackberry",exp:/(blackberry)\w*\/?([\w\.]+)*/i,version:2,mobile:!0},{name:"tizen",exp:/(tizen)[\/\s]([\w\.]+)/i,version:2,mobile:!0},{name:"android",exp:/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,version:2,mobile:!0},{name:"sailfish",exp:/linux;.+(sailfish);/i,version:2,mobile:!1},{name:"firefox",exp:/mozilla.+\(mobile;.+gecko.+firefox/i,version:2,mobile:!1},{name:"chromium",exp:/(cros)\s[\w]+\s([\w\.]+\w)/i,version:2,mobile:!1},{name:"linux",exp:/(mint)[\/\s\(]?(\w+)*/i,version:2,mobile:!1},{name:"linux",exp:/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,version:2,mobile:!1},{name:"linux",exp:/(hurd|linux)\s?([\w\.]+)*/i,version:2,mobile:!1},{name:"linux",exp:/(gnu)\s?([\w\.]+)*/i,version:2,mobile:!1},{name:"linux",exp:/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i,version:2,mobile:!1},{name:"ios",exp:/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i,version:2,mobile:!0},{name:"mac",exp:/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,version:2,mobile:!1},{name:"mac",exp:/(macintosh|mac(?=_powerpc)\s)/i,version:!1,mobile:!1}],d=0,e=c.length;e>d;++d){var f=c[d];if(a=f.exp.exec(b))return this[f.name]=!0,this.name=a[1],f.version!==!1&&a[f.version]&&(this.version=a[f.version].replace(/_/g,".")),void(this.mobile=f.mobile)}},b.Os=new b.Os,b.Device=function(){this.pc=!1,this.mac=!1,this.iphone=!1,this.ipad=!1,this.appletv=!1,this.windowsphone=!1,this.blackberry=!1,this.kindle=!1,this.firephone=!1,this.ouya=!1,this.nintendo=!1,this.playstation=!1,this.xbox=!1,this._initialize()},b.Device.prototype._initialize=function(){if(navigator&&navigator.userAgent){for(var a,c=navigator.userAgent.toLowerCase(),d=[{name:"iphone",exp:/\((iphone);.+(apple)/i,mobile:!0},{name:"ipad",exp:/\((ipad);.+(apple)/i,mobile:!0},{name:"appletv",exp:/(apple\s{0,1}tv)/i,mobile:!0},{name:"windowsphone",exp:/(windows\sphone)/i,mobile:!0},{name:"blackberry",exp:/(blackberry)[\s-]?(\w+)/i,mobile:!0},{name:"blackberry",exp:/\(bb10;\s(\w+)/i,mobile:!0},{name:"kindle",exp:/(kindle)\/([\w\.]+)/i,mobile:!0},{name:"kindle",exp:/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i,mobile:!0},{name:"firephone",exp:/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i,mobile:!0},{name:"ouya",exp:/\s(ouya)\s/i,mobile:!1},{name:"nintendo",exp:/(nintendo)\s([wids3u]+)/i,mobile:!0},{name:"playstation",exp:/(playstation\s[3portablevi]+)/i,mobile:!1},{name:"xbox",exp:/[\s\(;](xbox(?:\sone)?)[\s\);]/i,mobile:!1}],e=!1,f=0,g=d.length;g>f;++f){var h=d[f];if(a=h.exp.exec(c)){this[h.name]=!0,this.mobile=h.mobile,e=!0;break}}e||(b.Os.mac?this.mac=!0:this.pc=!0)}},b.Device=new b.Device,b.Screen=function(){this.ratio=1,this.depth=0,this.width=0,this.height=0,this.totalWidth=0,this.totalHeight=0,this.scrollX=0,this.scrollY=0,this._initialize()},b.Screen.prototype._initialize=function(){var a=this;if(window&&(this.ratio=window.devicePixelRatio||1,window.screen&&(this.totalWidth=window.screen.width,this.totalHeight=window.screen.height,this.depth=window.screen.pixelDepth),document)){var c=function(){a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight,(b.Browser.chrome||b.Browser.safari||b.Browser.opera)&&(a.height-=4)},d=function(){a.scrollX=window.pageXOffset,a.scrollY=window.pageYOffset};window.addEventListener("resize",c,!0),window.addEventListener("scroll",d,!0),c(),d()}},b.Screen=new b.Screen,b.Color=function(a,b,c,d){this._r=1,this._g=1,this._b=1,this._a=1,this._dirty=!0,this._hex=0,this._cssHex="",this._cssRGBA="",this._packedABGR=0,this.set(a,b,c,d)},b.Color.prototype.set=function(a,b,c,d){return void 0!==a&&void 0===b?void 0!==a.r?(this._r=a.r,this._g=a.g,this._b=a.b,this._a=a.a,this._dirty=!0,this):(this.hex=a,this._dirty=!0,this):(this.r=void 0===a?1:a,this.g=void 0===b?1:b,this.b=void 0===c?1:c,this.a=void 0===d?1:d,this._dirty=!0,this)},b.Color.prototype.equal=function(a,b,c,d){return void 0===b?void 0!==a.r?this._r===a.r&&this._g===a.g&&this._b===a.b&&this._a===a.a:this.hex===a:this._r===a&&this._g===b&&this._b===c&&this._a===d},b.Color.prototype.clone=function(){return new b.Color(this)},b.Color.prototype.packABGR=function(a){return this._dirty&&(this._packedABGR=255*this._a<<24|255*this._b<<16|255*this._g<<8|255*this._r),void 0===a||1===a?this._packedABGR:16777215&this._packedABGR|this._a*a*255<<24},b.Color.prototype.quantize=function(a){return this._r=Math.round(this._r*a)/a,this._g=Math.round(this._g*a)/a,this._b=Math.round(this._b*a)/a,this._dirty=!0,this},Object.defineProperty(b.Color.prototype,"r",{get:function(){return this._r},set:function(a){void 0!==a&&this._r!==a&&(0>a&&(a=0),a>1&&(a=1),this._r=a,this._dirty=!0)}}),Object.defineProperty(b.Color.prototype,"g",{get:function(){return this._g},set:function(a){void 0!==a&&this._g!==a&&(0>a&&(a=0),a>1&&(a=1),this._g=a,this._dirty=!0)}}),Object.defineProperty(b.Color.prototype,"b",{get:function(){return this._b},set:function(a){void 0!==a&&this._b!==a&&(0>a&&(a=0),a>1&&(a=1),this._b=a,this._dirty=!0)}}),Object.defineProperty(b.Color.prototype,"a",{get:function(){return this._a},set:function(a){void 0!==a&&this._a!==a&&(0>a&&(a=0),a>1&&(a=1),this._a=a,this._dirty=!0)}}),Object.defineProperty(b.Color.prototype,"hex",{get:function(){return this._dirty&&(this._hex=(255*this._r<<16)+(255*this._g<<8)+255*this._b),this._hex},set:function(a){this.a=a>16777215?(a>>24&255)/255:1,this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,this._dirty=!0}}),Object.defineProperty(b.Color.prototype,"cssHex",{get:function(){return this._dirty&&(this._cssHex="#"+("00000"+(0|this.hex).toString(16)).substr(-6)),this._cssHex},set:function(a){this.hex=parseInt(a.substr(1),16)}}),Object.defineProperty(b.Color.prototype,"cssRGBA",{get:function(){return this._dirty&&(this._cssRGBA="rgba("+Math.floor(255*this._r)+","+Math.floor(255*this._g)+","+Math.floor(255*this._b)+","+this._a+")"),this._cssRGBA}}),b.Color.TRANSPARENT=new b.Color(0,0,0,0),b.Color.WHITE=new b.Color(1,1,1),b.Color.BLACK=new b.Color(0,0,0),b.Color.RED=new b.Color(1,0,0),b.Color.GREEN=new b.Color(0,1,0),b.Color.BLUE=new b.Color(0,0,1),b.Texture=function(a,c){return this.id=b.Texture._uid++,this.scale=b.Render.SCALE_LINEAR,this._width=0,this._height=0,this._ready=!1,this._url=null,this._extensions={},a&&c?b.Browser.any?(this._width=a,this._height=c,this._pot=b.Math.isPOT(a)&&b.Math.isPOT(c),void(this._ready=!0)):void b.error("Only browsers currently supported"):void 0},b.Texture._uid=0,b.Texture.prototype.load=function(a,c,d){return this.destroy(),b.Browser.any?(b.CanvasTexture.get(this).load(a,this._onLoad.bind(this,c),d),this):void b.error("Only browsers currently supported")},b.Texture.prototype.destroy=function(){for(var a in this._extensions)this._extensions[a].destroy();this.scale=b.Render.SCALE_LINEAR,this._pot=!1,this._ready=!1,this._url=null,this._extensions={}},Object.defineProperty(b.Texture.prototype,"width",{get:function(){return this._width}}),Object.defineProperty(b.Texture.prototype,"height",{get:function(){return this._height}}),Object.defineProperty(b.Texture.prototype,"ready",{get:function(){return this._ready}}),Object.defineProperty(b.Texture.prototype,"url",{get:function(){return this._url}}),Object.defineProperty(b.Texture.prototype,"pot",{get:function(){return this._pot}}),b.Texture.prototype._onLoad=function(a,c,d,e,f){return d?(this._width=e,this._height=f,this._pot=b.Math.isPOT(e)&&b.Math.isPOT(f),this._url=c,this._ready=!0,void(a&&a(this))):b.error("Can't load image","[",c,"]")},b.Texture.load=function(a,c,d){var e=new b.Texture;return e.load(a,c,d),e},b.Texture.create=function(a,c){return new b.Texture(a,c)},b.Shape=function(){this.items=[]},b.Shape.prototype.add=function(a,b,c,d,e,f,g,h){return this.items.push({transform:a.identity()?null:a.clone(),type:b,shape:c,fill:d?d.clone():null,stroke:e?e.clone():null,thickness:f,alpha:g,blend:h}),this},b.Shape.POINT=0,b.Shape.LINE=1,b.Shape.RECT=2,b.Shape.CIRCLE=3,b.Shape.ELLIPSE=4,b.Shape.ARC=5,b.Shape.POLY=6,b.Render=function(a){a=a||{};var c={},d=a.mode||!1;if(!b.Browser.any)throw new Error("Only browsers currently supported");var e=b.Render.DEFAULT;if(c.antialias=void 0===a.antialias?e.antialias:a.antialias,c.background=void 0===a.background?e.background:a.background,c.width=a.width||e.width||b.Screen.width,c.height=a.height||e.height||b.Screen.height,c.fps=0===a.fps?0:a.fps||e.fps,c.ups=0===a.ups?0:a.ups||e.ups,c.menu=void 0===a.menu?e.menu:a.menu,a.canvas)c.canvas=a.canvas;else{var f=document.createElement("canvas");a.container instanceof Object?a.container.appendChild(f):a.container instanceof String?document.getElementById(a.container).appendChild(f):document.body.appendChild(f),c.canvas=f}d?this._render=d===b.Render.RENDER_WEBGL?new b.WebglRender(c):new b.CanvasRender(c):this._render=b.Capabilities.webgl?new b.WebglRender(c):new b.CanvasRender(c)},Object.defineProperty(b.Render.prototype,"id",{get:function(){return this._render.id}}),Object.defineProperty(b.Render.prototype,"type",{get:function(){return this._render.type}}),Object.defineProperty(b.Render.prototype,"root",{get:function(){return this._render.root},set:function(a){this._render.root=a}}),Object.defineProperty(b.Render.prototype,"background",{get:function(){return this._render.background},set:function(a){this._render.background=a}}),Object.defineProperty(b.Render.prototype,"fps",{get:function(){return this._render.fps},set:function(a){this._render.fps=a}}),Object.defineProperty(b.Render.prototype,"ups",{get:function(){return this._render.ups},set:function(a){this._render.ups=a}}),Object.defineProperty(b.Render.prototype,"width",{get:function(){return this._render.width},set:function(a){this._render.width=a}}),Object.defineProperty(b.Render.prototype,"height",{get:function(){return this._render.height},set:function(a){this._render.height=a}}),Object.defineProperty(b.Render.prototype,"bounds",{get:function(){return this._render.bounds}}),Object.defineProperty(b.Render.prototype,"target",{get:function(){return this._render.target},set:function(a){this._render.target=a}}),Object.defineProperty(b.Render.prototype,"transform",{get:function(){return this._render.transform},set:function(a){this._render.transform=a}}),Object.defineProperty(b.Render.prototype,"alpha",{get:function(){return this._render.alpha},set:function(a){this._render.alpha=a}}),Object.defineProperty(b.Render.prototype,"blend",{get:function(){return this._render.blend},set:function(a){this._render.blend=a}}),Object.defineProperty(b.Render.prototype,"fill",{get:function(){return this._render.fill},set:function(a){this._render.fill=a}}),Object.defineProperty(b.Render.prototype,"stroke",{get:function(){return this._render.stroke},set:function(a){this._render.stroke=a}}),Object.defineProperty(b.Render.prototype,"thickness",{get:function(){return this._render.thickness},set:function(a){this._render.thickness=a}}),b.Render.prototype.resize=function(a,b){return this._render.resize(a,b),this},b.Render.prototype.destroy=function(){this._render.destroy()},b.Render.prototype.clear=function(a){return this._render.clear(a),this},b.Render.prototype.clip=function(a,b,c,d){return this._render.clip(a,b,c,d),this},b.Render.prototype.mask=function(a,b){return this._render.mask(a,b),this},b.Render.prototype.style=function(a,b,c){return this._render.style(a,b,c),this},b.Render.prototype.texture=function(a,b,c){return this._render.texture(a,b,c),this},b.Render.prototype.line=function(a,b,c,d){return this._render.line(a,b,c,d),this},b.Render.prototype.rect=function(a,b,c,d){return this._render.rect(a,b,c,d),this},b.Render.prototype.circle=function(a,b,c){return this._render.circle(a,b,c),this},b.Render.prototype.ellipse=function(a,b,c,d){return this._render.ellipse(a,b,c,d),this},b.Render.prototype.arc=function(a,b,c,d,e,f){return this._render.arc(a,b,c,d,e,f),this},b.Render.prototype.poly=function(a){return this._render.poly(a),this},b.Render.prototype.shape=function(a){return this._render.shape(a),this},b.Render.prototype.beginShape=function(){return this._render.beginShape()},b.Render.prototype.endShape=function(){return this._render.endShape()},b.Render.prototype.getPixels=function(a,b,c,d,e){return this._render.getPixels(a,b,c,d,e)},b.Render.prototype.setPixels=function(a,b,c,d,e,f){return this._render.setPixels(a,b,c,d,e,f),this},b.Render.RENDER_CANVAS=1,b.Render.RENDER_WEBGL=2,b.Render.SCALE_NEAREST=0,b.Render.SCALE_LINEAR=1,b.Render.BLEND_NORMAL=0,b.Render.BLEND_ADD=1,b.Render.BLEND_MULTIPLY=2,b.Render.BLEND_SCREEN=3,b.Render.DEFAULT={background:b.Color.WHITE.clone(),width:0,height:0,fps:60,ups:60,fill:b.Color.WHITE.clone(),stroke:b.Color.BLACK.clone(),thickness:1,canvas:null,container:null,menu:!1},b.Render.renders=[],b.Render._uid=0,b.CanvasGraphics=function(a){this._render=a,this._shape=null,this._shapeWorldTransform=new b.Matrix},b.CanvasGraphics.prototype.destroy=function(){this._render=null,this._shape=null},b.CanvasGraphics.prototype.beginShape=function(){return this._shape=new b.Shape,this._shape},b.CanvasGraphics.prototype.endShape=function(){var a=this._shape;return this._shape=null,a},b.CanvasGraphics.prototype.shape=function(a){var c,d,e,f=a.items,g=f.length,h=b.Shape,i=this._render,j=i._state;j.save();var k=j.alpha,l=this._shapeWorldTransform.set(j.transform),m=l.identity();if(!j.alpha)return!1;for(c=0;g>c;++c)switch(e=f[c],d=e.shape,m||!e.transform?j.transform.set(e.transform?e.transform:l):b.Matrix.concat(e.transform,l,j.transform),e.fill&&j.fill.set(e.fill),e.stroke&&j.stroke.set(e.stroke),j.thickness=e.thickness,j.alpha=e.alpha*k,j.blend=e.blend,j.sync(),e.type){case h.LINE:this.line(d.x1,d.y1,d.x2,d.y2);break;case h.RECT:this.rect(d.x,d.y,d.width,d.height);break;case h.CIRCLE:this.circle(d.x,d.y,d.radius);break;case h.ELLIPSE:this.ellipse(d.x,d.y,d.width,d.height);break;case h.ARC:this.arc(d.x,d.y,d.radius,d.startAngle,d.endAngle,d.antiClockwise);break;case h.POLY:this.poly(d.points)}return j.restore(),!0},b.CanvasGraphics.prototype.line=function(a,c,d,e){var f=this._render._state;if(!f.alpha||!f.stroke.a||!f.thickness)return!1;if(this._shape)return this._shape.add(f.transform,b.Shape.LINE,new b.Line(a,c,d,e),null,f.stroke,f.thickness,f.alpha,f.blend),!0;var g=this._render._context;return g.beginPath(),g.moveTo(a,c),g.lineTo(d,e),g.stroke(),!0},b.CanvasGraphics.prototype.rect=function(a,c,d,e){var f=this._render._state;if(!(f.alpha&&(f.fill.a||f.stroke.a&&f.thickness)))return!1;if(this._shape)return this._shape.add(f.transform,b.Shape.RECT,new b.Rect(a,c,d,e),f.fill,f.stroke,f.thickness,f.alpha,f.blend),!0;var g=this._render._context;return f.fill.a&&g.fillRect(a,c,d,e),f.thickness&&f.stroke.a&&g.strokeRect(a,c,d,e),!0},b.CanvasGraphics.prototype.circle=function(a,c,d){var e=this._render._state;if(!(e.alpha&&(e.fill.a||e.stroke.a&&e.thickness)))return!1;if(this._shape)return this._shape.add(e.transform,b.Shape.CIRCLE,new b.Circle(a,c,d),e.fill,e.stroke,e.thickness,e.alpha,e.blend),!0;var f=this._render._context;return f.beginPath(),f.arc(a,c,d,0,b.Math.TWO_PI,!1),e.fill.a&&f.fill(),e.thickness&&e.stroke.a&&f.stroke(),!0},b.CanvasGraphics.prototype.ellipse=function(a,c,d,e){var f=this._render._state;if(!(f.alpha&&(f.fill.a||f.stroke.a&&f.thickness)))return!1;if(this._shape)return this._shape.add(f.transform,b.Shape.ELLIPSE,new b.Ellipse(a,c,d,e),f.fill,f.stroke,f.thickness,f.alpha,f.blend),!0;var g=this._render._context,h=.5522848,i=.5*d,j=.5*e;a-=i,c-=j;var k=i*h,l=j*h,m=a+d,n=c+e,o=a+i,p=c+j;return g.beginPath(),g.moveTo(a,p),g.bezierCurveTo(a,p-l,o-k,c,o,c),g.bezierCurveTo(o+k,c,m,p-l,m,p),g.bezierCurveTo(m,p+l,o+k,n,o,n),g.bezierCurveTo(o-k,n,a,p+l,a,p),f.fill.a&&g.fill(),f.thickness&&f.stroke.a&&g.stroke(),!0},b.CanvasGraphics.prototype.arc=function(a,c,d,e,f,g){var h=this._render._state;if(!(h.alpha&&(h.fill.a||h.stroke.a&&h.thickness)))return!1;
if(this._shape)return this._shape.add(h.transform,b.Shape.ARC,new b.Arc(a,c,d,e,f,g),h.fill,h.stroke,h.thickness,h.alpha,h.blend),!0;var i=this._render._context;return i.beginPath(),i.arc(a,c,d,e,f,g),h.fill.a&&i.fill(),h.thickness&&h.stroke.a&&i.stroke(),!0},b.CanvasGraphics.prototype.poly=function(a){if(!a||a.length<2)return!1;var c=this._render._state;if(!(c.alpha&&(c.fill.a||c.stroke.a&&c.thickness)))return!1;if(this._shape)return this._shape.add(c.transform,b.Shape.POLY,new b.Poly(a),c.fill,c.stroke,c.thickness,c.alpha,c.blend),!0;var d,e=this._render._context;e.beginPath(),d=a[0],e.moveTo(d.x,d.y);for(var f=1,g=a.length;g>f;++f)d=a[f],e.lineTo(d.x,d.y);return a[0].equal(a[f-1])&&e.closePath(),c.fill.a&&e.fill(),c.thickness&&c.stroke.a&&e.stroke(),!0},b.CanvasTexture=function(a){this.texture=a,this._source=null,this._context=null,this._patternCache={},this._tintCache={},this._imageData=null},b.CanvasTexture.prototype.destroy=function(){b.CanvasTinter.removeCache(this),this.texture=null,this._source=null,this._context=null,this._patternCache={},this._imageData=null},b.CanvasTexture.prototype.context=function(){return this._context||(this._context=this.handle().getContext("2d")),this._context},b.CanvasTexture.prototype.handle=function(a){if(null===this._source&&this.texture.width&&this.texture.height){var c=document.createElement("canvas");if(c.width=this.texture.width,c.height=this.texture.height,this._source=c,b.WebglTexture.has(this.texture)){var d=b.WebglTexture.get(this.texture),e=d._renders[0],f=this.context();this._imageData=f.getImageData(0,0,c.width,c.height),this._imageData.data.set(e.getPixels(this.texture)),f.putImageData(this._imageData,0,0)}}return!a||a.equal(b.Color.WHITE)?this._source:b.CanvasTinter.tint(this,a)},b.CanvasTexture.prototype.pattern=function(a,b){var c=this.handle(b);return this._patternCache[c]||(this._patternCache[c]=a._context.createPattern(c,"repeat")),this._patternCache[c]},b.CanvasTexture.prototype.load=function(a,c,d){if(a===this._url)return this._source;if(b.CanvasTexture._cache[a])return this._source=b.CanvasTexture._cache[a],b.CanvasTinter.removeCache(this),this._patternCache={},void c(a,!0,this._source.width,this._source.height);var e=new Image,f=this;return e.addEventListener("load",function(){d!==!1&&(b.CanvasTexture._cache[a]=d),f._source=e,b.CanvasTinter.removeCache(f),f._patternCache={},c(a,!0,e.width,e.height)},!1,!1),e.addEventListener("error",function(){c(a,!1)},!1,!1),e.src=a,e},b.CanvasTexture.get=function(a){return a._extensions.canvas||(a._extensions.canvas=new b.CanvasTexture(a)),a._extensions.canvas},b.CanvasTexture.has=function(a){return!!a._extensions.canvas},b.CanvasTexture._cache={},b.CanvasTinter=function(){},b.CanvasTinter.CACHE_CLEAR=!0,b.CanvasTinter.CACHE_COUNT=32,b.CanvasTinter.CACHE_CHECK_TIMEOUT=5,b.CanvasTinter.CACHE_TTL=30,b.CanvasTinter._cacheTimer=0,b.CanvasTinter._cacheTextures=[],b.CanvasTinter.tint=function(a,c){if(c.equal(b.Color.WHITE))return a.texture._source;void 0===b.CanvasTinter._multiplyMode&&(b.CanvasTinter._multiplyMode=b.CanvasState.BLEND_EXTENDED),b.CanvasTinter._color?b.CanvasTinter._color.set(c):b.CanvasTinter._color=c.clone();var d=b.CanvasTinter._color;d.quantize(b.CanvasTinter.CACHE_COUNT);var e=a._tintCache[d.hex];if(e)return e.canvas;var f=a._source,g=document.createElement("canvas");return g.width=f.width,g.height=f.height,b.CanvasTinter._multiplyMode?b.CanvasTinter._tintMultiply(g.getContext("2d"),f,d):b.CanvasTinter._tintPixel(g.getContext("2d"),f,d),a._tintCache[d.hex]={canvas:g,stamp:b.time()},b.CanvasTinter.CACHE_CLEAR&&(-1===b.CanvasTinter._cacheTextures.indexOf(a)&&b.CanvasTinter._cacheTextures.push(a),b.CanvasTinter._cacheTimer||(b.CanvasTinter._cacheTimer=setInterval(b.CanvasTinter._checkCache,1e3*b.CanvasTinter.CACHE_CHECK_TIMEOUT))),g},b.CanvasTinter.removeCache=function(a){for(var c in a._tintCache)a._tintCache[c].canvas=null;a._tintCache={};var d=b.CanvasTinter._cacheTextures.indexOf(a);-1===d&&b.CanvasTinter._cacheTextures.splice(d,1)},b.CanvasTinter._checkCache=function(){var a,c,d,e,f,g=b.time(),h=1e3*b.CanvasTinter.CACHE_TTL;for(c=0,e=b.CanvasTinter._cacheTextures.length;e>c;++c){a=b.CanvasTinter._cacheTextures[c]._tintCache,f=0;for(d in a)g-a[d].stamp>=h?delete a[d]:++f;f||(b.CanvasTinter._cacheTextures.splice(c,1),--c,--e)}},b.CanvasTinter._tintMultiply=function(a,b,c){a.fillStyle=c.cssHex,a.fillRect(0,0,b.width,b.height),a.globalCompositeOperation="multiply",a.drawImage(b,0,0,b.width,b.height,0,0,b.width,b.height),a.globalCompositeOperation="destination-atop",a.drawImage(b,0,0,b.width,b.height,0,0,b.width,b.height)},b.CanvasTinter._tintPixel=function(a,b,c){a.globalCompositeOperation="copy",a.drawImage(b,0,0,b.width,b.height,0,0,b.width,b.height);for(var d=c.r,e=c.g,f=c.b,g=a.getImageData(0,0,b.width,b.height),h=g.data,i=0,j=h.length;j>i;i+=4)h[i]*=d,h[i+1]*=e,h[i+2]*=f;a.putImageData(g,0,0)},b.CanvasState=function(a){var c=b.Render.DEFAULT;this.context=a._context,this._context=a._context,this.transform=new b.Matrix,this._transform=new b.Matrix,this.__transform=new b.Matrix,this.alpha=c.alpha,this._alpha=c.alpha,this.__alpha=c.alpha,this.blend=c.blend,this._blend=c.blend,this.__blend=c.blend,this.scale=c.scale,this._scale=c.scale,this.__scale=c.scale,this.fill=c.fill.clone(),this._fill=c.fill.clone(),this.__fill=c.fill.clone(),this.stroke=c.stroke.clone(),this._stroke=c.stroke.clone(),this.__stroke=c.stroke.clone(),this.thickness=c.thickness,this._thickness=c.thickness,this.__thickness=c.thickness,b.CanvasState._inited||(b.CanvasState._initBlending(),b.CanvasState._initSmoothing(),b.CanvasState._inited=!0)},b.CanvasState.prototype.destroy=function(){this.context=null,this._context=null,this.transform=null,this._transform=null,this.__transform=null,this.fill=null,this._fill=null,this.__fill=null,this.stroke=null,this._stroke=null,this.__stroke=null},b.CanvasState.prototype.sync=function(a){var c,d,e,f=this.context;a=a||f!==this._context,this._context=f,f&&(c=this.transform,d=this._transform,!a&&c.equal(d)||(void 0===this._reset&&(this._reset=!!f.resetTransform),this._reset&&c.identity()?f.resetTransform():f.setTransform(c.a,c.c,c.b,c.d,c.tx,c.ty),d.set(c)),c=this.alpha,d=this._alpha,(c!==d||a&&c!==f.globalAlpha)&&(f.globalAlpha=c,this._alpha=c),e=b.CanvasState.BLEND_MODES,c=this.blend,d=this._blend,(c!==d||a&&e[c]!==f.globalCompositeOperation)&&(f.globalCompositeOperation=e[c],this._blend=c),e=b.CanvasState.SMOOTH_PROPERTY,c=this.scale,d=this._scale,(c!==d||a&&c===b.Render.SCALE_LINEAR!==f[e])&&(f[e]=c===b.Render.SCALE_LINEAR,this._scale=c),c=this.fill,d=this._fill,(!c.equal(d)||a&&c.cssRGBA!==f.fillStyle)&&(f.fillStyle=c.cssRGBA,d.set(c)),c=this.stroke,d=this._stroke,(!c.equal(d)||a&&c.cssRGBA!==f.strokeStyle)&&(f.strokeStyle=c.cssRGBA,d.set(c)),c=this.thickness,d=this._thickness,(c!==d||a&&c!==f.lineWidth)&&(f.lineWidth=c,this._thickness=c))},b.CanvasState.prototype.reset=function(a){var c=b.Render.DEFAULT;this.transform.reset(),this.alpha=1,this.blend=b.Render.BLEND_NORMAL,this.scale=b.Render.SCALE_LINEAR,this.fill.set(c.fill),this.stroke.set(c.stroke),this.thickness=c.thickness,this.sync(a)},b.CanvasState.prototype.save=function(){this.__transform.set(this.transform),this.__alpha=this.alpha,this.__blend=this.blend,this.__scale=this.scale,this.__fill.set(this.fill),this.__stroke.set(this.stroke),this.__thickness=this.thickness},b.CanvasState.prototype.restore=function(a){this.transform.set(this.__transform),this.alpha=this.__alpha,this.blend=this.__blend,this.scale=this.__scale,this.fill.set(this.__fill),this.stroke.set(this.__stroke),this.thickness=this.__thickness,this.sync(a)},b.CanvasState._blendExtended=function(){var a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",b="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",c=new Image;c.src=a+"AP804Oa6"+b;var d=new Image;d.src=a+"/wCKxvRF"+b;var e=document.createElement("canvas");e.width=6,e.height=1;var f=e.getContext("2d");f.globalCompositeOperation="multiply",f.drawImage(c,0,0),f.drawImage(d,2,0);var g=f.getImageData(2,0,1,1).data;return 255===g[0]&&0===g[1]&&0===g[2]},b.CanvasState._initBlending=function(){var a=this._blendExtended(),c=[];c[b.Render.BLEND_NORMAL]="source-over",c[b.Render.BLEND_ADD]="lighter",c[b.Render.BLEND_MULTIPLY]=a?"multiply":"source-over",c[b.Render.BLEND_SCREEN]=a?"screen":"source-over",c[b.CanvasState.BLEND_MASK]="destination-in",b.CanvasState.BLEND_EXTENDED=a,b.CanvasState.BLEND_MODES=c},b.CanvasState._initSmoothing=function(){for(var a,c=document.createElement("canvas"),d=c.getContext("2d"),e=["","ms","webkit","moz","o"],f=0,g=e.length;g>f;++f)if(a=e[f]+"imageSmoothingEnabled",a in d){b.CanvasRender.SMOOTH_PROPERTY=a;break}},b.CanvasState.BLEND_EXTENDED=!1,b.CanvasState.BLEND_MODES=[],b.CanvasState.BLEND_MASK=-1,b.CanvasState.SMOOTH_PROPERTY=!1,b.CanvasMask=function(a){this._render=a,this._texture=null,this._buffer=null,this._transform=new b.Matrix,this._frame=new b.Rect,this._full=new b.Rect},b.CanvasMask.prototype.destroy=function(){this._texture=null,this._buffer=null,this._transform=null,this._frame=null},b.CanvasMask.prototype.exist=function(){return!(!this._texture||!this._buffer)},b.CanvasMask.prototype.set=function(a,c,d){return a&&a.ready?(d=d||this._full.set(0,0,a.width,a.height),this._texture===a&&this._transform.equal(c)&&this._frame.equal(d)||(this._texture&&this._buffer&&this.apply(),this._texture=a,this._transform.set(c),this._frame.set(d)),this._buffer||(this._buffer=new b.Texture.create(this._render.width,this._render.height)),void this._render._setTarget(this._buffer)):(this._texture&&this._buffer&&this.apply(),this._texture=null,!0)},b.CanvasMask.prototype.resize=function(a,c){!this._buffer||this._buffer.width===a&&this._buffer.height===c||(this._buffer.destroy(),this._buffer=new b.Texture(a,c))},b.CanvasMask.prototype.clear=function(a){var c=this._render,d=this._texture;this._texture=null,c.clear(b.Color.TRANSPARENT),c._setTarget(c._target),c.clear(a),c._setTarget(this._buffer),this._texture=d},b.CanvasMask.prototype.clip=function(a,b,c,d){var e=this._render,f=this._texture;this.apply(),this._texture=null,e._setTarget(e._target),e.clip(a,b,c,d),e._setTarget(this._buffer),this._texture=f},b.CanvasMask.prototype.apply=function(){var a=this._render,c=a._state;c.save(),c.transform.set(this._transform),c.alpha=1,c.blend=b.CanvasState.BLEND_MASK,a.texture(this._texture,this._frame),c.restore(),a._setTarget(a._target),c.save(),c.reset(),a.texture(this._buffer),c.restore(),this._texture=null,a._setTarget(this._buffer),a.clear(b.Color.TRANSPARENT),a._setTarget(a._target)},b.CanvasRender=function(a){this.id=0,this.root=null,this.background=null,this.fps=0,this.ups=0,this._width=0,this._height=0,this._canvas=null,this._displayCanvas=null,this._context=null,this._displayContext=null,this._state=null,this._graphics=null,this._target=null,this._clip=new b.Rect,this._mask=null,this._bounds=new b.Rect,this._boundsScroll=new b.Point,this._lastUpdateTime=0,this._lastRenderTime=0,this._frameBind=null,this._setupSettings(a),this._createContext()&&(this._setupHelpers(),this._setupViewport(a),this._resetState(),this._addRender(),this._setupFrame())},Object.defineProperty(b.CanvasRender.prototype,"type",{get:function(){return b.Render.RENDER_CANVAS}}),Object.defineProperty(b.CanvasRender.prototype,"width",{get:function(){return this._width},set:function(a){a!==this._width&&this.resize(a,this._height)}}),Object.defineProperty(b.CanvasRender.prototype,"height",{get:function(){return this._height},set:function(a){a!==this._height&&this.resize(this._width,a)}}),Object.defineProperty(b.CanvasRender.prototype,"bounds",{get:function(){return this._boundsScroll.equal(b.Screen.scrollX,b.Screen.scrollY)||this._updateBounds(),this._bounds}}),Object.defineProperty(b.CanvasRender.prototype,"target",{get:function(){return this._target},set:function(a){this._target!==a&&(this.clip(),this.mask(),this._target=a,this._setTarget(a))}}),Object.defineProperty(b.CanvasRender.prototype,"transform",{get:function(){return this._state.transform},set:function(a){a?this._state.transform.set(a):this._state.transform.reset()}}),Object.defineProperty(b.CanvasRender.prototype,"alpha",{get:function(){return this._state.alpha},set:function(a){this._state.alpha=0>a?0:a>1?1:a}}),Object.defineProperty(b.CanvasRender.prototype,"blend",{get:function(){return this._state.blend},set:function(a){this._state.blend!==a&&b.CanvasState.BLEND_MODES[a]&&(this._state.blend=a)}}),Object.defineProperty(b.CanvasRender.prototype,"fill",{get:function(){return this._state.fill},set:function(a){this._state.fill.set(a?a:b.Color.TRANSPARENT)}}),Object.defineProperty(b.CanvasRender.prototype,"stroke",{get:function(){return this._state.stroke},set:function(a){this._state.stroke.set(a?a:b.Color.TRANSPARENT)}}),Object.defineProperty(b.CanvasRender.prototype,"thickness",{get:function(){return this._state.thickness},set:function(a){this._state.thickness=!a||0>a?0:a}}),b.CanvasRender.prototype.resize=function(a,b){return this._width=a,this._height=b,this._canvas.width=a,this._canvas.height=b,this._mask.resize(a,b),this._updateBounds(),this._resetState(!0),this.root&&this.root.render(this,this._lastRenderTime),this},b.CanvasRender.prototype.destroy=function(){this._removeRender(),this._state=null,this._graphics.destroy(),this._graphics=null,this._mask.destroy(),this._mask=null,this._context=null,this._canvas=null,this._target=null,this._displayCanvas=null,this._displayContext=null,this._bounds=null,this._boundsScroll=null,this._frameBind=null,this.root=null},b.CanvasRender.prototype.clear=function(a){var b=this._state;return this._mask.exist()?(this._mask.clear(a),this):(a||(a=this.background),a&&!a.a?(b.save(),b.reset(),this._context.clearRect(0,0,this._width,this._height),b.restore(),this):a?(b.save(),b.transform.reset(),b.thickness=0,b.fill.set(a),b.sync(),this._context.fillRect(0,0,this._width,this._height),b.restore(),this):this)},b.CanvasRender.prototype.clip=function(a,b,c,d){var e=this._clip,f=this._state,g=this._context;return this._mask.exist()?(this._mask.clip(a,b,c,d),this):void 0===a||a===!1?e.equal(0,0,this._width,this._height)?this:(e.set(0,0,this._width,this._height),g.restore(),f.sync(!0),this):e.equal(a,b,c,d)?this:(e.equal(0,0,this._width,this._height)||(g.restore(),f.sync(!0)),e.set(a,b,c,d),f.save(),f.transform.reset(),f.sync(),g.save(),g.beginPath(),g.rect(a,b,c,d),g.clip(),f.restore(),this)},b.CanvasRender.prototype.mask=function(a,c){return a&&a.ready&&!a.pot&&c&&(c.width>a.width||c.height>a.height)?(b.error("Repeating non power of two mask textures are not supported"),this):(this._mask.set(a,this.transform,c),this)},b.CanvasRender.prototype.style=function(a,b,c){var d=this._state;return null!==a&&void 0!==a&&a!==!1&&d.fill.set(a),null!==b&&void 0!==b&&b!==!1&&d.stroke.set(b),null!==c&&void 0!==c&&c!==!1&&(d.thickness=c),this},b.CanvasRender.prototype.texture=function(a,c,d){var e=this._state;if(!a||!a.ready||!e.alpha)return this;e.sync();var f=this._context,g=b.CanvasTexture.get(a);if(!c||c.x>=0&&c.x<=a.width-c.width&&c.y>=0&&c.y<=a.height-c.height)return f.drawImage(g.handle(d),c?c.x:0,c?c.y:0,c?c.width:a.width,c?c.height:a.height,0,0,c?c.width:a.width,c?c.height:a.height),this;if(!a.pot)return b.error("Repeating non power of two textures are not supported"),this;var h=f.fillStyle;f.fillStyle=g.pattern(this,d);var i=c.x%a.width,j=c.y%a.height;return 0===i&&0===j||f.translate(-i,-j),f.fillRect(i,j,c.width,c.height),0===i&&0===j||f.translate(i,j),f.fillStyle=h,this},b.CanvasRender.prototype.line=function(a,b,c,d){return this._state.sync(),this._graphics.line(a,b,c,d),this},b.CanvasRender.prototype.rect=function(a,b,c,d){return this._state.sync(),this._graphics.rect(a,b,c,d),this},b.CanvasRender.prototype.circle=function(a,b,c){return this._state.sync(),this._graphics.circle(a,b,c),this},b.CanvasRender.prototype.ellipse=function(a,b,c,d){return this._state.sync(),this._graphics.ellipse(a,b,c,d),this},b.CanvasRender.prototype.arc=function(a,b,c,d,e,f){return this._state.sync(),this._graphics.arc(a,b,c,d,e,f),this},b.CanvasRender.prototype.poly=function(a){return this._state.sync(),this._graphics.poly(a),this},b.CanvasRender.prototype.shape=function(a){return this._state.sync(),this._graphics.shape(a),this},b.CanvasRender.prototype.beginShape=function(){return this._graphics.beginShape()},b.CanvasRender.prototype.endShape=function(){return this._graphics.endShape()},b.CanvasRender.prototype.getPixels=function(a,c,d,e,f){var g=a?a.width:this.width,h=a?a.height:this.height;if(c=c||0,d=d||0,e=e||g,f=f||h,0>c||0>d||c+e>g||d+f>h)return null;var i=a?b.CanvasTexture.get(a):this;return a?i._imageData=i.context().getImageData(c,d,e,f):i._imageData=this._context.getImageData(c,d,e,f),i._imageData.data},b.CanvasRender.prototype.setPixels=function(a,c,d,e,f,g){if(!a)return b.error("Set pixels to screen not supported, try to use texture"),this;var h=a.width,i=a.height;if(d=d||0,e=e||0,f=f||h,g=g||i,!c||f*g*4!==c.length)return this;if(0>d||0>e||d+f>h||e+g>i)return this;a=b.CanvasTexture.get(a);var j=a._imageData;return j||(j=a._imageData=a.context().getImageData(d,e,f,g)),j.data!==c&&j.data.set(c),a.context().putImageData(j,d,e),this},b.CanvasRender.prototype._setupSettings=function(a){var c=b.Render.DEFAULT;if(!a.canvas)throw new Error("Can not create render, settings.canvas is not defined");a.background===!1?this.background=!1:this.background=void 0===a.background?c.background.clone():a.background.clone(),this.fps=0===a.fps?0:a.fps||c.fps,this.ups=0===a.ups?0:a.ups||c.ups,this._displayCanvas=this._canvas=a.canvas,b.Browser.ie&&(this._canvas.style["-ms-content-zooming"]="none",this._canvas.style["-ms-touch-action"]="none"),a.menu||(this._canvas.oncontextmenu=function(){return!1})},b.CanvasRender.prototype._updateBounds=function(){var a=this._canvas.getBoundingClientRect();this._bounds.set(a.left,a.top,a.width,a.height),this._boundsScroll.set(b.Screen.scrollX,b.Screen.scrollY)},b.CanvasRender.prototype._createContext=function(){var a={alpha:this.background===!1||!this.background.a};if(this._displayContext=this._context=this._canvas.getContext?this._canvas.getContext("2d",a):null,!this._context)throw new Error("This browser does not support canvas. Try using another browser");return!0},b.CanvasRender.prototype._setupViewport=function(a){var c=a.width||b.Screen.width,d=a.height||b.Screen.height;this.resize(c,d)},b.CanvasRender.prototype._setupHelpers=function(){this._state=new b.CanvasState(this),this._graphics=new b.CanvasGraphics(this),this._mask=new b.CanvasMask(this)},b.CanvasRender.prototype._addRender=function(){this.id=b.Render._uid++,b.Render.renders.push(this)},b.CanvasRender.prototype._removeRender=function(){var a=b.Render.renders.indexOf(this);-1!==a&&b.Render.renders.splice(a,1)},b.CanvasRender.prototype._setupFrame=function(){this._frameBind=this._onFrame.bind(this),this._onFrame(0)},b.CanvasRender.prototype._onFrame=function(a){if(this._frameBind){requestAnimationFrame(this._frameBind,this._canvas);var b=this.root,c=a-this._lastUpdateTime,d=a-this._lastRenderTime;this.ups&&b&&b.update&&(60===this.ups||c>=1/this.ups*900)&&(b.update(this,c),this._lastUpdateTime=a),this.fps&&b&&b.render&&(60===this.fps||d>=1/this.fps*900)&&(this._resetState(),b.render(this,d),this.mask(),this._lastRenderTime=a)}},b.CanvasRender.prototype._resetState=function(a){this.target=null,this._state.reset(a),this.clip(),this.background&&this.clear()},b.CanvasRender.prototype._setTarget=function(a){if(a){var c=b.CanvasTexture.get(a);this._canvas=c.handle(),this._context=c.context()}else this._canvas=this._displayCanvas,this._context=this._displayContext;this._state.context=this._context},b.WebglConsts={ONE:1,ONE_MINUS_SRC_ALPHA:771,DST_COLOR:774,ONE_MINUS_SRC_COLOR:769,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,FLOAT:5126,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,LINES:1,TRIANGLES:4,LINEAR:9729,NEAREST:9728,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,CLAMP_TO_EDGE:33071,VERTEX_SHADER:35633,FRAGMENT_SHADER:35632,LINK_STATUS:35714,COMPILE_STATUS:35713,SCISSOR_TEST:3089,DEPTH_TEST:2929,CULL_FACE:2884,BLEND:3042,FRAMEBUFFER:36160,TEXTURE_2D:3553,COLOR_ATTACHMENT0:36064,COLOR_BUFFER_BIT:16384,RGBA:6408},b.WebglShader=function(a,b){this._render=a,this._settings=b,this._program=null,this._vertex=null,this._fragment=null,this._attributes=[],this._uniforms=[],this._stride=0,this._restore(),a._addRestore(this)},b.WebglShader.TEXTURES=[b.WebglConsts.TEXTURE0,b.WebglConsts.TEXTURE1,b.WebglConsts.TEXTURE2,b.WebglConsts.TEXTURE3,b.WebglConsts.TEXTURE4,b.WebglConsts.TEXTURE5,b.WebglConsts.TEXTURE6,b.WebglConsts.TEXTURE7],b.WebglShader.TYPES={35670:{type:b.WebglConsts.BOOL,bytes:1,size:1},35671:{type:b.WebglConsts.BOOL,bytes:1,size:2},35672:{type:b.WebglConsts.BOOL,bytes:1,size:3},35673:{type:b.WebglConsts.BOOL,bytes:1,size:4},5120:{type:b.WebglConsts.BYTE,bytes:1,size:1},5121:{type:b.WebglConsts.UNSIGNED_BYTE,bytes:1,size:1},5122:{type:b.WebglConsts.SHORT,bytes:2,size:1},5123:{type:b.WebglConsts.UNSIGNED_SHORT,bytes:2,size:1},5124:{type:b.WebglConsts.INT,bytes:4,size:1},5125:{type:b.WebglConsts.UNSIGNED_INT,bytes:4,size:1},5126:{type:b.WebglConsts.FLOAT,bytes:4,size:1},35665:{type:b.WebglConsts.FLOAT,bytes:4,size:3},35666:{type:b.WebglConsts.FLOAT,bytes:4,size:4},35667:{type:b.WebglConsts.INT,bytes:4,size:2},35668:{type:b.WebglConsts.INT,bytes:4,size:2},35669:{type:b.WebglConsts.INT,bytes:4,size:2},35664:{type:b.WebglConsts.FLOAT,bytes:4,size:2},35674:{type:b.WebglConsts.FLOAT,bytes:4,size:4},35675:{type:b.WebglConsts.FLOAT,bytes:4,size:9},35676:{type:b.WebglConsts.FLOAT,bytes:4,size:16}},b.WebglShader.prototype.destroy=function(){this._render._removeRestore(this),this._free(),this._render=null,this._settings=null,this._program=null,this._attributes=null,this._uniforms=null},b.WebglShader.prototype.use=function(){var a,b=this._render._context,c=0,d=this._stride,e=this._attributes;b.useProgram(this._program);for(var f=0,g=e.length;g>f;++f)a=this[e[f]],b.enableVertexAttribArray(a.location),b.vertexAttribPointer(a.location,a.size,a.item,a.normalize,d,c),c+=a.bytes},b.WebglShader.prototype._lose=function(){this._free()},b.WebglShader.prototype._free=function(){var a=this._render._context;a.deleteProgram(this._program),a.deleteShader(this._vertex),a.deleteShader(this._fragment),this._program=null,this._vertex=null,this._fragment=null},b.WebglShader.prototype._restore=function(){var a=this._render._context,b=this._settings,c=this._createProgram(b.vertex,b.fragment);a.useProgram(c),this._attributes=[],this._uniforms=[],this._stride=0;var d,e,f,g;for(f=b.attributes,d=0,e=f.length;e>d;++d)g=this._createAttribute(a,c,f[d]),this._stride+=g.bytes,this[g.name]=g,this._attributes.push(g.name);for(e=a.getProgramParameter(c,a.ACTIVE_UNIFORMS),d=0;e>d;++d)g=this._createUniform(a,b,c,d),this[g.name]=g,this._uniforms.push(g.name);this._program=c},b.WebglShader.prototype._createAttribute=function(a,c,d){var e=b.WebglShader.TYPES[d.type],f={};return f.name=d.name,f.type=d.type,f.location=a.getAttribLocation(c,f.name),f.size=(d.size||1)*e.size,f.item=e.type,f.bytes=e.bytes*f.size,f.normalize=d.normalize===!0,f},b.WebglShader.prototype._createUniform=function(a,b,c,d){var e=a.getActiveUniform(c,d),f=e.name,g=f.indexOf("[");-1!==g&&(f=f.substr(0,g));var h={};return h.name=f,h.location=a.getUniformLocation(c,f),h.type=e.type,h.size=e.size,h.last=null,h.set=this._setUniform.bind(this,h),h},b.WebglShader.prototype._setUniform=function(a,c,d){var e=this._render._context,f=b.WebglConsts;switch(a.type){case f.BOOL:case f.BYTE:case f.UNSIGNED_BYTE:case f.SHORT:case f.UNSIGNED_SHORT:case f.INT:case f.UNSIGNED_INT:a.last!==c&&(e.uniform1i(a.location,c),a.last=c);break;case f.BOOL_VEC2:case f.INT_VEC2:c instanceof b.Point?e.uniform2i(a.location,c.x,c.y):e.uniform2iv(a.location,c);break;case f.BOOL_VEC3:case f.INT_VEC3:e.uniform3iv(a.location,c);break;case f.BOOL_VEC4:case f.INT_VEC4:c instanceof b.Rect?e.uniform4i(a.location,c.x,c.y,c.width,c.height):e.uniform4iv(a.location,c);break;case f.FLOAT:e.uniform1f(a.location,c);break;case f.FLOAT_VEC2:c instanceof b.Point?e.uniform2f(a.location,c.x,c.y):e.uniform2fv(a.location,c);break;case f.FLOAT_VEC3:e.uniform3fv(a.location,c);break;case f.FLOAT_VEC4:c instanceof b.Rect?e.uniform4f(a.location,c.x,c.y,c.width,c.height):e.uniform4fv(a.location,c);break;case f.FLOAT_MAT2:e.uniformMatrix2fv(a.location,d===!0,c);break;case f.FLOAT_MAT3:e.uniformMatrix3fv(a.location,d===!0,c instanceof b.Matrix?c.array():c);break;case f.FLOAT_MAT4:e.uniformMatrix4fv(a.location,d===!0,c);break;case f.SAMPLER_2D:d=d||0,e.activeTexture(b.WebglShader.TEXTURES[d]),e.bindTexture(b.WebglConsts.TEXTURE_2D,c),e.uniform1i(a.location,d)}},b.WebglShader.prototype._createProgram=function(a,c){var d=this._render._context,e=b.WebglConsts,f=d.createProgram();if(this._vertex=this._compileShader(e.VERTEX_SHADER,a),this._fragment=this._compileShader(e.FRAGMENT_SHADER,c),d.attachShader(f,this._vertex),d.attachShader(f,this._fragment),d.linkProgram(f),!d.getProgramParameter(f,e.LINK_STATUS)&&!d.isContextLost())throw new Error("Program filed to link:",d.getProgramInfoLog(f));return f},b.WebglShader.prototype._compileShader=function(a,c){var d=this._render._context,e=b.WebglConsts,f=d.createShader(a);if(d.shaderSource(f,"string"==typeof c?c:c.join("\n")),d.compileShader(f),!d.getShaderParameter(f,e.COMPILE_STATUS)&&!d.isContextLost())throw new Error("Could not compile shader:",d.getShaderInfoLog(f));return f},b.WebglShader.GRAPHICS={name:"graphics",fragment:["precision lowp float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],vertex:["attribute vec2 aPosition;","attribute vec4 aColor;","uniform vec2 uProjection;","varying vec4 vColor;","const vec2 cOffset = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4(aPosition / uProjection + cOffset, 0.0, 1.0);","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],attributes:[{name:"aPosition",type:b.WebglConsts.FLOAT_VEC2},{name:"aColor",type:b.WebglConsts.UNSIGNED_BYTE,size:4,normalize:!0}]},b.WebglShader.GRAPHICS_MASK={name:"graphics_mask",fragment:["precision lowp float;","varying vec4 vColor;","varying vec2 vMaskUV;","uniform vec4 uMaskClip;","uniform sampler2D uMask;","void main(void) {","   if (vMaskUV.x < uMaskClip.x || vMaskUV.y < uMaskClip.y || vMaskUV.x > uMaskClip.z || vMaskUV.y > uMaskClip.z) discard;","   gl_FragColor = vColor * texture2D(uMask, vMaskUV).a;","}"],vertex:["attribute vec2 aPosition;","attribute vec4 aColor;","uniform vec2 uProjection;","uniform vec3 uMaskUV[4];","varying vec2 vMaskUV;","varying vec4 vColor;","const vec2 cOffset = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4(aPosition / uProjection + cOffset, 0.0, 1.0);","   float a = dot(uMaskUV[0], vec3(1.0, aPosition.x, aPosition.y));","   float b = dot(uMaskUV[1], vec3(1.0, aPosition.x, aPosition.y));","   vMaskUV.x = dot(uMaskUV[2], vec3(1.0, a, b));","   vMaskUV.y = dot(uMaskUV[3], vec3(1.0, a, b));","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],attributes:[{name:"aPosition",type:b.WebglConsts.FLOAT_VEC2},{name:"aColor",type:b.WebglConsts.UNSIGNED_BYTE,size:4,normalize:!0}]},b.WebglShader.SPRITES={name:"sprite",fragment:["precision lowp float;","varying vec2 vUV;","varying vec4 vColor;","uniform sampler2D uTexture;","void main(void) {","   gl_FragColor = texture2D(uTexture, vUV) * vColor;","}"],vertex:["attribute vec2 aPosition;","attribute vec2 aUV;","attribute vec4 aColor;","uniform vec2 uProjection;","varying vec2 vUV;","varying vec4 vColor;","const vec2 cOffset = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4(aPosition / uProjection + cOffset, 0.0, 1.0);","   vUV = aUV;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],attributes:[{name:"aPosition",type:b.WebglConsts.FLOAT_VEC2},{name:"aUV",type:b.WebglConsts.FLOAT_VEC2},{name:"aColor",type:b.WebglConsts.UNSIGNED_BYTE,size:4,normalize:!0}]},b.WebglShader.SPRITES_MASK={name:"sprite_mask",fragment:["precision lowp float;","varying vec2 vUV;","varying vec4 vColor;","varying vec2 vMaskUV;","uniform vec4 uMaskClip;","uniform sampler2D uTexture;","uniform sampler2D uMask;","void main(void) {","   if (vMaskUV.x < uMaskClip.x || vMaskUV.y < uMaskClip.y || vMaskUV.x > uMaskClip.z || vMaskUV.y > uMaskClip.z) discard;","   gl_FragColor = texture2D(uTexture, vUV) * vColor * texture2D(uMask, vMaskUV).a;","}"],vertex:["attribute vec2 aPosition;","attribute vec2 aUV;","attribute vec4 aColor;","uniform vec2 uProjection;","uniform vec3 uMaskUV[4];","varying vec2 vUV;","varying vec2 vMaskUV;","varying vec4 vColor;","const vec2 cOffset = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4(aPosition / uProjection + cOffset, 0.0, 1.0);","   vUV = aUV;","   float a = dot(uMaskUV[0], vec3(1.0, aPosition.x, aPosition.y));","   float b = dot(uMaskUV[1], vec3(1.0, aPosition.x, aPosition.y));","   vMaskUV.x = dot(uMaskUV[2], vec3(1.0, a, b));","   vMaskUV.y = dot(uMaskUV[3], vec3(1.0, a, b));","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],attributes:[{name:"aPosition",type:b.WebglConsts.FLOAT_VEC2},{name:"aUV",type:b.WebglConsts.FLOAT_VEC2},{name:"aColor",type:b.WebglConsts.UNSIGNED_BYTE,size:4,normalize:!0}]},b.WebglGraphics=function(a){this._render=a,this._smooth=6,this._vertexSize=3,this._maxVertexCount=6e3,this._vertexCount=0,this._indexCount=0,this._indices=new Uint16Array(2*this._maxVertexCount),this._vertices=new ArrayBuffer(this._maxVertexCount*this._vertexSize*4),this._positions=new Float32Array(this._vertices),this._colors=new Int32Array(this._vertices),this._minShapeSize=4,this._states=new Uint16Array(this._maxVertexCount/this._minShapeSize),this._stateCount=0,this._stateBlends=new Uint8Array(this._maxVertexCount/this._minShapeSize),this._stateBlendLast=-1,this._shape=null,this._shapeIndex=0,this._shapeVertex=0,this._polyIndices=[],this._restore(),a._addRestore(this)},b.WebglGraphics.prototype.destroy=function(){this._render._removeRestore(this),this._free(),this._indices=null,this._vertices=null,this._render=null,this._states=null,this._stateBlends=null},b.WebglGraphics.prototype._free=function(){var a=this._render._context;a.deleteBuffer(this._vertexBuffer),a.deleteBuffer(this._indexBuffer)},b.WebglGraphics.prototype._lose=function(){this._free()},b.WebglGraphics.prototype._restore=function(){var a=this._render._context,c=b.WebglConsts;this._vertexBuffer=a.createBuffer(),this._indexBuffer=a.createBuffer(),a.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this._indexBuffer),a.bindBuffer(c.ARRAY_BUFFER,this._vertexBuffer),a.bufferData(c.ELEMENT_ARRAY_BUFFER,this._indices,c.DYNAMIC_DRAW),a.bufferData(c.ARRAY_BUFFER,this._vertices,c.DYNAMIC_DRAW)},b.WebglGraphics.prototype.reset=function(){this._stateBlendLast=b.Render.BLEND_NORMAL,this._stateCount=0,this._vertexCount=0,this._indexCount=0},b.WebglGraphics.prototype.flush=function(){if(!this._vertexCount)return!1;var a=this._render,c=a._state,d=a._mask,e=a._context,f=b.WebglConsts;e.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bindBuffer(f.ARRAY_BUFFER,this._vertexBuffer);var g;d.enabled()?(g=a._useShader(b.WebglShader.GRAPHICS_MASK),d.apply(g,0)):g=a._useShader(b.WebglShader.GRAPHICS),g.uProjection.set(a._projection),this._vertexCount>.5*this._maxVertexCount?(e.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,this._indices),e.bufferSubData(f.ARRAY_BUFFER,0,this._vertices)):(e.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,this._indices.subarray(0,this._indexCount)),
e.bufferSubData(f.ARRAY_BUFFER,0,this._positions.subarray(0,this._vertexCount*this._vertexSize)));var h=this._states,i=this._stateBlends,j=0,k=0;c.save();for(var l=0,m=this._stateCount;m>l;++l)c.blend=i[l],c.sync(),k=h[l],e.drawElements(f.TRIANGLES,k-j,f.UNSIGNED_SHORT,2*j),j=k;return c.restore(),this.reset(),!0},b.WebglGraphics.prototype.beginShape=function(){return this._shape=new b.Shape,this._shapeIndex=this._indexCount,this._shapeVertex=this._vertexCount,this._shapeState=this._stateCount,this._shape},b.WebglGraphics.prototype.endShape=function(){var a=this._shape;if(!a)return null;if(this._vertexCount-this._shapeVertex===0)return this._shape=null,this._shapeIndex=0,this._shapeVertex=0,this._shapeState=0,a;var b=this._indexCount-this._shapeIndex,c=this._vertexCount-this._shapeVertex,d=this._stateCount-this._shapeState;a._indices=new Uint16Array(this._indices.subarray(this._shapeIndex,b)),a._states=new Uint16Array(this._states.subarray(this._shapeState,d)),a._blends=new Uint8Array(this._stateBlends.subarray(this._shapeState,d)),a._vertices=new ArrayBuffer(c*this._vertexSize*4),a._colors=new Int32Array(a._vertices),a._positions=new Float32Array(a._vertices);for(var e=this._colors,f=a._colors,g=this._shapeVertex,h=c*this._vertexSize;h--;)f[h]=e[h-g];return this._indexCount-=b,this._vertexCount-=c,this._stateCount-=d,this._shape=null,this._shapeIndex=0,this._shapeVertex=0,this._shapeState=0,a},b.WebglGraphics.prototype.shape=function(a){var c=this._render._state,d=c.transform,e=c.alpha,f=a.items;if(!f||!f.length||!e)return!1;var g,h,i,j,k,l,m=b.Matrix.IDENTITY,n=b.Shape;if(!a._indices||!a._vertices){for(this._shapeIndex=this._indexCount,this._shapeVertex=this._vertexCount,this._shapeState=this._stateCount,c.save(),g=0,i=f.length;i>g;++g)switch(l=f[g],j=l.shape,c.transform.set(l.transform?l.transform:m),c.alpha=e,c.thickness=l.thickness,c.blend=l.blend,l.fill&&c.fill.set(l.fill),l.stroke&&c.stroke.set(l.stroke),l.type){case n.LINE:this.line(j.x1,j.y1,j.x2,j.y2);break;case n.RECT:this.rect(j.x,j.y,j.width,j.height);break;case n.CIRCLE:this.circle(j.x,j.y,j.radius);break;case n.ELLIPSE:this.ellipse(j.x,j.y,j.width,j.height);break;case n.ARC:this.arc(j.x,j.y,j.radius,j.startAngle,j.endAngle,j.antiClockwise);break;case n.POLY:this.poly(j.points)}c.restore(),this._shape=a,this.endShape()}for(this._maxVertexCount-this._vertexCount<a._positions.length*this._vertexSize&&this.flush(),k=this._indices,j=a._indices,g=j.length+1,h=this._indexCount+g,this._indexCount=h-1;g;)k[--h]=j[--g];k=this._positions,j=a._positions;var o=this._colors,p=a._colors;g=j.length,h=this._vertexCount+g,this._vertexCount=h;for(var q,r,s,t=d.a,u=d.b,v=d.c,w=d.d,x=d.tx,y=d.ty,z=d.identity();g>0;)1===e?o[--h]=p[--g]:(s=p[--g],o[--h]=16777215&s|(s>>24&255)/255*e*255<<24),z?(k[--h]=j[--g],k[--h]=j[--g]):(r=j[--g],q=j[--g],k[--h]=v*q+w*r+y,k[--h]=t*q+u*r+x);for(k=this._states,j=a._states,g=j.length,h=this._stateCount+g;g;)k[--h]=j[--g];for(k=this._stateBlends,j=a._blends,g=j.length,h=this._stateCount+g;g;)k[--h]=j[--g];return this._stateCount+=j.length,this._vertexCount>=this._maxVertexCount&&this.flush(),!0},b.WebglGraphics.prototype.line=function(a,c,d,e){var f=this._render._state,g=f.transform,h=f.alpha,i=f.thickness;if(!i||!h||!f.stroke.a)return!1;if(a===d&&c===e)return!1;this._maxVertexCount-this._vertexCount<4&&this.flush(),this._shape&&this._shape.add(g,b.Shape.LINE,new b.Line(a,c,d,e),null,f.stroke,i,h,f.blend);var j=f.stroke.packABGR(h),k=.5*f.thickness,l=g.a,m=g.b,n=g.c,o=g.d,p=g.tx,q=g.ty,r=this._vertexCount,s=r*this._vertexSize,t=this._indexCount,u=this._positions,v=this._colors,w=this._indices,x=e-c,y=a-d,z=Math.sqrt(x*x+y*y);return x=x/z*k,y=y/z*k,u[s++]=l*(a-x)+m*(c-y)+p,u[s++]=n*(a-x)+o*(c-y)+q,v[s++]=j,u[s++]=l*(a+x)+m*(c+y)+p,u[s++]=n*(a+x)+o*(c+y)+q,v[s++]=j,u[s++]=l*(d+x)+m*(e+y)+p,u[s++]=n*(d+x)+o*(e+y)+q,v[s++]=j,u[s++]=l*(d-x)+m*(e-y)+p,u[s++]=n*(d-x)+o*(e-y)+q,v[s++]=j,w[t++]=r+0,w[t++]=r+1,w[t++]=r+2,w[t++]=r+0,w[t++]=r+3,w[t++]=r+2,r+=4,this._vertexCount=r,this._indexCount=t,this._saveState(f.blend),this._vertexCount>=this._maxVertexCount&&this.flush(),!0},b.WebglGraphics.prototype.rect=function(a,c,d,e){var f=this._render._state,g=f.transform,h=f.alpha,i=f.fill,j=f.stroke,k=f.thickness;if(!(h&&(i.a||j.a&&k)))return!1;if(0===d||0===e)return!1;this._maxVertexCount-this._vertexCount<12&&this.flush(),this._shape&&this._shape.add(g,b.Shape.RECT,new b.Rect(a,c,d,e),i,j,k,h,f.blend);var l,m,n,o,p=g.a,q=g.b,r=g.c,s=g.d,t=g.tx,u=g.ty,v=this._vertexCount,w=v*this._vertexSize,x=this._indexCount,y=this._positions,z=this._colors,A=this._indices;if(i.a&&(o=i.packABGR(h),l=w,y[w++]=p*a+q*c+t,y[w++]=r*a+s*c+u,z[w++]=o,y[w++]=p*(a+d)+q*c+t,y[w++]=r*(a+d)+s*c+u,z[w++]=o,y[w++]=p*(a+d)+q*(c+e)+t,y[w++]=r*(a+d)+s*(c+e)+u,z[w++]=o,y[w++]=p*a+q*(c+e)+t,y[w++]=r*a+s*(c+e)+u,z[w++]=o,A[x++]=v+0,A[x++]=v+1,A[x++]=v+2,A[x++]=v+0,A[x++]=v+3,A[x++]=v+2,v+=4),k&&j.a){for(o=j.packABGR(h),n=.5*k,l=w,y[w++]=p*(a-n)+q*(c-n)+t,y[w++]=r*(a-n)+s*(c-n)+u,z[w++]=o,y[w++]=p*(a+n)+q*(c+n)+t,y[w++]=r*(a+n)+s*(c+n)+u,z[w++]=o,y[w++]=p*(a-n+d)+q*(c+n)+t,y[w++]=r*(a-n+d)+s*(c+n)+u,z[w++]=o,y[w++]=p*(a+n+d)+q*(c-n)+t,y[w++]=r*(a+n+d)+s*(c-n)+u,z[w++]=o,y[w++]=p*(a+n+d)+q*(c+n+e)+t,y[w++]=r*(a+n+d)+s*(c+n+e)+u,z[w++]=o,y[w++]=p*(a-n+d)+q*(c-n+e)+t,y[w++]=r*(a-n+d)+s*(c-n+e)+u,z[w++]=o,y[w++]=p*(a+n)+q*(c-n+e)+t,y[w++]=r*(a+n)+s*(c-n+e)+u,z[w++]=o,y[w++]=p*(a-n)+q*(c+n+e)+t,y[w++]=r*(a-n)+s*(c+n+e)+u,z[w++]=o,m=0;4>m;++m)m?(A[x++]=v+0,A[x++]=v+1,A[x++]=v+2,A[x++]=v+0,A[x++]=v+3,A[x++]=v+2,v+=2):(A[x++]=v+0,A[x++]=v+1,A[x++]=v+6,A[x++]=v+0,A[x++]=v+7,A[x++]=v+6);v+=2}return this._vertexCount=v,this._indexCount=x,this._saveState(f.blend),this._vertexCount>=this._maxVertexCount&&this.flush(),!0},b.WebglGraphics.prototype.circle=function(a,c,d){if(this._shape){var e=this._render._state;if(!(e.alpha&&(e.fill.a||e.stroke.a&&e.thickness)))return!1;this._shape.add(e.transform,b.Shape.CIRCLE,new b.Circle(a,c,d),e.fill,e.stroke,e.thickness,e.alpha,e.blend)}return this._drawEllipse(a,c,2*d,2*d)},b.WebglGraphics.prototype.ellipse=function(a,c,d,e){if(this._shape){var f=this._render._state;if(!(f.alpha&&(f.fill.a||f.stroke.a&&f.thickness)))return!1;this._shape.add(f.transform,b.Shape.ELLIPSE,new b.Ellipse(a,c,d,e),f.fill,f.stroke,f.thickness,f.alpha,f.blend)}return this._drawEllipse(a,c,d,e)},b.WebglGraphics.prototype.arc=function(a,c,d,e,f,g){var h=this._render._state,i=h.transform,j=h.alpha,k=h.fill,l=h.stroke,m=h.thickness;if(!(j&&(k.a||l.a&&m)))return!1;if(0===d||e===f)return!1;var n=b.Math.TWO_PI;e>f&&(f=Math.floor(e/n+1)*n+f%n);var o=f-e;if(o>n&&(o%=n),g&&(o-=n),!o)return!1;this._shape&&this._shape.add(i,b.Shape.ARC,new b.Arc(a,c,d,e,f,g),k,l,m,j,h.blend);var p,q,r,s,t,u,v,w,x,y,z,A=i.a,B=i.b,C=i.c,D=i.d,E=i.tx,F=i.ty,G=this._vertexCount,H=this._indexCount,I=G*this._vertexSize,J=this._positions,K=this._colors,L=this._indices,M=o!==n,N=Math.round(Math.round(this._smooth*Math.sqrt(Math.max(A*d,D*d)))/n*(0>o?-o:o)),O=o/N;if(M&&++N,this._maxVertexCount-this._vertexCount<3*N&&(this.flush(),G=this._vertexCount,H=this._indexCount,I=G*this._vertexSize),k.a)for(p=k.packABGR(j),w=d,x=0,e%n!==0&&(t=Math.cos(e),s=Math.sin(e),u=w,w=t*u-s*x,x=s*u+t*x),t=Math.cos(O),s=Math.sin(O),r=G,q=0;N>q;++q)u=w,q&&(w=t*u-s*x,x=s*u+t*x),u=w+a,v=x+c,J[I++]=A*u+B*v+E,J[I++]=C*u+D*v+F,K[I++]=p,q>1&&(L[H++]=r,L[H++]=G-1,L[H++]=G),++G;if(m&&l.a)for(p=l.packABGR(j),r=G+2*N,m*=.5,w=d-m,x=0,y=d+m,z=0,e%n!==0&&(t=Math.cos(e),s=Math.sin(e),u=w,w=t*u-s*x,x=s*u+t*x,u=y,y=t*u-s*z,z=s*u+t*z),t=Math.cos(O),s=Math.sin(O),q=0;N>q;++q)u=w,q&&(w=t*u-s*x,x=s*u+t*x),u=w+a,v=x+c,J[I++]=A*u+B*v+E,J[I++]=C*u+D*v+F,K[I++]=p,u=y,q&&(y=t*u-s*z,z=s*u+t*z),u=y+a,v=z+c,J[I++]=A*u+B*v+E,J[I++]=C*u+D*v+F,K[I++]=p,q?(L[H++]=G-2,L[H++]=G-1,L[H++]=G,L[H++]=G-1,L[H++]=G+1,L[H++]=G):M||(L[H++]=r-2,L[H++]=r-1,L[H++]=G,L[H++]=r-1,L[H++]=G+1,L[H++]=G),G+=2;return this._vertexCount=G,this._indexCount=H,this._saveState(h.blend),this._vertexCount>=this._maxVertexCount&&this.flush(),!0},b.WebglGraphics.prototype.poly=function(a){var c=this._render._state,d=c.transform,e=c.alpha,f=c.fill,g=c.stroke,h=c.thickness;if(!(e&&(f.a||g.a&&h)))return!1;var i=a.length;if(2>i||!e)return!1;var j,k,l=a[0].equal(a[i-1]);if(2===i||3===i&&l)return j=a[0],k=a[1],this.line(j.x,j.y,k.x,k.y),!0;var m=this._vertexCount,n=m*this._vertexSize,o=this._indexCount,p=this._positions,q=this._colors,r=this._indices;if(this._maxVertexCount<4*a.length)return!1;this._maxVertexCount-this._vertexCount<4*a.length&&(this.flush(),m=this._vertexCount,o=this._indexCount,n=m*this._vertexSize),this._shape&&this._shape.add(d,b.Shape.POLY,new b.Poly(a),f,g,h,e,c.blend);var s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V=d.a,W=d.b,X=d.c,Y=d.d,Z=d.tx,$=d.ty;if(f.a){s=f.packABGR(e),C=i,l&&--C,A=n;var _,aa,ba,ca,da,ea,fa,ga,ha,ia=this._polyIndices;for(ia.length=C,B=0;C>B;++B)ia[B]=B;for(B=0;C>3;){if(_=ia[(B+0)%C],aa=ia[(B+1)%C],ba=ia[(B+2)%C],j=a[_],k=a[aa],t=a[ba],E=j.x,F=j.y,G=k.x,H=k.y,I=t.x,J=t.y,ca=!1,(F-H)*(I-G)+(G-E)*(J-H)>=0){ca=!0;for(var ja=0;C>ja;++ja)if(U=ia[ja],U!==_&&U!==aa&&U!==ba&&(j=a[U],O=I-E,P=J-F,Q=G-E,R=H-F,S=j.x-E,T=j.y-F,da=O*O+P*P,ea=O*Q+P*R,fa=O*S+P*T,ga=Q*Q+R*R,ha=Q*S+R*T,D=1/(da*ga-ea*ea),O=(ga*fa-ea*ha)*D,P=(da*ha-ea*fa)*D,O>=0&&P>=0&&1>O+P)){ca=!1;break}}if(ca)p[n++]=V*E+W*F+Z,p[n++]=X*E+Y*F+$,q[n++]=s,p[n++]=V*G+W*H+Z,p[n++]=X*G+Y*H+$,q[n++]=s,p[n++]=V*I+W*J+Z,p[n++]=X*I+Y*J+$,q[n++]=s,r[o++]=m+0,r[o++]=m+1,r[o++]=m+2,m+=3,ia.splice((B+1)%C,1),C--,B=0;else if(B++>3*C)break}j=a[ia[0]],k=a[ia[1]],t=a[ia[2]],E=j.x,F=j.y,G=k.x,H=k.y,I=t.x,J=t.y,p[n++]=V*E+W*F+Z,p[n++]=X*E+Y*F+$,q[n++]=s,p[n++]=V*G+W*H+Z,p[n++]=X*G+Y*H+$,q[n++]=s,p[n++]=V*I+W*J+Z,p[n++]=X*I+Y*J+$,q[n++]=s,r[o++]=m+0,r[o++]=m+1,r[o++]=m+2,m+=3}if(h&&g.a){s=g.packABGR(e),j=a[0],k=a[i-1];var ka,la,ma,na,oa,pa=.5*h;for(l=j.x===k.x&&j.y===k.y,i-=2,A=n,B=l?-1:0;i>B;++B)j=-1===B?a[i]:a[B],k=a[B+1],t=a[B+2],u=j.x,v=j.y,w=k.x,x=k.y,y=t.x,z=t.y,O=w-u,P=x-v,Q=w-y,R=x-z,S=u-y,T=v-z,F=u-w,C=Math.sqrt(P*P+F*F),E=P/C*pa,F=F/C*pa,J=y-w,C=Math.sqrt(R*R+J*J),I=R/C*pa,J=J/C*pa,G=E+I,H=F+J,U=R*O-Q*P,U?(D=(Q*(T-H)-R*(S-G))/U,K=u-E+D*O,L=v-F+D*P,D=(Q*(T+H)-R*(S+G))/U,M=u+E+D*O,N=v+F+D*P):(K=w-E,L=x-F,M=w+E,N=x+F),O=V*K+W*L+Z,P=X*K+Y*L+$,Q=V*M+W*N+Z,R=X*M+Y*N+$,K=O,L=P,M=Q,N=R,Q=V*w+W*x+Z,R=X*w+Y*x+$,ka=(K-Q)*(K-Q)+(L-R)*(L-R)>1e4,ka&&(O=V*(w+I)+W*(x+J)+Z,P=X*(w+I)+Y*(x+J)+$,Q=V*(w-I)+W*(x-J)+Z,R=X*(w-I)+Y*(x-J)+$),-1!==B?(B||l||(p[n++]=V*(u+E)+W*(v+F)+Z,p[n++]=X*(u+E)+Y*(v+F)+$,q[n++]=s,p[n++]=V*(u-E)+W*(v-F)+Z,p[n++]=X*(u-E)+Y*(v-F)+$,q[n++]=s,m+=2),ka?(p[n++]=M,p[n++]=N,q[n++]=s,p[n++]=Q,p[n++]=R,q[n++]=s):(p[n++]=M,p[n++]=N,q[n++]=s,p[n++]=K,p[n++]=L,q[n++]=s),r[o++]=m-2+0,r[o++]=m-2+1,r[o++]=m-2+2,r[o++]=m-2+1,r[o++]=m-2+2,r[o++]=m-2+3,m+=2,ka&&(p[n++]=M,p[n++]=N,q[n++]=s,p[n++]=O,p[n++]=P,q[n++]=s,r[o++]=m-1+0,r[o++]=m-1+1,r[o++]=m-1+2,m+=2),B===i-1&&(l?(p[n++]=na,p[n++]=oa):(p[n++]=V*(y-I)+W*(z-J)+Z,p[n++]=X*(y-I)+Y*(z-J)+$),q[n++]=s,l?(p[n++]=la,p[n++]=ma):(p[n++]=V*(y+I)+W*(z+J)+Z,p[n++]=X*(y+I)+Y*(z+J)+$),q[n++]=s,r[o++]=m-2+0,r[o++]=m-2+1,r[o++]=m-2+2,r[o++]=m-2+(l?0:1),r[o++]=m-2+2,r[o++]=m-2+3,m+=2)):(la=p[n++]=M,ma=p[n++]=N,q[n++]=s,na=p[n++]=K,oa=p[n++]=L,q[n++]=s,m+=2)}return this._vertexCount=m,this._indexCount=o,this._saveState(c.blend),this._vertexCount>=this._maxVertexCount&&this.flush(),!0},b.WebglGraphics.prototype._drawEllipse=function(a,c,d,e){var f=this._render._state,g=f.transform,h=f.alpha,i=f.fill,j=f.stroke,k=f.thickness;if(!(h&&(i.a||j.a&&k)))return!1;if(0===d||0===e)return!1;var l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=g.a,C=g.b,D=g.c,E=g.d,F=g.tx,G=g.ty,H=this._vertexCount,I=this._indexCount,J=H*this._vertexSize,K=this._positions,L=this._colors,M=this._indices;if(d*=.5,e*=.5,n=Math.abs(B*d+C*e),o=Math.abs(D*d+E*e),w=Math.round(this._smooth*Math.sqrt(Math.max(B*d,E*e))),v=b.Math.TWO_PI/w,y=Math.cos(v),x=Math.sin(v),this._maxVertexCount-this._vertexCount<3*w+1&&(this.flush(),H=this._vertexCount,I=this._indexCount,J=H*this._vertexSize),i.a)for(A=i.packABGR(h),z=e/d,K[J++]=B*a+C*c+F,K[J++]=D*a+E*c+G,L[J++]=A,m=H,++H,n=d,o=0,l=0;w>l;++l)p=n,n=y*p-x*o,o=x*p+y*o,p=n+a,q=o*z+c,K[J++]=B*p+C*q+F,K[J++]=D*p+E*q+G,L[J++]=A,M[I++]=m,M[I++]=l?H-1:m+w,M[I++]=H,++H;if(k&&j.a)for(A=j.packABGR(h),u=0,m=H+2*w,t=.5*k,d===e&&(n=d-t,o=0,r=d+t,s=0),l=0;w>l;++l)d===e?(p=n,n=y*p-x*o,o=x*p+y*o,p=n+a,q=o+c):(y=Math.cos(u),x=Math.sin(u),p=y*(d+t)+a,q=x*(e+t)+c),K[J++]=B*p+C*q+F,K[J++]=D*p+E*q+G,L[J++]=A,d===e?(p=r,r=y*p-x*s,s=x*p+y*s,p=r+a,q=s+c):(p=y*(d-t)+a,q=x*(e-t)+c),K[J++]=B*p+C*q+F,K[J++]=D*p+E*q+G,L[J++]=A,l?(M[I++]=H-2,M[I++]=H-1,M[I++]=H,M[I++]=H-1,M[I++]=H+1,M[I++]=H):(M[I++]=m-2,M[I++]=m-1,M[I++]=H,M[I++]=m-1,M[I++]=H+1,M[I++]=H),H+=2,u+=v;return this._vertexCount=H,this._indexCount=I,this._saveState(f.blend),this._vertexCount>=this._maxVertexCount&&this.flush(),!0},b.WebglGraphics.prototype._saveState=function(a){return a=a||b.Render.BLEND_NORMAL,a===this._stateBlendLast&&this._stateCount?void(this._states[this._stateCount-1]=this._indexCount):(this._states[this._stateCount]=this._indexCount,this._stateBlends[this._stateCount]=a,this._stateBlendLast=a,void++this._stateCount)},b.WebglTexture=function(a){this.texture=a,this._handles={},this._renders=[],this._imageBuffer=null,this._imageData=null,this._imageDataClamped=null,this._imageData32=null},b.WebglTexture.prototype.destroy=function(){var a=this._renders.length;if(a){for(var b=0;a>b;++b){var c=this._renders[b],d=this._handles[c.id];c._removeRestore(this),c._context.deleteTexture(d.texture),d.buffer&&c._context.deleteFramebuffer(d.buffer)}this._handles=null,this._renders=null,this._imageBuffer=null,this._imageData=null,this._imageDataClamped=null,this._imageData32=null,this.texture=null}},b.WebglTexture.prototype.destroyHandle=function(a){var b=this._handles[a.id];b&&(a._context.deleteTexture(b.texture),b.buffer&&a._context.deleteFramebuffer(b.buffer),delete this._handles[a.id],this._renders.splice(this._renders.indexOf(a),1))},b.WebglTexture.prototype.handle=function(a,c){var d=this._handles[a.id];if(!d||(c?!d.buffer:!d.texture))return this._create(a),a._addRestore(this),c?this._handles[a.id].buffer:this._handles[a.id].texture;if(d.scale!==this.texture.scale){var e=a._context,f=b.WebglConsts,g=this.texture.scale===b.Render.SCALE_LINEAR?f.LINEAR:f.NEAREST;e.bindTexture(f.TEXTURE_2D,d.texture),e.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,g),e.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,g),e.bindTexture(f.TEXTURE_2D,null),d.scale=this.texture.scale}return c?d.buffer:d.texture},b.WebglTexture.prototype.hasHandle=function(a,b){var c=this._handles[a.id];return c&&(b?c.buffer:c.texture)},b.WebglTexture.prototype._lose=function(a){this.destroyHandle(a)},b.WebglTexture.prototype._create=function(a){var c=a._context,d=this.texture,e=b.WebglConsts,f=d.scale===b.Render.SCALE_LINEAR?e.LINEAR:e.NEAREST,g=c.createTexture(),h=null;c.bindTexture(e.TEXTURE_2D,g),b.CanvasTexture.has(d)?(c.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),c.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,b.CanvasTexture.get(d).handle()),d.url||(h=this._createBuffer(c,g,d.width,d.height))):(c.texImage2D(e.TEXTURE_2D,0,e.RGBA,d.width,d.height,0,e.RGBA,e.UNSIGNED_BYTE,null),h=this._createBuffer(c,g,d.width,d.height)),c.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,f),c.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,f),d.pot?(c.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),c.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(c.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),c.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),c.bindTexture(e.TEXTURE_2D,null),this._handles[a.id]={texture:g,buffer:h,scale:d.scale},this._renders.push(a)},b.WebglTexture.prototype._createBuffer=function(a,c,d,e){var f=a.createFramebuffer(),g=b.WebglConsts;return f.width=d,f.height=e,a.bindFramebuffer(g.FRAMEBUFFER,f),a.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,c,0),a.bindFramebuffer(g.FRAMEBUFFER,null),f},b.WebglTexture.get=function(a){return a._extensions.webgl||(a._extensions.webgl=new b.WebglTexture(a)),a._extensions.webgl},b.WebglTexture.has=function(a){return!!a._extensions.webgl},b.WebglSprites=function(a){this._render=a,this._vertexSize=5,this._spriteSize=4*this._vertexSize,this._maxSpriteCount=2e3,this._indices=new Uint16Array(6*this._maxSpriteCount),this._vertices=new ArrayBuffer(this._maxSpriteCount*this._spriteSize*4),this._positions=new Float32Array(this._vertices),this._colors=new Uint32Array(this._vertices),this._states=new Uint16Array(this._maxSpriteCount),this._stateCount=0,this._stateBlends=new Uint8Array(this._maxSpriteCount),this._stateBlendLast=-1,this._stateTextures=[],this._stateTextureLast=null,this._spriteCount=0,this._prepare(),this._restore(),a._addRestore(this)},b.WebglSprites.prototype.destroy=function(){this._render._removeRestore(this),this._free(),this.texture=null,this._indices=null,this._vertices=null,this._positions=null,this._colors=null,this._render=null,this._states=null,this._stateBlends=null;for(var a=this._stateTextures,b=0,c=a.length;c>b;++b)a[b]=null;this._stateTextures=null},b.WebglSprites.prototype._prepare=function(){this._stateTextures.length=this._maxSpriteCount;for(var a=this._indices,b=0,c=0,d=a.length;d>b;b+=6,c+=4)a[b+0]=c+0,a[b+1]=c+1,a[b+2]=c+2,a[b+3]=c+0,a[b+4]=c+2,a[b+5]=c+3},b.WebglSprites.prototype._free=function(){var a=this._render._context;a.deleteBuffer(this._vertexBuffer),a.deleteBuffer(this._indexBuffer)},b.WebglSprites.prototype._lose=function(){this._free()},b.WebglSprites.prototype._restore=function(){var a=this._render._context,c=b.WebglConsts;this._vertexBuffer=a.createBuffer(),this._indexBuffer=a.createBuffer(),a.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this._indexBuffer),a.bindBuffer(c.ARRAY_BUFFER,this._vertexBuffer),a.bufferData(c.ELEMENT_ARRAY_BUFFER,this._indices,c.STATIC_DRAW),a.bufferData(c.ARRAY_BUFFER,this._vertices,c.DYNAMIC_DRAW),this._stateTextures.length=0},b.WebglSprites.prototype.draw=function(a,b,c,d,e,f){var g,h,i,j,k=this._render._state,l=k.transform,m=a.texture.width,n=a.texture.height,o=this._render,p=l.a,q=l.c,r=l.b,s=l.d,t=l.tx,u=l.ty,v=f.packABGR(k.alpha),w=this._spriteCount*this._spriteSize,x=this._positions,y=this._colors;g=b/m,i=g+d,a.hasHandle(o,!0)?(j=c/n,h=j+e):(h=c/n,j=h+e),d*=m,e*=n,x[w++]=t,x[w++]=u,x[w++]=g,x[w++]=h,y[w++]=v,x[w++]=p*d+t,x[w++]=q*d+u,x[w++]=i,x[w++]=h,y[w++]=v,x[w++]=p*d+r*e+t,x[w++]=s*e+q*d+u,x[w++]=i,x[w++]=j,y[w++]=v,x[w++]=r*e+t,x[w++]=s*e+u,x[w++]=g,x[w++]=j,y[w++]=v,++this._spriteCount,this._saveState(a.handle(o),k.blend),this._spriteCount>=this._maxSpriteCount&&this.flush()},b.WebglSprites.prototype.reset=function(){for(var a=this._stateTextures,c=0,d=this._stateCount;d>c;++c)a[c]=null;this._stateTextureLast=null,this._stateBlendLast=b.Render.BLEND_NORMAL,this._stateCount=0,this._spriteCount=0},b.WebglSprites.prototype.flush=function(){if(!this._spriteCount)return!1;var a=this._render,c=a._state,d=a._mask,e=a._context,f=b.WebglConsts;e.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bindBuffer(f.ARRAY_BUFFER,this._vertexBuffer);var g;d.enabled()?(g=a._useShader(b.WebglShader.SPRITES_MASK),d.apply(g,1)):g=a._useShader(b.WebglShader.SPRITES),g.uProjection.set(a._projection),this._spriteCount>.5*this._maxSpriteCount?e.bufferSubData(f.ARRAY_BUFFER,0,this._vertices):e.bufferSubData(f.ARRAY_BUFFER,0,this._positions.subarray(0,this._spriteCount*this._spriteSize));var h,i=this._states,j=this._stateBlends,k=this._stateTextures,l=g.uTexture,m=0,n=0,o=null;c.save();for(var p=0,q=this._stateCount;q>p;++p)c.blend=j[p],c.sync(),h=k[p],h!==o&&(l.set(h,0),o=h),n=i[p],e.drawElements(f.TRIANGLES,n-m,f.UNSIGNED_SHORT,2*m),m=n;c.restore(),this.reset()},b.WebglSprites.prototype._saveState=function(a,b){return a===this._stateTextureLast&&b===this._stateBlendLast&&this._stateCount?void(this._states[this._stateCount-1]=6*this._spriteCount):(this._states[this._stateCount]=6*this._spriteCount,this._stateTextures[this._stateCount]=a,this._stateTextureLast=a,this._stateBlends[this._stateCount]=b,this._stateBlendLast=b,void++this._stateCount)},b.WebglState=function(a){var c=b.Render.DEFAULT;this._render=a,this.transform=new b.Matrix,this._transform=new b.Matrix,this.__transform=new b.Matrix,this.alpha=c.alpha,this._alpha=c.alpha,this.__alpha=c.alpha,this.blend=c.blend,this._blend=c.blend,this.__blend=c.blend,this.scale=c.scale,this._scale=c.scale,this.__scale=c.scale,this.fill=c.fill.clone(),this._fill=c.fill.clone(),this.__fill=c.fill.clone(),this.stroke=c.stroke.clone(),this._stroke=c.stroke.clone(),this.__stroke=c.stroke.clone(),this.thickness=c.thickness,this._thickness=c.thickness,this.__thickness=c.thickness,b.WebglState._inited||(b.WebglState._initBlending(a._context),b.WebglState._inited=!0),this.sync(!0)},b.WebglState.prototype.destroy=function(){this.context=null,this.transform=null,this._transform=null,this.__transform=null,this.fill=null,this._fill=null,this.__fill=null,this.stroke=null,this._stroke=null,this.__stroke=null},b.WebglState.prototype.sync=function(a){var c,d,e=this._render._context;return c=this.blend,(c!==this._blend||a)&&(d=b.WebglState.BLEND_MODES[c],d&&(e.blendFunc(d[0],d[1]),this._blend=c)),this},b.WebglState.prototype.reset=function(){var a=b.Render.DEFAULT;return this.transform.reset(),this.alpha=1,this.blend=b.Render.BLEND_NORMAL,this.scale=b.Render.SCALE_LINEAR,this.fill.set(a.fill),this.stroke.set(a.stroke),this.thickness=a.thickness,this},b.WebglState.prototype.save=function(){return this.__transform.set(this.transform),this.__alpha=this.alpha,this.__blend=this.blend,this.__scale=this.scale,this.__fill.set(this.fill),this.__stroke.set(this.stroke),this.__thickness=this.thickness,this},b.WebglState.prototype.restore=function(){return this.transform.set(this.__transform),this.alpha=this.__alpha,this.blend=this.__blend,this.scale=this.__scale,this.fill.set(this.__fill),this.stroke.set(this.__stroke),this.thickness=this.__thickness,this},b.WebglState._initBlending=function(){var a=[],c=b.WebglConsts;a[b.Render.BLEND_NORMAL]=[c.ONE,c.ONE_MINUS_SRC_ALPHA],a[b.Render.BLEND_ADD]=[c.ONE,c.ONE],a[b.Render.BLEND_MULTIPLY]=[c.DST_COLOR,c.ONE_MINUS_SRC_ALPHA],a[b.Render.BLEND_SCREEN]=[c.ONE,c.ONE_MINUS_SRC_COLOR],b.WebglState.BLEND_MODES=a},b.WebglState.BLEND_MODES=[],b.WebglMask=function(a){this._render=a,this._texture=null,this._transform=new b.Matrix,this._frame=new b.Rect,this._full=new b.Rect(0,0,1,1),this._uv=new Float32Array(12),this._a=new b.Point,this._b=new b.Point,this._c=new b.Point,this._auv=new b.Point,this._buv=new b.Point,this._cuv=new b.Point,this._ab=new b.Point,this._ac=new b.Point,this._abc=new b.Point,this._dab=new b.Point,this._dac=new b.Point},b.WebglMask.prototype.destroy=function(){this._texture=null,this._transform=null,this._frame=null},b.WebglMask.prototype.enabled=function(){return!!this._texture},b.WebglMask.prototype.set=function(a,b,c){var d=!1,e=this._render;return a&&a.ready?(this._texture!==a&&(e._flushAll(),this._texture=a,d=!0),void 0===b||this._transform.equal(b)||(e._flushAll(),this._transform.set(b),d=!0),this._frame.equal(c)||(e._flushAll(),c&&a?(this._frame.set(c.x/a.width,c.y/a.height,c.width/a.width,c.height/a.height),d=!0):this._frame.equal(this._full)||(this._frame.set(this._full),d=!0)),d&&this._calc(),d):(e._flushAll(),this._texture=null,!0)},b.WebglMask.prototype.apply=function(a,c){a.uMask.set(b.WebglTexture.get(this._texture).handle(this._render),c||0),a.uMaskUV.set(this._uv),a.uMaskClip.set(this._frame)},b.WebglMask.prototype._calc=function(){var a=this._texture,b=this._transform,c=this._a.set(0,0),d=this._b.set(a.width,0),e=this._c.set(0,a.height),f=this._auv.set(0,0),g=this._buv.set(1,0),h=this._cuv.set(0,1);b.apply(c),b.apply(d),b.apply(e);var i=this._ab.set(d.x-c.x,d.y-c.y),j=this._ac.set(e.x-c.x,e.y-c.y),k=i.x*j.y-i.y*j.x,l=0===k?0:1/k;i.multiply(l),j.multiply(l);var m=this._abc.set(j.x*c.y-j.y*c.x,i.y*c.x-i.x*c.y);i.multiply(-1),i.x*=-1,j.x*=-1;var n=this._dab.set(g.x-f.x,g.y-f.y),o=this._dac.set(h.x-f.x,h.y-f.y),p=this._uv;p[0]=m.x,p[1]=j.y,p[2]=j.x,p[3]=m.y,p[4]=i.y,p[5]=i.x,p[6]=f.x,p[7]=n.x,p[8]=o.x,p[9]=f.y,p[10]=n.y,p[11]=o.y},b.WebglRender=function(a){this.id=0,this.root=null,this.background=null,this.fps=0,this.ups=0,this._width=0,this._height=0,this._canvas=null,this._context=null,this._state=null,this._sprites=null,this._graphics=null,this._target=null,this._clip=new b.Rect,this._mask=null,this._projection=new b.Point,this._shader=null,this._shaders={},this._bounds=new b.Rect,this._boundsScroll=new b.Point,this._lastUpdateTime=0,this._lastRenderTime=0,this._frameBind=null,this._restoring=!0,this._contextLost=null,this._contextRestored=null,this._setupSettings(a),this._setupRestore(),this._createContext(),this._setupViewport(a),this._setupHelpers(),this._resetState(),this._addRender(),this._setupFrame()},Object.defineProperty(b.WebglRender.prototype,"type",{get:function(){return b.Render.RENDER_WEBGL}}),Object.defineProperty(b.WebglRender.prototype,"width",{get:function(){return this._width},set:function(a){a!==this._width&&this.resize(a,this._height)}}),Object.defineProperty(b.WebglRender.prototype,"height",{get:function(){return this._height},set:function(a){a!==this._height&&this.resize(this._width,a)}}),Object.defineProperty(b.WebglRender.prototype,"bounds",{get:function(){return this._boundsScroll.equal(b.Screen.scrollX,b.Screen.scrollY)||this._updateBounds(),this._bounds}}),Object.defineProperty(b.WebglRender.prototype,"target",{get:function(){return this._target},set:function(a){this._target!==a&&(this._flushAll(),this.mask(),this._target=a,a?(this._context.bindFramebuffer(this._context.FRAMEBUFFER,b.WebglTexture.get(a).handle(this,!0)),this._projection.x=.5*a.width,this._projection.y=.5*-a.height,this._context.viewport(0,0,a.width,a.height)):(this._context.bindFramebuffer(this._context.FRAMEBUFFER,null),this._projection.x=.5*this.width,this._projection.y=.5*-this.height,this._context.viewport(0,0,this.width,this.height)))}}),Object.defineProperty(b.WebglRender.prototype,"transform",{get:function(){return this._state.transform},set:function(a){this._state.transform.set(a)}}),Object.defineProperty(b.WebglRender.prototype,"alpha",{get:function(){return this._state.alpha},set:function(a){this._state.alpha=0>a?0:a>1?1:a}}),Object.defineProperty(b.WebglRender.prototype,"blend",{get:function(){return this._state.blend},set:function(a){this._state.blend!==a&&b.WebglState.BLEND_MODES[a]&&(this._state.blend=a)}}),Object.defineProperty(b.WebglRender.prototype,"fill",{get:function(){return this._state.fill},set:function(a){this._state.fill.set(a||b.Color.TRANSPARENT)}}),Object.defineProperty(b.WebglRender.prototype,"stroke",{get:function(){return this._state.stroke},set:function(a){this._state.stroke.set(a||b.Color.TRANSPARENT)}}),Object.defineProperty(b.WebglRender.prototype,"thickness",{get:function(){return this._state.thickness},set:function(a){this._state.thickness=!a||0>a?0:a}}),b.WebglRender.prototype.resize=function(a,b){return this._width=a,this._height=b,this._canvas.width=a,this._canvas.height=b,this._projection.x=.5*a,this._projection.y=.5*-b,this._context.viewport(0,0,a,b),this._updateBounds(),this},b.WebglRender.prototype.destroy=function(){this._removeRender(),this._sprites.destroy(),this._sprites=null,this._graphics.destroy(),this._graphics=null,this._state.destroy(),this._state=null,this._mask.destroy(),this._mask=null;for(var a in this._shaders)this._shaders[a].destroy();this._shader=null,this._shaders=null;var c=this._restoreObjects,d=c.length;for(a=0;d>a;++a)c[a]instanceof b.WebglTexture&&c[a].destroyHandle(this);this._restoreObjects=null,this._canvas.removeEventListener("webglcontextlost",this._contextLost),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored),this._contextLost=null,this._contextRestored=null,this._context=null,this._target=null,this._canvas=null,this._projection=null,this._bounds=null,this._boundsScroll=null,this._frameBind=null,this.root=null},b.WebglRender.prototype.clear=function(a){if(this._restoring)return this;this._graphics.reset(),this._sprites.reset();var c=this._context,d=b.WebglConsts;return a||(a=this.background),a?(c.clearColor(a.r,a.g,a.b,a.a),c.clear(d.COLOR_BUFFER_BIT),this):(c.colorMask(!1,!1,!1,!1),c.clear(d.COLOR_BUFFER_BIT),c.colorMask(!0,!0,!0,!0),this)},b.WebglRender.prototype.clip=function(a,c,d,e){if(this._restoring)return this;var f=this._context,g=this._clip;return void 0===a||a===!1?g.equal(0,0,this._width,this._height)?this:(this._flushAll(),g.set(0,0,this._width,this._height),f.disable(b.WebglConsts.SCISSOR_TEST),this):g.equal(a,c,d,e)?this:(this._flushAll(),g.set(a,c,d,e),f.enable(b.WebglConsts.SCISSOR_TEST),f.scissor(a,this._height-c-e,d,e),this)},b.WebglRender.prototype.mask=function(a,c){return this._restoring?this:a&&a.ready&&!a.pot&&c&&(c.width>a.width||c.height>a.height)?(b.error("Repeating non power of two mask textures are not supported"),this):(this._mask.set(a,this.transform,c),this)},b.WebglRender.prototype.style=function(a,b,c){var d=this._state;return null!==a&&void 0!==a&&a!==!1&&d.fill.set(a),null!==b&&void 0!==b&&b!==!1&&d.stroke.set(b),null!==c&&void 0!==c&&c!==!1&&(d.thickness=c),this},b.WebglRender.prototype.texture=function(a,c,d){return!this._restoring&&a&&a.ready&&this._state.alpha?!a.pot&&c&&(c.width>a.width||c.height>a.height)?(b.error("Repeating non power of two textures are not supported"),this):(this._graphics.flush(),this._sprites.draw(b.WebglTexture.get(a),c?c.x:0,c?c.y:0,c?c.width/a.width:1,c?c.height/a.height:1,d||b.Color.WHITE),this):this},b.WebglRender.prototype.line=function(a,b,c,d){var e=this._state;return!this._restoring&&e.alpha&&e.stroke.a?(this._sprites.flush(),this._graphics.line(a,b,c,d),this):this},b.WebglRender.prototype.rect=function(a,b,c,d){var e=this._state;return!this._restoring&&e.alpha&&(e.fill.a||e.stroke.a&&e.thickness)?(this._sprites.flush(),this._graphics.rect(a,b,c,d),this):this},b.WebglRender.prototype.circle=function(a,b,c){var d=this._state;return!this._restoring&&d.alpha&&(d.fill.a||d.stroke.a&&d.thickness)?(this._sprites.flush(),this._graphics.circle(a,b,c),this):this},b.WebglRender.prototype.ellipse=function(a,b,c,d){var e=this._state;return!this._restoring&&e.alpha&&(e.fill.a||e.stroke.a&&e.thickness)?(this._sprites.flush(),this._graphics.ellipse(a,b,c,d),this):this},b.WebglRender.prototype.arc=function(a,b,c,d,e,f){var g=this._state;return!this._restoring&&g.alpha&&(g.fill.a||g.stroke.a&&g.thickness)?(this._sprites.flush(),this._graphics.arc(a,b,c,d,e,f),this):this},b.WebglRender.prototype.poly=function(a){var b=this._state;return!this._restoring&&b.alpha&&(b.fill.a||b.stroke.a&&b.thickness)?(this._sprites.flush(),this._graphics.poly(a),this):this},b.WebglRender.prototype.shape=function(a){var b=this._state;return!this._restoring&&b.alpha&&(b.fill.a||b.stroke.a&&b.thickness)?(this._sprites.flush(),this._graphics.shape(a),this):this},b.WebglRender.prototype.beginShape=function(){return this._graphics.beginShape()},b.WebglRender.prototype.endShape=function(){return this._graphics.endShape()},b.WebglRender.prototype.getPixels=function(a,c,d,e,f){if(this._restoring)return null;var g=a?a.width:this.width,h=a?a.height:this.height;if(c=c||0,d=d||0,e=e||g,f=f||h,0>c||0>d||c+e>g||d+f>h)return null;this._flushAll(),d=h-d-f;var i=a?b.WebglTexture.get(a):this;i._imageData&&i._imageData.length===e*f*4||(i._imageBuffer=new ArrayBuffer(e*f*4),i._imageData=new Uint8Array(i._imageBuffer),i._imageDataClamped=new Uint8ClampedArray(i._imageBuffer),i._imageData32=new Uint32Array(i._imageBuffer));var j=this._context,k=b.WebglConsts;(a||this._target)&&j.bindFramebuffer(k.FRAMEBUFFER,a?i.handle(this,!0):null),a&&j.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,i.handle(this),0),j.readPixels(c,d,e,f,k.RGBA,k.UNSIGNED_BYTE,i._imageData);var l=this._target;if(null===l?j.bindFramebuffer(k.FRAMEBUFFER,null):this.target=l,f>1){var m=0,n=i._imageData32;for(h=.5*f,d=0;h>d;++d)for(c=0;e>c;++c)m=n[d*e+c],
n[d*e+c]=n[(f-d-1)*e+c],n[(f-d-1)*e+c]=m}return i._imageDataClamped},b.WebglRender.prototype.setPixels=function(a,c,d,e,f,g){if(this._restoring)return this;if(!a)return b.error("Set pixels to screen not supported, try to use texture"),this;var h=a.width,i=a.height;if(d=d||0,e=e||0,f=f||h,g=g||i,!c||f*g*4!==c.length)return this;if(0>d||0>e||d+f>h||e+g>i)return this;e=i-e-g;var j=b.WebglTexture.get(a);c!==j._imageDataClamped&&j._imageDataClamped.set(c);var k=this._context,l=b.WebglConsts;return k.bindTexture(l.TEXTURE_2D,j.handle(this)),k.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!0),k.texSubImage2D(l.TEXTURE_2D,0,d,e,f,g,l.RGBA,l.UNSIGNED_BYTE,j._imageData),k.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!1),this},b.WebglRender.prototype._useShader=function(a){if(!a)return this._shader;var c=this._shaders[a.name];return c?c!==this._shader?(this._shader=this._shaders[a.name],this._shader.use(),this._shader):c:(this._shader=this._shaders[a.name]=new b.WebglShader(this,a),this._shader.use(),this._shader)},b.WebglRender.prototype._flushAll=function(){this._graphics.flush(),this._sprites.flush()},b.WebglRender.prototype._loseContext=function(a){if(this._restoring)return!1;var c=this._context.getExtension("WEBGL_lose_context");return c?(b.log("Killing context in render with id [",this.id,"]"),c.loseContext(),setTimeout(function(){b.log("Restoring context in render with id [",this.id,"]"),c.restoreContext()}.bind(this),a||1e3),!0):(b.log("Lose context extension not supported"),!1)},b.WebglRender.prototype._setupSettings=function(a){var c=b.Render.DEFAULT;if(!a.canvas)throw new Error("Can not create render, settings.canvas is not defined");a.background===!1?this.background=!1:this.background=void 0===a.background?c.background.clone():a.background.clone(),this.fps=0===a.fps?0:a.fps||c.fps,this.ups=0===a.ups?0:a.ups||c.ups,this._canvas=a.canvas,b.Browser.ie&&(this._canvas.style["-ms-content-zooming"]="none",this._canvas.style["-ms-touch-action"]="none"),a.menu||(this._canvas.oncontextmenu=function(){return!1})},b.WebglRender.prototype._setupRestore=function(){this._restoreObjects=[],this._contextLost=this._onContextLost.bind(this),this._contextRestored=this._onContextRestored.bind(this),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1)},b.WebglRender.prototype._addRestore=function(a){return a._restore||a._lose?-1!==this._restoreObjects.indexOf(a)?!1:(this._restoreObjects.push(a),!0):b.error("Object has no _restore or _lose method for context lost handling")},b.WebglRender.prototype._removeRestore=function(a){var b=this._restoreObjects.indexOf(a);return-1!==b?(this._restoreObjects.splice(b,1),!0):!1},b.WebglRender.prototype._restore=function(){for(var a=this._restoreObjects,b=0,c=a.length;c>b;++b)a[b]._restore&&a[b]._restore(this);this._shader=null,this._restoring=!1},b.WebglRender.prototype._lose=function(){for(var a=this._restoreObjects,b=0,c=a.length;c>b;++b)a[b]._lose&&a[b]._lose(this)},b.WebglRender.prototype._onContextLost=function(a){a.preventDefault(),this._restoring=!0,this._lose()},b.WebglRender.prototype._onContextRestored=function(){this._createContext()},b.WebglRender.prototype._updateBounds=function(){var a=this._canvas.getBoundingClientRect();this._bounds.set(a.left,a.top,a.width,a.height),this._boundsScroll.set(b.Screen.scrollX,b.Screen.scrollY)},b.WebglRender.prototype._createContext=function(){var a={antialias:!0,depth:!1,stencil:!1,alpha:this.background===!1||!this.background.a,premultipliedAlpha:!0,preserveDrawingBuffer:this.background===!1},c="This browser does not support WebGL, use the canvas render";if(b.Capabilities.webgl<.94)throw new Error(c);try{this._context=this._canvas.getContext("experimental-webgl",a)||this._canvas.getContext("webgl",a)}catch(d){throw new Error(c)}if(!this._context)throw new Error(c);var e=this._context,f=b.WebglConsts;e.disable(f.DEPTH_TEST),e.disable(f.CULL_FACE),e.enable(f.BLEND),e.colorMask(!0,!0,!0,!0),this._restore()},b.WebglRender.prototype._setupViewport=function(a){var c=a.width||b.Screen.width,d=a.height||b.Screen.height;this.resize(c,d)},b.WebglRender.prototype._setupHelpers=function(){this._state=new b.WebglState(this),this._mask=new b.WebglMask(this),this._sprites=new b.WebglSprites(this),this._graphics=new b.WebglGraphics(this)},b.WebglRender.prototype._addRender=function(){this.id=b.Render._uid++,b.Render.renders.push(this)},b.WebglRender.prototype._removeRender=function(){var a=b.Render.renders.indexOf(this);-1!==a&&b.Render.renders.splice(a,1)},b.WebglRender.prototype._setupFrame=function(){this._frameBind=this._onFrame.bind(this),this._onFrame(0)},b.WebglRender.prototype._onFrame=function(a){if(this._frameBind){requestAnimationFrame(this._frameBind,this._canvas);var b=this.root,c=a-this._lastUpdateTime,d=a-this._lastRenderTime;this.ups&&b&&b.update&&(60===this.ups||c>=1/this.ups*900)&&(b.update(this,c),this._lastUpdateTime=a),this.fps&&b&&b.render&&!this._restoring&&(60===this.fps||d>=1/this.fps*900)&&(this._resetState(),b.render(this,d),this.mask(),this._flushAll(),this._lastRenderTime=a)}},b.WebglRender.prototype._resetState=function(){this.target=null,this._state.reset().sync(),this.clip(),this.background&&this.clear()},b.MouseEvent=function(){this._type=0,this._button=0,this._position=new b.Point(0,0),this._wheel=new b.Point(0,0)},Object.defineProperty(b.MouseEvent.prototype,"type",{get:function(){return this._type}}),Object.defineProperty(b.MouseEvent.prototype,"button",{get:function(){return this._button}}),Object.defineProperty(b.MouseEvent.prototype,"x",{get:function(){return this._position.x}}),Object.defineProperty(b.MouseEvent.prototype,"y",{get:function(){return this._position.y}}),Object.defineProperty(b.MouseEvent.prototype,"wheelX",{get:function(){return this._wheel.x}}),Object.defineProperty(b.MouseEvent.prototype,"wheelY",{get:function(){return this._wheel.y}}),b.MouseEvent.prototype._set=function(a,b,c,d,e,f){this._type=a,this._button=b,this._position.set(c,d),this._wheel.set(e,f)},b.MouseEvent.prototype._reset=function(){this._type=0,this._button=0,this._position.set(0,0),this._wheel.set(0,0)},b.Mouse=function(){this._button=0,this._position=new b.Point(0,0),this._wheel=new b.Point(0,0),this._event=new b.MouseEvent,this._initialize()},b.Mouse.prototype.any=function(a,c){return!(a.type!==b.Mouse.UP&&a.type!==b.Mouse.DOWN&&a.type!==b.Mouse.MOVE||c&&a.button!==c)},b.Mouse.prototype.up=function(a,c){return a.type===b.Mouse.UP&&(!c||a.button===c)},b.Mouse.prototype.down=function(a,c){return a.type===b.Mouse.DOWN&&(!c||a.button===c)},b.Mouse.prototype.move=function(a,c){return a.type===b.Mouse.MOVE&&(!c||a.button===c)},b.Mouse.prototype.wheel=function(a){return a.type===b.Mouse.WHEEL},Object.defineProperty(b.Mouse.prototype,"button",{get:function(){return this._button}}),Object.defineProperty(b.Mouse.prototype,"x",{get:function(){return this._position.x}}),Object.defineProperty(b.Mouse.prototype,"y",{get:function(){return this._position.y}}),Object.defineProperty(b.Mouse.prototype,"wheelX",{get:function(){return this._wheel.x}}),Object.defineProperty(b.Mouse.prototype,"wheelY",{get:function(){return this._wheel.y}}),b.Mouse.prototype._initialize=function(){b.Browser.any&&(window.addEventListener("mouseover",this._onOver.bind(this),!0),window.addEventListener("mouseout",this._onOut.bind(this),!0),window.addEventListener("mouseup",this._onUp.bind(this),!0),window.addEventListener("mousedown",this._onDown.bind(this),!0),window.addEventListener("mousemove",this._onMove.bind(this),!0),"onwheel"in window||b.Browser.ie&&"WheelEvent"in window?window.addEventListener("wheel",this._onWheel.bind(this),!0):"onmousewheel"in window?window.addEventListener("mousewheel",this._onWheel.bind(this),!0):b.Browser.firefox&&"MouseScrollEvent"in window&&window.addEventListener("MozMousePixelScroll",this._onWheel.bind(this),!0))},b.Mouse.prototype._callInput=function(a){for(var c=b.Render.renders,d=this._event,e=!1,f=0,g=c.length;g>f;++f){var h=c[f],i=h.bounds,j=this._position;h.root&&i.contains(j)&&(d._set(a,this._button,j.x-i.x,j.y-i.y,this._wheel.x,this._wheel.y),h.root.input(d,h),e=!0)}return d._reset(),e},b.Mouse.prototype._onOver=function(a){this._position.set(a.clientX,a.clientY)},b.Mouse.prototype._onOut=function(){this._position.set(0,0)},b.Mouse.prototype._onDown=function(a){this._position.set(a.clientX,a.clientY),this._button=Math.min(a.button+1,3),this._callInput(b.Mouse.DOWN)&&a.preventDefault()},b.Mouse.prototype._onUp=function(a){this._position.set(a.clientX,a.clientY),this._button=Math.min(a.button+1,3),this._callInput(b.Mouse.UP)&&a.preventDefault(),this._button=b.Mouse.NONE},b.Mouse.prototype._onMove=function(a){this._position.set(a.clientX,a.clientY),this._callInput(b.Mouse.MOVE)&&a.preventDefault()},b.Mouse.prototype._onWheel=function(a){void 0!==a.deltaX?(this._wheel.set(a.deltaX,a.deltaY),b.Browser.firefox&&this._wheel.multiply(40)):void 0!==a.wheelDeltaX?this._wheel.set(-a.wheelDeltaX/40,-a.wheelDeltaY/40):this._wheel.set(0,a.detail),this._callInput(b.Mouse.WHEEL)&&a.preventDefault()},b.Mouse=new b.Mouse,b.Mouse.NONE=0,b.Mouse.LEFT=1,b.Mouse.MIDDLE=2,b.Mouse.RIGHT=3,b.Mouse.UP=100,b.Mouse.DOWN=101,b.Mouse.MOVE=102,b.Mouse.WHEEL=103,b.KeyboardEvent=function(){this._type=0,this._key=0,this._char=0,this._alt=!1,this._control=!1,this._shift=!1,this._command=!1},Object.defineProperty(b.KeyboardEvent.prototype,"type",{get:function(){return this._type}}),Object.defineProperty(b.KeyboardEvent.prototype,"key",{get:function(){return this._key}}),Object.defineProperty(b.KeyboardEvent.prototype,"char",{get:function(){return this._char}}),Object.defineProperty(b.KeyboardEvent.prototype,"alt",{get:function(){return this._alt}}),Object.defineProperty(b.KeyboardEvent.prototype,"control",{get:function(){return this._control}}),Object.defineProperty(b.KeyboardEvent.prototype,"shift",{get:function(){return this._shift}}),Object.defineProperty(b.KeyboardEvent.prototype,"command",{get:function(){return this._command}}),b.KeyboardEvent.prototype._set=function(a,b,c,d,e,f,g){this._type=a,this._key=b,this._char=c,this._alt=d,this._control=e,this._shift=f,this._command=g},b.KeyboardEvent.prototype._reset=function(){this._type=0,this._key=0,this._char=0,this._alt=!1,this._control=!1,this._shift=!1,this._command=!1},b.Keyboard=function(){this._keys={},this._controls={},this._lastKey=0,this._lastChar=0,this._event=new b.KeyboardEvent,this._initialize()},b.Keyboard.prototype.any=function(a,c){return!(a.type===b.Keyboard.UP||a.type===b.Keyboard.DOWN||c&&a.key!==c)},b.Keyboard.prototype.up=function(a,c){return!(a.type!==b.Keyboard.UP||c&&a.key!==c)},b.Keyboard.prototype.down=function(a,c){return!(a.type!==b.Keyboard.DOWN||c&&a.key!==c)},b.Keyboard.prototype.key=function(a){return this._keys[a]},Object.defineProperty(b.Keyboard.prototype,"control",{get:function(){return this._keys[b.Keyboard.CONTROL]}}),Object.defineProperty(b.Keyboard.prototype,"alt",{get:function(){return this._keys[b.Keyboard.ALT]}}),Object.defineProperty(b.Keyboard.prototype,"shift",{get:function(){return this._keys[b.Keyboard.SHIFT]}}),Object.defineProperty(b.Keyboard.prototype,"command",{get:function(){return this._keys[b.Keyboard.COMMAND_LEFT]||this._keys[b.Keyboard.COMMAND_RIGHT]}}),b.Keyboard.prototype._initialize=function(){for(var a=[33,34,35,36,37,38,39,40,45,46,47,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,8,9,12,16,17,18,20,27,91,93,144],c=0,d=a.length;d>c;++c)this._controls[a[c]]=!0;b.Browser.any&&(window.addEventListener("keydown",this._onDown.bind(this),!0),window.addEventListener("keyup",this._onUp.bind(this),!0),window.addEventListener("keypress",this._onPress.bind(this),!0))},b.Keyboard.prototype._callInput=function(a,c,d){var e=b.Render.renders,f=this._event;f._set(a,c,d,this.alt,this.control,this.shift,this.command);for(var g=0,h=e.length;h>g;++g){var i=e[g];i.root&&i.root.input(f,i)}f._reset()},b.Keyboard.prototype._onDown=function(a){var c=a.which||a.keyCode;this._keys[c]=!0,this._controls[c]?(this._lastChar=0,this._callInput(b.Keyboard.DOWN,c,this._lastChar),b.log("Press key:",c,"char:",this._lastChar)):this._lastKey=c},b.Keyboard.prototype._onPress=function(a){this._lastChar=a.charCode,this._callInput(b.Keyboard.DOWN,this._lastKey,this._lastChar),b.log("Press key:",this._lastKey,"char:",this._lastChar)},b.Keyboard.prototype._onUp=function(a){var c=a.which||a.keyCode;this._keys[c]=!1,this._callInput(b.Keyboard.UP,c,this._lastChar),b.log("Up key:",c,"char:",this._lastChar)},b.Keyboard=new b.Keyboard,b.Keyboard.UP=200,b.Keyboard.DOWN=201,b.Keyboard.A="A".charCodeAt(0),b.Keyboard.B="B".charCodeAt(0),b.Keyboard.C="C".charCodeAt(0),b.Keyboard.D="D".charCodeAt(0),b.Keyboard.E="E".charCodeAt(0),b.Keyboard.F="F".charCodeAt(0),b.Keyboard.G="G".charCodeAt(0),b.Keyboard.H="H".charCodeAt(0),b.Keyboard.I="I".charCodeAt(0),b.Keyboard.J="J".charCodeAt(0),b.Keyboard.K="K".charCodeAt(0),b.Keyboard.L="L".charCodeAt(0),b.Keyboard.M="M".charCodeAt(0),b.Keyboard.N="N".charCodeAt(0),b.Keyboard.O="O".charCodeAt(0),b.Keyboard.P="P".charCodeAt(0),b.Keyboard.Q="Q".charCodeAt(0),b.Keyboard.R="R".charCodeAt(0),b.Keyboard.S="S".charCodeAt(0),b.Keyboard.T="T".charCodeAt(0),b.Keyboard.U="U".charCodeAt(0),b.Keyboard.V="V".charCodeAt(0),b.Keyboard.W="W".charCodeAt(0),b.Keyboard.X="X".charCodeAt(0),b.Keyboard.Y="Y".charCodeAt(0),b.Keyboard.Z="Z".charCodeAt(0),b.Keyboard.ZERO="0".charCodeAt(0),b.Keyboard.ONE="1".charCodeAt(0),b.Keyboard.TWO="2".charCodeAt(0),b.Keyboard.THREE="3".charCodeAt(0),b.Keyboard.FOUR="4".charCodeAt(0),b.Keyboard.FIVE="5".charCodeAt(0),b.Keyboard.SIX="6".charCodeAt(0),b.Keyboard.SEVEN="7".charCodeAt(0),b.Keyboard.EIGHT="8".charCodeAt(0),b.Keyboard.NINE="9".charCodeAt(0),b.Keyboard.NUMPAD_0=96,b.Keyboard.NUMPAD_1=97,b.Keyboard.NUMPAD_2=98,b.Keyboard.NUMPAD_3=99,b.Keyboard.NUMPAD_4=100,b.Keyboard.NUMPAD_5=101,b.Keyboard.NUMPAD_6=102,b.Keyboard.NUMPAD_7=103,b.Keyboard.NUMPAD_8=104,b.Keyboard.NUMPAD_9=105,b.Keyboard.NUMPAD_MULTIPLY=106,b.Keyboard.NUMPAD_ADD=107,b.Keyboard.NUMPAD_ENTER=108,b.Keyboard.NUMPAD_SUBTRACT=109,b.Keyboard.NUMPAD_DECIMAL=110,b.Keyboard.NUMPAD_DIVIDE=111,b.Keyboard.F1=112,b.Keyboard.F2=113,b.Keyboard.F3=114,b.Keyboard.F4=115,b.Keyboard.F5=116,b.Keyboard.F6=117,b.Keyboard.F7=118,b.Keyboard.F8=119,b.Keyboard.F9=120,b.Keyboard.F10=121,b.Keyboard.F11=122,b.Keyboard.F12=123,b.Keyboard.F13=124,b.Keyboard.F14=125,b.Keyboard.F15=126,b.Keyboard.COLON=186,b.Keyboard.EQUALS=187,b.Keyboard.UNDERSCORE=189,b.Keyboard.QUESTION_MARK=191,b.Keyboard.TILDE=192,b.Keyboard.OPEN_BRACKET=219,b.Keyboard.BACKWARD_SLASH=220,b.Keyboard.CLOSED_BRACKET=221,b.Keyboard.QUOTES=222,b.Keyboard.BACKSPACE=8,b.Keyboard.TAB=9,b.Keyboard.CLEAR=12,b.Keyboard.ENTER=13,b.Keyboard.SHIFT=16,b.Keyboard.CONTROL=17,b.Keyboard.ALT=18,b.Keyboard.COMMAND_LEFT=91,b.Keyboard.COMMAND_RIGHT=93,b.Keyboard.CAPS_LOCK=20,b.Keyboard.ESC=27,b.Keyboard.SPACEBAR=32,b.Keyboard.PAGE_UP=33,b.Keyboard.PAGE_DOWN=34,b.Keyboard.END=35,b.Keyboard.HOME=36,b.Keyboard.ARROW_LEFT=37,b.Keyboard.ARROW_UP=38,b.Keyboard.ARROW_RIGHT=39,b.Keyboard.ARROW_DOWN=40,b.Keyboard.INSERT=45,b.Keyboard.DELETE=46,b.Keyboard.HELP=47,b.Keyboard.NUM_LOCK=144,b.Keyboard.PLUS=43,b.Keyboard.MINUS=45,b.TouchPoint=function(){this._id=0,this._position=new b.Point(0,0)},Object.defineProperty(b.TouchPoint.prototype,"id",{get:function(){return this._id}}),Object.defineProperty(b.TouchPoint.prototype,"x",{get:function(){return this._position.x}}),Object.defineProperty(b.TouchPoint.prototype,"y",{get:function(){return this._position.y}}),b.TouchPoint.prototype._set=function(a,b,c){this._id=a,this._position.set(b,c)},b.TouchPoint.prototype._reset=function(){this._id=0,this._position.set(0,0)},b.TouchList=function(){this._points=[],this._pool=[]},Object.defineProperty(b.TouchList.prototype,"length",{get:function(){return this._points.length}}),b.TouchList.prototype.item=function(a){return void 0===a&&(a=0),a>=0&&a<this._points.length?this._points[a]:void 0},b.TouchList.prototype._resize=function(a){var c,d=this._points,e=this._pool;if(d.length!==a)if(a<d.length){c=0===a?d.length:d.length-a;for(var f=d.splice(0,c);c--;)e.push(f[c])}else for(c=a-d.length;c--;)e.length?d.push(e.pop()):d.push(new b.TouchPoint)},b.TouchEvent=function(){this._type=0,this._points=new b.TouchList},Object.defineProperty(b.TouchEvent.prototype,"type",{get:function(){return this._type}}),Object.defineProperty(b.TouchEvent.prototype,"points",{get:function(){return this._points}}),b.TouchEvent.prototype._set=function(a,b,c){this._type=a;var d,e=this._points,f=0;e._resize(c.length);for(var g=0,h=c.length;h>g;++g)d=c.item(g),b.contains(d)?e.item(g-f)._set(d.id,d.x-b.x,d.y-b.y):f++;f&&e._resize(e.length-f)},b.TouchEvent.prototype._reset=function(){this._type=0,this._points._resize(0)},b.Touch=function(){this._points=new b.TouchList,this._event=new b.TouchEvent,this._initialize()},b.Touch.prototype.any=function(a){return a.type===b.Touch.UP||a.type===b.Touch.DOWN||a.type===b.Touch.MOVE},b.Touch.prototype.up=function(a){return a.type===b.Touch.UP},b.Touch.prototype.down=function(a){return a.type===b.Touch.DOWN},b.Touch.prototype.move=function(a){return a.type===b.Touch.MOVE},b.Touch.prototype._initialize=function(){b.Browser.any&&("ontouchstart"in document.documentElement?(window.addEventListener("touchstart",this._onTouchStart.bind(this),!0),window.addEventListener("touchend",this._onTouchEnd.bind(this),!0),window.addEventListener("touchmove",this._onTouchMove.bind(this),!0),window.addEventListener("touchleave",this._onTouchLeave.bind(this),!0),window.addEventListener("touchcancel",this._onTouchCancel.bind(this),!0)):window.PointerEvent?(window.addEventListener("pointerdown",this._onPointerDown.bind(this),!0),window.addEventListener("pointermove",this._onPointerMove.bind(this),!0),window.addEventListener("pointerup",this._onPointerUp.bind(this),!0)):window.MSPointerEvent&&(window.addEventListener("MSPointerDown",this._onPointerDown.bind(this),!0),window.addEventListener("MSPointerMove",this._onPointerMove.bind(this),!0),window.addEventListener("MSPointerUp",this._onPointerUp.bind(this),!0)))},b.Touch.prototype._updateTouch=function(a){var b,c=a.touches,d=this._points;d._resize(c.length);for(var e=0,f=c.length;f>e;++e)b=c.item(e),d.item(e)._set(b.identifier,b.clientX,b.clientY)},b.Touch.prototype._callInput=function(a){for(var c=b.Render.renders,d=this._event,e=!1,f=0,g=c.length;g>f;++f){var h=c[f];h.root&&(d._set(a,h.bounds,this._points),d.points.length&&(h.root.input(d,h),e=!0))}return d._reset(),e},b.Touch.prototype._onPointerDown=function(a){if(void 0===a.pointerType||"touch"===a.pointerType){var c=this._points;c._resize(c.length+1),c.item(c.length-1)._set(a.pointerId,a.clientX,a.clientY),this._callInput(b.Touch.DOWN)&&a.preventDefault()}},b.Touch.prototype._onPointerUp=function(a){if(void 0===a.pointerType||"touch"===a.pointerType){for(var c=this._points,d=0,e=c.length-1;e>d;++d){var f=c.item(d);c.item(d)._set(f.id,f.x,f.y)}c._resize(c.length-1),this._callInput(b.Touch.UP)&&a.preventDefault()}},b.Touch.prototype._onPointerMove=function(a){if(void 0===a.pointerType||"touch"===a.pointerType){for(var c=this._points,d=0,e=c.length;e>d;++d){var f=c.item(d);if(f.id===a.pointerId){f._set(f.id,a.clientX,a.clientY);break}}this._callInput(b.Touch.MOVE)&&a.preventDefault()}},b.Touch.prototype._onTouchStart=function(a){this._updateTouch(a),this._callInput(b.Touch.DOWN)&&a.preventDefault()},b.Touch.prototype._onTouchEnd=function(a){this._updateTouch(a),this._callInput(b.Touch.UP)&&a.preventDefault()},b.Touch.prototype._onTouchMove=function(a){this._updateTouch(a),this._callInput(b.Touch.MOVE)&&a.preventDefault()},b.Touch.prototype._onTouchLeave=function(a){this._updateTouch(a),this._callInput(b.Touch.UP)&&a.preventDefault()},b.Touch.prototype._onTouchCancel=function(a){this._updateTouch(a),this._callInput(b.Touch.UP)&&a.preventDefault()},b.Touch=new b.Touch,b.Touch.UP=300,b.Touch.DOWN=301,b.Touch.MOVE=302,b.Object=function(){this._parent=null},Object.defineProperty(b.Object.prototype,"parent",{get:function(){return this._parent},set:function(a){this._parent!==a&&(this.removeSelf(),a.addChild(this))}}),Object.defineProperty(b.Object.prototype,"length",{get:function(){return this._children?this._children.length:0}}),b.Object.prototype.addChild=function(a,c){this._children||(this._children=[]);var d=this._children;return c=c||d.length,0>c||c>d.length?b.error("The index [",c,"] out of bounds"):(c===d.length?d.push(a):d.splice(c,0,a),a._parent=this,a)},b.Object.prototype.removeChild=function(a){if(!this._children)return!1;var c=this._children,d=a||0;if(a instanceof b.Object){if(d=c.indexOf(a),-1===d)return!1}else{if(0>d||d>=c.length)return!1;a=c[d]}return c.splice(d,1),a._parent=null,!0},b.Object.prototype.removeAll=function(){if(!this._children)return!1;for(var a=this._children,b=0,c=a.length;c>b;++b)a[b]._parent=null;return a.length=0,!0},b.Object.prototype.removeSelf=function(){return this._parent?(this._parent.remove(this),!0):!0},b.Object.prototype.getChild=function(a){return!this._children||(a=a||0,0>a||a>=this._children.length)?void 0:this._children[a]},b.Object.prototype.addComponent=function(a){var c=a.id;if(!c)return b.error("Component have no property name");if("_"===c.charCodeAt(0))return b.error('Component should not have name with first character "_" [',c,"]");if(this[c])return b.error("Component with name [",c,"] already exist");var d=this[c]=new a(this);return a.prototype.update&&(this._updates?this._updates.push(d):this._updates=[d]),a.prototype.render&&(this._renders?this._renders.push(d):this._renders=[d]),a.prototype.input&&(this._inputs?this._inputs.push(d):this._inputs=[d]),!0},b.Object.prototype.removeComponent=function(a){var b=this[a.id];if(!b)return!1;b.object=null;var c;return this._updates&&(c=this._updates.indexOf(b),-1!==c&&this._updates.splice(c,1)),this._renders&&(c=this._renders.indexOf(b),-1!==c&&this._renders.splice(c,1)),this._inputs&&(c=this._inputs.indexOf(b),-1!==c&&this._inputs.splice(c,1)),delete this[a.id],!0},b.Object.prototype.destroy=function(){this.removeAll(),this.removeSelf();var a,b;if(b=this._updates){for(a=b.length;a--;)this[b[a]]=null;b.length=0}if(b=this._renders){for(a=b.length;a--;)this[b[a]]=null;b.length=0}if(b=this._inputs){for(a=b.length;a--;)this[b[a]]=null;b.length=0}},b.Object.prototype.update=function(a,b){var c,d,e;if(this._updates)for(e=this._updates,c=0,d=e.length;d>c;++c)e[c].update(a,b);if(e=this._children,e&&e.length)for(c=0,d=e.length;d>c;++c)e[c].update(a,b)},b.Object.prototype.render=function(a,b){var c,d,e;if(this._renders)for(e=this._renders,c=0,d=e.length;d>c;++c)e[c].render(a,b);if(e=this._children,e&&e.length)for(c=0,d=e.length;d>c;++c)e[c].render(a,b)},b.Object.prototype.input=function(a,b){var c,d,e;if(this._inputs)for(e=this._inputs,c=0,d=e.length;d>c;++c)e[c].input(a,b);if(e=this._children,e&&e.length)for(c=0,d=e.length;d>c;++c)e[c].input(a,b)},b.Object.create=function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments));for(var c=new b.Object,d=0,e=a.length;e>d;++d)c.addComponent(a[d]);return c},b.Sprite=function(a){this.object=a,this.texture=null,this.frame=new b.Rect,this.alpha=1,this.tint=b.Color.WHITE.clone(),this.blend=b.Render.BLEND_NORMAL},b.Sprite.id="sprite",b.Sprite.prototype.render=function(a){this.object&&this.object.transform&&this.texture&&this.texture.ready&&this.alpha&&(a.transform=this.object.transform.matrix,a.alpha=this.alpha,a.blend=this.blend,this.frame.width&&this.frame.height?a.texture(this.texture,this.frame,this.tint):a.texture(this.texture,null,this.tint))},b.Transform=function(a){this.object=a,this.position=new b.Point(0,0),this.scale=new b.Point(1,1),this.pivot=new b.Point(0,0),this.rotation=0,this._matrix=new b.Matrix},b.Transform.id="transform",Object.defineProperty(b.Transform.prototype,"matrix",{get:function(){return this._matrix}}),b.Transform.prototype.update=function(){this._matrix.transform(this.position,this.scale,this.rotation,this.pivot,this.object&&this.object.parent&&this.object.parent.transform?this.object.parent.transform._matrix:b.Matrix.IDENTITY)},b.Transform.prototype.setPosition=function(a,b){this.position.set(a,b)},b.Transform.prototype.setScale=function(a,b){this.scale.set(a,b)},b.Transform.prototype.setPivot=function(a,b){this.pivot.set(a,b)},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.uno=b):"undefined"!=typeof define&&define.amd?define(b):a.uno=b}.call(this);