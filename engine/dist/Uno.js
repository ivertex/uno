/*! Uno - v0.0.2 - 2015-03-30
* Copyright (c) 2015 Ruslan Murashko; Licensed  */
!function(){if(window){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}}(),function(){"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var a=Array.prototype.slice;return function(b){function c(){var f=e.concat(a.call(arguments));d.apply(this instanceof c?this:b,f)}var d=this,e=a.call(arguments,1);if("function"!=typeof d)throw new TypeError;return c.prototype=function f(a){return a&&(f.prototype=a),this instanceof f?void 0:new f}(d.prototype),c}}())}(),function(){var a=this,b=b||{};b.time=function(){return window&&window.perfomance?window.perfomance.now():Date.now()},b.log=function(){return b.Browser.any&&window.console&&console.log("%cUno: "+Array.prototype.slice.call(arguments).join(" "),"color: blue"),!0},b.warn=function(){return b.Browser.any&&window.console&&console.warn("%cUno: "+Array.prototype.slice.call(arguments).join(" "),"color: orange"),!1},b.error=function(){return b.Browser.any&&window.console&&console.error("Uno: "+Array.prototype.slice.call(arguments).join(" ")),!1},b.Utils={},b.Arc=function(a,b,c,d,e,f){this.x=0,this.y=0,this.radius=0,this.startAngle=0,this.endAngle=0,this.antiClockwise=!1,void 0!==a&&this.set(a,b,c,d,e,f)},b.Arc.prototype.clone=function(){return new b.Arc(this)},b.Arc.prototype.set=function(a,c,d,e,f,g){return void 0!==a&&void 0!==a.x?(this.x=a.x,this.y=a.y,this.radius=a.radius,this.startAngle=a.startAngle,this.endAngle=a.endAngle,this.antiClockwise=a.antiClockwise,this):(this.x=a||0,this.y=c||0,this.radius=d||0,this.startAngle=e||0,this.endAngle=f||b.Math.TWO_PI,this.antiClockwise=g||!1,this)},b.Arc.prototype.equal=function(a){return this.x===a.x&&this.y===a.y&&this.radius===a.radius&&this.startAngle===a.startAngle&&this.endAngle===a.endAngle&&this.antiClockwise===a.antiClockwise},b.Arc.prototype.contains=function(a,b){return this.radius<=0?!1:void 0!==a.x?(this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y)<=this.radius*this.radius:(this.x-a)*(this.x-a)+(this.y-b)*(this.y-b)<=this.radius*this.radius},b.Circle=function(a,b,c){this.x=0,this.y=0,this.radius=0,void 0!==a&&this.set(a,b,c)},b.Circle.prototype.clone=function(){return new b.Circle(this)},b.Circle.prototype.set=function(a,b,c){return void 0!==a&&void 0!==a.x?(this.x=a.x,this.y=a.y,this.radius=a.radius,this):(this.x=a||0,this.y=b||0,this.radius=c||0,this)},b.Circle.prototype.equal=function(a){return this.x===a.x&&this.y===a.y&&this.radius===a.radius},b.Circle.prototype.contains=function(a,b){return this.radius<=0?!1:void 0!==a.x?(this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y)<=this.radius*this.radius:(this.x-a)*(this.x-a)+(this.y-b)*(this.y-b)<=this.radius*this.radius},b.Ellipse=function(a,b,c,d){this.x=0,this.y=0,this.width=0,this.height=0,void 0!==a&&this.set(a,b,c,d)},b.Ellipse.prototype.clone=function(){return new b.Ellipse(this)},b.Ellipse.prototype.set=function(a,b,c,d){if(void 0!==a){if(void 0!==a.width)return this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this;if(void 0!==a.x)return this.x=a.x,this.y=a.y,this.width=b.x,this.height=b.y,this}return this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0,this},b.Ellipse.prototype.equal=function(a){return a.radius?this.x===a.x&&this.y===a.y&&this.width===a.radius&&this.height===a.radius:this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height},b.Ellipse.prototype.contains=function(a,b){return this.width<=0||this.height<=0?!1:void 0!==a.x?(a.x-this.x)/this.width*((a.x-this.x)/this.width)+(a.y-this.y)/this.height*((a.y-this.y)/this.height)<=1:(a-this.x)/this.width*((a-this.x)/this.width)+(b-this.y)/this.height*((b-this.y)/this.height)<=1},b.Line=function(a,b,c,d){this.x1=0,this.y1=0,this.x2=0,this.y2=0,void 0!==a&&this.set(a,b,c,d)},b.Line.prototype.clone=function(){return new b.Line(this.x1,this.y1,this.x2,this.y2)},b.Line.prototype.set=function(a,b,c,d){return void 0!==a&&void 0!==a.x1?(this.x1=a.x1,this.y1=a.y1,this.x2=a.x2,this.y2=a.y2,this):void 0!==a&&void 0!==a.x?(this.x1=a.x,this.y1=a.y,this.x2=b.x,this.y2=b.y,this):(this.x1=a||0,this.y1=b||0,this.x2=c||0,this.y2=d||0,this)},b.Line.prototype.equal=function(a){return this.x1===a.x1&&this.y1===a.y1&&this.x2===a.x2&&this.y2===a.y2},b.Line.prototype.contains=function(a,b){return void 0!==a.x?a.x>=Math.min(this.x1,this.x2)&&a.x<=Math.max(this.x1,this.x2)&&a.y>=Math.min(this.y1,this.y2)&&a.y<=Math.max(this.y1,this.y2)&&(a.x-this.x1)*(this.y2-this.y1)===(this.x2-this.x1)*(a.y-this.y1):a>=Math.min(this.x1,this.x2)&&a<=Math.max(this.x1,this.x2)&&b>=Math.min(this.y1,this.y2)&&b<=Math.max(this.y1,this.y2)&&(a-this.x1)*(this.y2-this.y1)===(this.x2-this.x1)*(b-this.y1)},b.Matrix=function(a,b,c,d,e,f){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this._rotation=0,this._sin=0,this._cos=1,void 0!==a&&this.set(a,b,c,d,e,f)},b.Matrix.prototype.clone=function(){return new b.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)},b.Matrix.prototype.set=function(a,b,c,d,e,f){return void 0!==a&&void 0!==a.a?(this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.tx=a.tx,this.ty=a.ty,this):(this.a=a||1,this.b=b||0,this.c=c||0,this.d=d||1,this.tx=e||0,this.ty=f||0,this)},b.Matrix.prototype.reset=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},b.Matrix.prototype.equal=function(a){return this.a===a.a&&this.b===a.b&&this.c===a.c&&this.d===a.d&&this.tx===a.tx&&this.ty===a.ty},b.Matrix.prototype.identity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.tx&&0===this.ty},b.Matrix.prototype.array=function(){var a=this._array;return a||(a=this._array=new Float32Array(6)),a[0]=this.a,a[1]=this.b,a[2]=this.c,a[3]=this.d,a[4]=this.tx,a[5]=this.ty,a},b.Matrix.prototype.transform=function(a,c,d,e,f){this._rotation!==d&&(this._sin=Math.sin(d),this._cos=Math.cos(d),this._rotation=d),f=f||b.Matrix.IDENTITY;var g=this._cos*c.x,h=-this._sin*c.y,i=this._sin*c.x,j=this._cos*c.y,k=a.x-g*e.x-e.y*h,l=a.y-j*e.y-e.x*i,m=f.a,n=f.b,o=f.c,p=f.d;return this.a=m*g+n*i,this.b=m*h+n*j,this.tx=m*k+n*l+f.tx,this.c=o*g+p*i,this.d=o*h+p*j,this.ty=o*k+p*l+f.ty,this},b.Matrix.prototype.apply=function(a){var b=this.a*a.x+this.b*a.y+this.tx;return a.y=this.c*a.x+this.d*a.y+this.ty,a.x=b,this},b.Matrix.prototype.applyInverse=function(a){var b=1/(this.a*this.d+this.c*-this.b),c=this.d*b*a.x+-this.c*b*a.y+(this.ty*this.c-this.tx*this.d)*b;return a.y=this.a*b*a.y+-this.b*b*c+(-this.ty*this.a+this.tx*this.b)*b,a.x=c,this},b.Matrix.prototype.translate=function(a,b){return void 0!==a.x?(this.tx+=a.x,this.ty+=a.y,this):(this.tx+=a,this.ty+=b||a,this)},b.Matrix.prototype.scale=function(a,b){return this.a*=a,this.d*=b||a,this.c*=a,this.b*=b||a,this.tx*=a,this.ty*=b||a,this},b.Matrix.prototype.rotate=function(a,b,c){var d=Math.cos(a),e=Math.sin(a),f=this.a,g=this.c,h=this.tx;return b&&c&&(h=b-b*d+c*e,this.ty=c-b*e-c*d),this.a=f*d-this.b*e,this.b=f*e+this.b*d,this.c=g*d-this.d*e,this.d=g*e+this.d*d,this.tx=h*d-this.ty*e,this.ty=h*e+this.ty*d,this},b.Matrix.prototype.append=function(a){var b=this.a,c=this.b,d=this.c,e=this.d;return this.a=a.a*b+a.b*d,this.b=a.a*c+a.b*e,this.c=a.c*b+a.d*d,this.d=a.c*c+a.d*e,this.tx=a.tx*b+a.ty*d+this.tx,this.ty=a.tx*c+a.ty*e+this.ty,this},b.Matrix.prototype.prepend=function(a){var b=this.tx;if(1!==a.a||0!==a.b||0!==a.c||1!==a.d){var c=this.a,d=this.c;this.a=c*a.a+this.b*a.c,this.b=c*a.b+this.b*a.d,this.c=d*a.a+this.d*a.c,this.d=d*a.b+this.d*a.d}return this.tx=b*a.a+this.ty*a.c+a.tx,this.ty=b*a.b+this.ty*a.d+a.ty,this},b.Matrix.prototype.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=a*d-b*c;return this.a=d/f,this.b=-b/f,this.c=-c/f,this.d=a/f,this.tx=(c*this.ty-d*e)/f,this.ty=-(a*this.ty-b*e)/f,this},b.Matrix.concat=function(a,b,c){var d=a.a,e=a.b,f=a.c,g=a.d,h=a.tx,i=a.ty,j=b.a,k=b.b,l=b.c,m=b.d,n=b.tx,o=b.ty;c.a=j*d+k*f,c.b=j*e+k*g,c.tx=j*h+k*i+n,c.c=l*d+m*f,c.d=l*e+m*g,c.ty=l*h+m*i+o},b.Matrix.IDENTITY=new b.Matrix,b.Point=function(a,b){this.x=0,this.y=0,void 0!==a&&this.set(a,b)},b.Point.prototype.clone=function(){return new b.Point(this)},b.Point.prototype.set=function(a,b){return void 0===a?(this.x=this.y=0,this):void 0!==a.x?(this.x=a.x,this.y=a.y,this):(this.x=a||0,this.y=void 0===b?this.x:b,this)},b.Point.prototype.add=function(a,b){return void 0===a?this:void 0!==a.x?(this.x+=a.x,this.y+=a.y,this):(this.x+=a,this.y+=void 0===b?a:b,this)},b.Point.prototype.subtract=function(a,b){return void 0===a?this:void 0!==a.x?(this.x-=a.x,this.y-=a.y,this):(this.x-=a,this.y-=void 0===b?a:b,this)},b.Point.prototype.multiply=function(a,b){return void 0===a?(this.x=this.y=0,this):void 0!==a.x?(this.x*=a.x,this.y*=a.y,this):(this.x*=a,this.y*=void 0===b?a:b,this)},b.Point.prototype.divide=function(a,b){return void 0===a?this:void 0!==a.x?(this.x/=a.x,this.y/=a.y,this):(this.x/=a,this.y/=void 0===b?a:b,this)},b.Point.prototype.normalize=function(){if(this.zero())return this;var a=Math.sqrt(this.x*this.x+this.y*this.y);return this.x/=a,this.y/=a,this},b.Point.prototype.invert=function(){return this.x=-this.x,this.y=-this.y,this},b.Point.prototype.clamp=function(a,b){return this.x<a?this.x=a:this.x>b&&(this.x=b),this.y<a?this.y=a:this.y>b&&(this.y=b),this},b.Point.prototype.distance=function(a,b){return Math.sqrt(void 0===a?this.x*this.x+this.y*this.y:void 0!==a.x?(a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y):(a-this.x)*(a-this.x)+(b-this.y)*(b-this.y))},b.Point.prototype.angle=function(a,b){return void 0===a?Math.atan2(-this.y,-this.x):void 0!==a.x?Math.atan2(a.y-this.y,a.x-this.x):Math.atan2(b-this.y,a-this.x)},b.Point.prototype.equal=function(a,b){return void 0!==a.x?this.x===a.x&&this.y===a.y:this.x===a&&this.y===b},b.Point.prototype.zero=function(){return 0===this.x&&0===this.y},b.Poly=function(a){this.points=[],this.set(void 0!==a[0]||void 0!==a.points?a:Array.prototype.slice.call(arguments))},b.Poly.prototype.clone=function(){return new b.Poly(this.points)},b.Poly.prototype.set=function(a){if(void 0!==a.points)return this.points=a.slice(),this;if(a[0]||(a=Array.prototype.slice.call(arguments)),"number"==typeof a[0]){for(var c=[],d=0,e=a.length;e>d;d+=2)c.push(new b.Point(a[d],a[d+1]));this.points=c}else this.points=a.slice();return this},b.Poly.prototype.equal=function(a){if(this.points.length!==a.points.length)return!1;for(var b=this.points,c=a.points,d=b.length;--d;)if(b[d].x!==c[d].x||b[d].y!==c[d].y)return!1;return!0},b.Poly.prototype.closed=function(){return this.points.length<3?!1:this.points[0].equal(this.points[this.points.length-1])},b.Poly.prototype.contains=function(a,b){var c=!1,d=this.points,e=a,f=b;void 0!==a.x&&(e=a.x,f=a.y);for(var g=0,h=this.points.length,i=h-1;h>g;i=++g){var j=d[g],k=d[i];j.y>f!=k.y>f&&e<(k.x-j.x)*(f-j.y)/(k.y-j.y)+j.x&&(c=!c)}return c},b.Rect=function(a,b,c,d){this.x=0,this.y=0,this.width=0,this.height=0,void 0!==a&&this.set(a,b,c,d)},b.Rect.prototype.clone=function(){return new b.Rect(this.x,this.y,this.width,this.height)},b.Rect.prototype.set=function(a,b,c,d){if(void 0!==a){if(void 0!==a.width)return this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this;if(void 0!==a.x)return this.x=a.x,this.y=a.y,this.width=b.x,this.height=b.y,this}return this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0,this},b.Rect.prototype.equal=function(a){return this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height},b.Rect.prototype.contains=function(a,b){return this.width<=0||this.height<=0?!1:void 0!==a.x?this.x<=a.x&&this.y<=a.y&&this.x+this.width>=a.x&&this.y+this.height>=a.y:this.x<=a&&this.y<=b&&this.x+this.width>=a&&this.y+this.height>=b},b.Browser=function(){this.any=!1,this.version=0,this.mobile=!1,this.opera=!1,this.silk=!1,this.ie=!1,this.chrome=!1,this.safari=!1,this.android=!1,this.firefox=!1,this._initialize()},b.Browser.prototype._initialize=function(){if(navigator&&navigator.userAgent){var a,b=navigator.userAgent,c=[{name:"opera",exp:/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,version:3,mobile:!0},{name:"opera",exp:/\s(opr)\/((\d+)?[\w\.]+)/i,version:3,mobile:!1},{name:"opera",exp:/(opera).+version\/((\d+)?[\w\.]+)/i,version:3,mobile:!1},{name:"silk",exp:/(silk)\/((\d+)?[\w\.]+)/i,version:3,mobile:!0},{name:"ie",exp:/(iemobile)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,version:3,mobile:!0},{name:"ie",exp:/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,version:3,mobile:!1},{name:"ie",exp:/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i,version:3,mobile:!1},{name:"chrome",exp:/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+))/i,version:3,mobile:!1},{name:"chrome",exp:/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i,version:3,mobile:!0},{name:"android",exp:/(android).+version\/((\d+)?[\w\.]+)/i,version:2,mobile:!0},{name:"safari",exp:/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i,version:2,mobile:!0},{name:"safari",exp:/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i,version:2,mobile:!1},{name:"firefox",exp:/(firefox)\/((\d+)?[\w\.-]+)/i,version:3,mobile:!1}];this.any=!0;for(var d=0,e=c.length;e>d;++d){var f=c[d];if(a=f.exp.exec(b))return this[f.name]=!0,this.version=parseInt(a[f.version]),void(this.mobile=f.mobile)}}else this.any=!1},b.Browser=new b.Browser,b.Capabilities=function(){this.canvas=!1,this.webgl=!1,this.opengl=!1,this._initialize()},b.Capabilities.prototype._checkCanvas=function(){try{var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}catch(b){return!1}},b.Capabilities.prototype._checkWebgl=function(){try{var a=document.createElement("canvas");return!(!window.WebGLRenderingContext||!a.getContext("webgl")&&!a.getContext("experimental-webgl"))}catch(b){return!1}},b.Capabilities.prototype._initialize=function(){window&&(this.canvas=this._checkCanvas(),this.webgl=this._checkWebgl())},b.Capabilities=new b.Capabilities,b.Device=function(){this.iPhone=!1,this.iPad=!1,this.appleTV=!1,this.windowsPhone=!1,this.blackberry=!1,this.kindle=!1,this.firePhone=!1,this.ouya=!1,this.nintendo=!1,this.playstation=!1,this.xbox=!1,this._initialize()},b.Device.prototype._initialize=function(){if(navigator&&navigator.userAgent)for(var a,b=navigator.userAgent.toLowerCase(),c=[{name:"iPhone",exp:/\((iphone);.+(apple)/i,mobile:!0},{name:"iPad",exp:/\((ipad);.+(apple)/i,mobile:!0},{name:"appleTV",exp:/(apple\s{0,1}tv)/i,mobile:!0},{name:"windowsPhone",exp:/(windows\sphone)/i,mobile:!0},{name:"blackberry",exp:/(blackberry)[\s-]?(\w+)/i,mobile:!0},{name:"blackberry",exp:/\(bb10;\s(\w+)/i,mobile:!0},{name:"kindle",exp:/(kindle)\/([\w\.]+)/i,mobile:!0},{name:"kindle",exp:/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i,mobile:!0},{name:"firePhone",exp:/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i,mobile:!0},{name:"ouya",exp:/\s(ouya)\s/i,mobile:!1},{name:"nintendo",exp:/(nintendo)\s([wids3u]+)/i,mobile:!0},{name:"playstation",exp:/(playstation\s[3portablevi]+)/i,mobile:!1},{name:"xbox",exp:/[\s\(;](xbox(?:\sone)?)[\s\);]/i,mobile:!1}],d=0,e=c.length;e>d;++d){var f=c[d];if(a=f.exp.exec(b))return this[f.name]=!0,void(this.mobile=f.mobile)}},b.Device=new b.Device,b.Os=function(){this.mobile=!1,this.name="",this.version="",this.windows=!1,this.linux=!1,this.android=!1,this.macOS=!1,this.iOS=!1,this.blackberry=!1,this.tizen=!1,this.sailfishOS=!1,this.firefoxOS=!1,this.chromiumOS=!1,this._initialize()},b.Os.prototype._initialize=function(){if(navigator&&navigator.userAgent)for(var a,b=navigator.userAgent,c=[{name:"windows",exp:/microsoft\s(windows)\s(vista|xp)/i,version:2,mobile:!1},{name:"windows",exp:/(windows)\snt\s([\w\s\.]+);/i,version:2,mobile:!1},{name:"windows",exp:/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i,version:2,mobile:!0},{name:"blackberry",exp:/\((bb)(10);/i,version:2,mobile:!0},{name:"blackberry",exp:/(blackberry)\w*\/?([\w\.]+)*/i,version:2,mobile:!0},{name:"tizen",exp:/(tizen)[\/\s]([\w\.]+)/i,version:2,mobile:!0},{name:"android",exp:/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,version:2,mobile:!0},{name:"sailfishOS",exp:/linux;.+(sailfish);/i,version:2,mobile:!1},{name:"firefoxOS",exp:/mozilla.+\(mobile;.+gecko.+firefox/i,version:2,mobile:!1},{name:"chromiumOS",exp:/(cros)\s[\w]+\s([\w\.]+\w)/i,version:2,mobile:!1},{name:"linux",exp:/(mint)[\/\s\(]?(\w+)*/i,version:2,mobile:!1},{name:"linux",exp:/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,version:2,mobile:!1},{name:"linux",exp:/(hurd|linux)\s?([\w\.]+)*/i,version:2,mobile:!1},{name:"linux",exp:/(gnu)\s?([\w\.]+)*/i,version:2,mobile:!1},{name:"linux",exp:/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i,version:2,mobile:!1},{name:"iOS",exp:/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i,version:2,mobile:!0},{name:"macOS",exp:/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,version:2,mobile:!1},{name:"macOS",exp:/(macintosh|mac(?=_powerpc)\s)/i,version:!1,mobile:!1}],d=0,e=c.length;e>d;++d){var f=c[d];if(a=f.exp.exec(b))return this[f.name]=!0,this.name=a[1],f.version!==!1&&a[f.version]&&(this.version=a[f.version].replace(/_/g,".")),void(this.mobile=f.mobile)}},b.Os=new b.Os,b.Screen=function(){this.ratio=1,this.depth=0,this.width=0,this.height=0,this.availWidth=0,this.availHeight=0,this.scrollX=0,this.scrollY=0,this._initialize()},b.Screen.prototype._initialize=function(){var a=this;if(window&&(this.ratio=window.devicePixelRatio||1,window.screen&&(this.width=window.screen.width,this.height=window.screen.height,this.depth=window.screen.pixelDepth),document)){var c=function(){a.availWidth=document.documentElement.clientWidth,a.availHeight=document.documentElement.clientHeight,(b.Browser.chrome||b.Browser.safari||b.Browser.opera)&&(a.availHeight-=4)},d=function(){a.scrollX=window.pageXOffset,a.scrollY=window.pageYOffset};window.addEventListener("resize",c,!0),window.addEventListener("scroll",d,!0),c(),d()}},b.Screen=new b.Screen,b.Color=function(a,b,c,d){this._r=1,this._g=1,this._b=1,this._a=1,this._dirty=!0,this._hex=0,this._cssHex="",this._cssRGBA="",this._packedABGR=0,this.set(a,b,c,d)},b.Color.prototype.set=function(a,b,c,d){return void 0!==a&&void 0===b?void 0!==a.r?(this._r=a.r,this._g=a.g,this._b=a.b,this._a=a.a,this._dirty=!0,this):(this.hex=a,this._dirty=!0,this):(this.r=void 0===a?1:a,this.g=void 0===b?1:b,this.b=void 0===c?1:c,this.a=void 0===d?1:d,this._dirty=!0,this)},b.Color.prototype.equal=function(a,b,c,d){return void 0===b?void 0!==a.r?this._r===a.r&&this._g===a.g&&this._b===a.b&&this._a===a.a:this.hex===a:this._r===a&&this._g===b&&this._b===c&&this._a===d},b.Color.prototype.clone=function(){return new b.Color(this)},b.Color.prototype.quantize=function(a){return this._r=Math.round(this._r*a)/a,this._g=Math.round(this._g*a)/a,this._b=Math.round(this._b*a)/a,this._dirty=!0,this},Object.defineProperty(b.Color.prototype,"r",{get:function(){return this._r},set:function(a){void 0!==a&&this._r!==a&&(0>a&&(a=0),a>1&&(a=1),this._r=a,this._dirty=!0)}}),Object.defineProperty(b.Color.prototype,"g",{get:function(){return this._g},set:function(a){void 0!==a&&this._g!==a&&(0>a&&(a=0),a>1&&(a=1),this._g=a,this._dirty=!0)}}),Object.defineProperty(b.Color.prototype,"b",{get:function(){return this._b},set:function(a){void 0!==a&&this._b!==a&&(0>a&&(a=0),a>1&&(a=1),this._b=a,this._dirty=!0)}}),Object.defineProperty(b.Color.prototype,"a",{get:function(){return this._a},set:function(a){void 0!==a&&this._a!==a&&(0>a&&(a=0),a>1&&(a=1),this._a=a,this._dirty=!0)}}),Object.defineProperty(b.Color.prototype,"hex",{get:function(){return this._dirty&&(this._hex=(255*this._r<<16)+(255*this._g<<8)+255*this._b),this._hex},set:function(a){this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,this.a=1,this._dirty=!0}}),Object.defineProperty(b.Color.prototype,"cssHex",{get:function(){return this._dirty&&(this._cssHex="#"+("00000"+(0|this.hex).toString(16)).substr(-6)),this._cssHex},set:function(a){this.hex=parseInt(a.substr(1),16)}}),Object.defineProperty(b.Color.prototype,"cssRGBA",{get:function(){return this._dirty&&(this._cssRGBA="rgba("+Math.floor(255*this._r)+","+Math.floor(255*this._g)+","+Math.floor(255*this._b)+","+this._a+")"),this._cssRGBA}}),Object.defineProperty(b.Color.prototype,"packedABGR",{get:function(){return this._dirty&&(this._packedABGR=255*this._a<<24|255*this._b<<16|255*this._g<<8|255*this._r),this._packedABGR}}),b.Color.TRANSPARENT=new b.Color(0,0,0,0),b.Color.WHITE=new b.Color(1,1,1),b.Color.BLACK=new b.Color(0,0,0),b.Color.RED=new b.Color(1,0,0),b.Color.GREEN=new b.Color(0,1,0),b.Color.BLUE=new b.Color(0,0,1),b.Texture=function(a,c){return this.id=b.Texture._uid++,this.scaleMode=b.Render.SCALE_DEFAULT,this._width=0,this._height=0,this._ready=!1,this._url=null,this._extensions={},a&&c?b.Browser.any?(this._width=a,this._height=c,this._pot=b.Math.isPOT(a)&&b.Math.isPOT(c),void(this._ready=!0)):void b.error("Only browsers currently supported"):void 0},b.Texture._uid=0,b.Texture.prototype.load=function(a,c,d){return this.destroy(),b.Browser.any?(b.CanvasTexture.get(this).load(a,this._onLoad.bind(this,c),d),this):void b.error("Only browsers currently supported")},b.Texture.prototype.destroy=function(){for(var a in this._extensions)this._extensions[a].destroy();this.scaleMode=b.Render.SCALE_DEFAULT,this._pot=!1,this._ready=!1,this._url=null,this._extensions={}},Object.defineProperty(b.Texture.prototype,"width",{get:function(){return this._width}}),Object.defineProperty(b.Texture.prototype,"height",{get:function(){return this._height}}),Object.defineProperty(b.Texture.prototype,"ready",{get:function(){return this._ready}}),Object.defineProperty(b.Texture.prototype,"url",{get:function(){return this._url}}),Object.defineProperty(b.Texture.prototype,"pot",{get:function(){return this._pot}}),b.Texture.prototype._onLoad=function(a,c,d,e,f){return d?(this._width=e,this._height=f,this._pot=b.Math.isPOT(e)&&b.Math.isPOT(f),this._url=c,this._ready=!0,void(a&&a(this))):b.error("Can't load image","[",c,"]")},b.Shape=function(){this.items=[]},b.Shape.prototype.add=function(a,b,c,d,e,f,g){return this.items.push({matrix:a.identity()?null:a.clone(),type:b,shape:c,fillColor:d?d.clone():null,lineColor:e?e.clone():null,lineWidth:f,blendMode:g}),this},b.Shape.POINT=0,b.Shape.LINE=1,b.Shape.RECT=2,b.Shape.CIRCLE=3,b.Shape.ELLIPSE=4,b.Shape.ARC=5,b.Shape.POLY=6,b.Render={RENDER_CANVAS:1,RENDER_WEBGL:2,SCALE_DEFAULT:0,SCALE_LINEAR:0,SCALE_NEAREST:1,BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_MULTIPLY:3,BLEND_SCREEN:4,DEFAULT_SETTINGS:{antialias:!0,transparent:!1,autoClear:!0,clearColor:b.Color.WHITE.clone(),width:0,height:0,fps:60,ups:60,canvas:null,contextMenu:!1},DEFAULT_GRAPHICS:{fillColor:b.Color.WHITE.clone(),lineColor:b.Color.BLACK.clone(),lineWidth:1},renders:{},_uid:0},b.Render.create=function(a){a=a||{};var c={},d=a.mode||!1;if(b.Browser.any){var e=b.Render.DEFAULT_SETTINGS;if(c.antialias=a.antialias||e.antialias,c.transparent=a.transparent||e.transparent,c.autoClear=a.autoClear||e.autoClear,c.clearColor=a.clearColor||e.clearColor.clone(),c.width=a.width||e.width||b.Screen.availWidth,c.height=a.height||e.height||b.Screen.availHeight,c.fps=0===a.fps?0:a.fps||e.fps,c.ups=0===a.ups?0:a.ups||e.ups,c.contextMenu=a.contextMenu||e.contextMenu,a.canvas)c.canvas=a.canvas;else{var f=document.createElement("canvas");a.containerId?document.getElementById(a.containerId).appendChild(f):a.container?a.container.appendChild(f):document.body.appendChild(f),c.canvas=f}return d?d===b.Render.RENDER_WEBGL?new b.WebglRender(c):new b.CanvasRender(c):b.Capabilities.webgl?new b.WebglRender(c):new b.CanvasRender(c)}return b.error("Only browsers currently supported")},b.CanvasGraphics=function(a){this._render=a,this._shape=null,this._shapeWorldMatrix=new b.Matrix,this._shapeTempMatrix=new b.Matrix;var c=b.Render.DEFAULT_GRAPHICS;this._currentFillColor=c.fillColor.clone(),this._currentLineColor=c.lineColor.clone(),this._currentLineWidth=c.lineWidth},b.CanvasGraphics.prototype.destroy=function(){this._render=null,this._shape=null,this._shapeWorldMatrix=null,this._shapeTempMatrix=null,this._currentFillColor=null,this._currentLineColor=null},b.CanvasGraphics.prototype.fillColor=function(a){return void 0===a||this._currentFillColor.equal(a?a:b.Color.TRANSPARENT)?this._currentFillColor:(this._render._context.fillStyle=this._currentFillColor.set(a?a:b.Color.TRANSPARENT).cssRGBA,this._currentFillColor)},b.CanvasGraphics.prototype.lineColor=function(a){return void 0===a||this._currentLineColor.equal(a?a:b.Color.TRANSPARENT)?this._currentLineColor:(this._render._context.strokeStyle=this._currentLineColor.set(a?a:b.Color.TRANSPARENT).cssRGBA,this._currentLineColor)},b.CanvasGraphics.prototype.lineWidth=function(a){return void 0===a||null===a||0>a?this._currentLineWidth:(this._render._context.lineWidth=a,this._currentLineWidth=a)},b.CanvasGraphics.prototype.startShape=function(){return this._shape=new b.Shape,this._shape},b.CanvasGraphics.prototype.endShape=function(){var a=this._shape;return this._shape=null,a},b.CanvasGraphics.prototype.drawShape=function(a){var c,d,e,f=a.items,g=f.length,h=b.Shape,i=this._render,j=this._shapeWorldMatrix.set(i._currentMatrix),k=this._shapeTempMatrix,l=j.identity(),m=i._currentBlendMode,n=this._currentFillColor,o=this._currentLineColor,p=this._currentLineWidth;for(c=0;g>c;++c)switch(d=f[c],e=d.shape,l||!d.matrix?i.transform(d.matrix?d.matrix:j):(b.Matrix.concat(d.matrix,j,k),i.transform(k)),this.lineColor(d.lineColor),this.lineWidth(d.lineWidth),i.fillColor(d.fillColor),i.blendMode(d.blendMode),d.type){case h.LINE:this.drawLine(e.x1,e.y1,e.x2,e.y2);break;case h.RECT:this.drawRect(e.x,e.y,e.width,e.height);break;case h.CIRCLE:this.drawCircle(e.x,e.y,e.radius);break;case h.ELLIPSE:this.drawEllipse(e.x,e.y,e.width,e.height);break;case h.ARC:this.drawArc(e.x,e.y,e.radius,e.startAngle,e.endAngle,e.antiClockwise);break;case h.POLY:this.drawPoly(e.points)}this.lineColor(o),this.lineWidth(p),i.fillColor(n),i.blendMode(m),i.transform(j)},b.CanvasGraphics.prototype.drawLine=function(a,c,d,e){var f=this._currentLineColor,g=this._currentLineWidth;if(!f||!f.a)return!1;if(this._shape)return this._shape.add(this._render._currentMatrix,b.Shape.LINE,new b.Line(a,c,d,e),null,f,g,this._render._currentBlendMode),!0;var h=this._render._context;return h.beginPath(),h.moveTo(a,c),h.lineTo(d,e),h.stroke(),!0},b.CanvasGraphics.prototype.drawRect=function(a,c,d,e){var f=this._currentFillColor,g=this._currentLineColor,h=this._currentLineWidth;if(!(f&&f.a||h&&g&&g.a))return!1;if(this._shape)return this._shape.add(this._render._currentMatrix,b.Shape.RECT,new b.Rect(a,c,d,e),f,g,h,this._render._currentBlendMode),!1;var i=this._render._context;return f&&f.a&&i.fillRect(a,c,d,e),h&&g&&g.a&&i.strokeRect(a,c,d,e),!0},b.CanvasGraphics.prototype.drawCircle=function(a,c,d){var e=this._currentFillColor,f=this._currentLineColor,g=this._currentLineWidth;if(!(e&&e.a||g&&f&&f.a))return!1;if(this._shape)return this._shape.add(this._render._currentMatrix,b.Shape.CIRCLE,new b.Circle(a,c,d),e,f,g,this._render._currentBlendMode),!0;var h=this._render._context;return h.beginPath(),h.arc(a,c,d,0,b.Math.TWO_PI,!1),e&&e.a&&h.fill(),g&&f&&f.a&&h.stroke(),!0},b.CanvasGraphics.prototype.drawEllipse=function(a,c,d,e){var f=this._currentFillColor,g=this._currentLineColor,h=this._currentLineWidth;if(!(f&&f.a||h&&g&&g.a))return!1;if(this._shape)return this._shape.add(this._render._currentMatrix,b.Shape.ELLIPSE,new b.Ellipse(a,c,d,e),f,g,h,this._render._currentBlendMode),!0;var i=this._render._context,j=.5522848,k=.5*d,l=.5*e;a-=k,c-=l;var m=k*j,n=l*j,o=a+d,p=c+e,q=a+k,r=c+l;return i.beginPath(),i.moveTo(a,r),i.bezierCurveTo(a,r-n,q-m,c,q,c),i.bezierCurveTo(q+m,c,o,r-n,o,r),i.bezierCurveTo(o,r+n,q+m,p,q,p),i.bezierCurveTo(q-m,p,a,r+n,a,r),f&&f.a&&i.fill(),h&&g&&g.a&&i.stroke(),!0},b.CanvasGraphics.prototype.drawArc=function(a,c,d,e,f,g){var h=this._currentFillColor,i=this._currentLineColor,j=this._currentLineWidth;if(!(h&&h.a||j&&i&&i.a))return!1;if(this._shape)return this._shape.add(this._render._currentMatrix,b.Shape.ARC,new b.Arc(a,c,d,e,f,g),h,i,j,this._render._currentBlendMode),!0;var k=this._render._context;return k.beginPath(),k.arc(a,c,d,e,f,g),h&&h.a&&k.fill(),j&&i&&i.a&&k.stroke(),!0},b.CanvasGraphics.prototype.drawPoly=function(a){if(!a||a.length<2)return!1;var c=this._currentFillColor,d=this._currentLineColor,e=this._currentLineWidth;if(!(c&&c.a||e&&d&&d.a))return!1;if(this._shape)return this._shape.add(this._render._currentMatrix,b.Shape.POLY,new b.Poly(a),c,d,e,this._render._currentBlendMode),!0;var f=this._render._context;f.beginPath(),f.moveTo(a[0].x,a[0].y);for(var g=1,h=a.length;h>g;++g)f.lineTo(a[g].x,a[g].y);return a[0].equal(a[g-1])&&f.closePath(),c&&c.a&&f.fill(),e&&d&&d.a&&f.stroke(),!0},b.CanvasTexture=function(a){this.texture=a,this._source=null,this._context=null,this._tintCache={},this._imageData=null},b.CanvasTexture.prototype.destroy=function(){b.CanvasTinter.removeCache(this),this.texture=null,this._source=null,this._context=null,this._tintCache=null},b.CanvasTexture.prototype.tint=function(a){return b.CanvasTinter.tint(this,a)},b.CanvasTexture.prototype.context=function(){return this._context||(this._context=this._source.getContext("2d")),this._context},b.CanvasTexture.prototype.handle=function(){if(null===this._source&&this.texture.width&&this.texture.height){var a=document.createElement("canvas");a.width=this.texture.width,a.height=this.texture.height,this._source=a}return this._source},b.CanvasTexture.prototype.getPixels=function(){return this._imageData=this.context().getImageData(0,0,this.texture.width,this.texture.height),this._imageData.data},b.CanvasTexture.prototype.setPixels=function(a){return this._imageData.data!==a&&this._imageData.set(a),this.context().putImageData(this._imageData,0,0),this},b.CanvasTexture.prototype.load=function(a,c,d){if(b.CanvasTexture._cache[a])return this._source=b.CanvasTexture._cache[a],void c(a,!0,this._source.width,this._source.height);var e=new Image,f=this;return e.addEventListener("load",function(){d!==!1&&(b.CanvasTexture._cache[a]=d),f._source=e,c(a,!0,e.width,e.height)}),e.addEventListener("error",function(){c(a,!1)}),e.src=a,e},b.CanvasTexture.get=function(a){return a._extensions.canvas||(a._extensions.canvas=new b.CanvasTexture(a)),a._extensions.canvas},b.CanvasTexture._cache={},b.CanvasTinter=function(){},b.CanvasTinter.CACHE_CLEAR=!0,b.CanvasTinter.CACHE_COUNT=32,b.CanvasTinter.CACHE_CHECK_TIMEOUT=5,b.CanvasTinter.CACHE_TTL=30,b.CanvasTinter._cacheTimer=0,b.CanvasTinter._cacheTextures=[],b.CanvasTinter.tint=function(a,c){if(c.equal(b.Color.WHITE))return a.texture._source;void 0===b.CanvasTinter.multiplyMode&&(b.CanvasTinter.multiplyMode=b.CanvasRender._blendModesSupported()),b.CanvasTinter._color?b.CanvasTinter._color.set(c):b.CanvasTinter._color=c.clone();var d=b.CanvasTinter._color;d.quantize(b.CanvasTinter.CACHE_COUNT);var e=a._tintCache[d.hex];if(e)return e.canvas;var f=a._source,g=document.createElement("canvas");return g.width=f.width,g.height=f.height,b.CanvasTinter.multiplyMode?b.CanvasTinter._tintMultiply(g.getContext("2d"),f,d):b.CanvasTinter._tintPixel(g.getContext("2d"),f,d),a._tintCache[d.hex]={canvas:g,stamp:b.time()},b.CanvasTinter.CACHE_CLEAR&&(-1===b.CanvasTinter._cacheTextures.indexOf(a)&&b.CanvasTinter._cacheTextures.push(a),b.CanvasTinter._cacheTimer||(b.CanvasTinter._cacheTimer=setInterval(b.CanvasTinter._checkCache,1e3*b.CanvasTinter.CACHE_CHECK_TIMEOUT))),g},b.CanvasTinter.removeCache=function(a){for(var c in a._tintCache)a._tintCache[c].canvas=null;a._tintCache={};var d=b.CanvasTinter._cacheTextures.indexOf(a);-1===d&&b.CanvasTinter._cacheTextures.splice(d,1)},b.CanvasTinter._checkCache=function(){var a,c,d,e,f,g=b.time(),h=1e3*b.CanvasTinter.CACHE_TTL;
for(c=0,e=b.CanvasTinter._cacheTextures.length;e>c;++c){a=b.CanvasTinter._cacheTextures[c]._tintCache,f=0;for(d in a)g-a[d].stamp>=h?delete a[d]:++f;f||(b.CanvasTinter._cacheTextures.splice(c,1),--c,--e)}},b.CanvasTinter._tintMultiply=function(a,b,c){a.fillStyle=c.cssHex,a.fillRect(0,0,b.width,b.height),a.globalCompositeOperation="multiply",a.drawImage(b,0,0,b.width,b.height,0,0,b.width,b.height),a.globalCompositeOperation="destination-atop",a.drawImage(b,0,0,b.width,b.height,0,0,b.width,b.height)},b.CanvasTinter._tintPixel=function(a,b,c){a.globalCompositeOperation="copy",a.drawImage(b,0,0,b.width,b.height,0,0,b.width,b.height);for(var d=c.r,e=c.g,f=c.b,g=a.getImageData(0,0,b.width,b.height),h=g.data,i=0,j=h.length;j>i;i+=4)h[i]*=d,h[i+1]*=e,h[i+2]*=f;a.putImageData(g,0,0)},b.CanvasRender=function(a){this.type=b.Render.RENDER_CANVAS,this.root=null,this._setupSettings(a),this._setupProps(),this._setupBounds(),this._createContext()&&(this._setupViewport(a),this._setupManagers(),this._resetState(),this._registerRender(),this._setupFrame())},b.CanvasRender.prototype.resize=function(a,b){return this.width=a,this.height=b,this._canvas.width=a,this._canvas.height=b,this._updateBounds(),this},b.CanvasRender.prototype.destroy=function(){delete b.Render.renders[this.id],this._context=null,this._canvas=null,this._target=null,this._displayCanvas=null,this._displayContext=null,this._currentMatrix=null,this._clearMatrixTemp=null,this._clearColorTemp=null,this._bounds=null,this._boundsScroll=null,this._frameBind=null,this._graphics.destroy(),this._graphics=null,this.root=null},b.CanvasRender.prototype.bounds=function(){return this._boundsScroll.equal(b.Screen.scrollX,b.Screen.scrollY)||this._updateBounds(),this._bounds},b.CanvasRender.prototype.target=function(a){if(!a)return this._target=null,this._canvas=this._displayCanvas,this._context=this._displayContext,this;this._target=a;var c=b.CanvasTexture.get(a);return this._canvas=c.handle(this),this._context=c.context(),this},b.CanvasRender.prototype.transform=function(a){return a?(this._hasResetTransform&&a.identity()?this._context.resetTransform():this._context.setTransform(a.a,a.c,a.b,a.d,a.tx,a.ty),this._currentMatrix.set(a)):this._currentMatrix},b.CanvasRender.prototype.blendMode=function(a){return void 0!==a&&this._currentBlendMode!==a&&b.CanvasRender._blendModes&&b.CanvasRender._blendModes[a]?(this._context.globalCompositeOperation=b.CanvasRender._blendModes[a],this._currentBlendMode=a):this._currentBlendMode},b.CanvasRender.prototype.fillColor=function(a){return this._graphics.fillColor(a)},b.CanvasRender.prototype.lineColor=function(a){return this._graphics.lineColor(a)},b.CanvasRender.prototype.lineWidth=function(a){return this._graphics.lineWidth(a)},b.CanvasRender.prototype.clear=function(a){var c=this._context;if(this.blendMode(b.Render.BLEND_NORMAL),this._clearMatrixTemp.set(this._currentMatrix),this.transform(b.Matrix.IDENTITY),this._transparent)return a||this.clearColor!==!1?(c.clearRect(0,0,this.width,this.height),this):this;if(a||(a=this.clearColor),!a||!a.a)return this;var d=this._graphics,e=d.lineWidth(),f=this._clearColorTemp.set(d.fillColor());return d.fillColor(a),d.lineWidth(0),d.drawRect(0,0,this.width,this.height),d.fillColor(f),d.lineWidth(e),this.transform(this._clearMatrixTemp),this},b.CanvasRender.prototype.drawTexture=function(a,c,d,e){if(!a.ready)return this;var f=this._context;return this._setScaleMode(a.scaleMode),this._setAlpha(d||1),f.drawImage(!e||e.equal(b.Color.WHITE)?b.CanvasTexture.get(a).handle():b.CanvasTexture.get(a).tint(e),c?c.x:0,c?c.y:0,c?c.width:a.width,c?c.height:a.height,0,0,c?c.width:a.width,c?c.height:a.height),this},b.CanvasRender.prototype.drawLine=function(a,b,c,d){return this._setAlpha(1),this._graphics.drawLine(a,b,c,d),this},b.CanvasRender.prototype.drawRect=function(a,b,c,d){return this._setAlpha(1),this._graphics.drawRect(a,b,c,d),this},b.CanvasRender.prototype.drawCircle=function(a,b,c){return this._setAlpha(1),this._graphics.drawCircle(a,b,c),this},b.CanvasRender.prototype.drawEllipse=function(a,b,c,d){return this._setAlpha(1),this._graphics.drawEllipse(a,b,c,d),this},b.CanvasRender.prototype.drawArc=function(a,b,c,d,e,f){return this._setAlpha(1),this._graphics.drawArc(a,b,c,d,e,f),this},b.CanvasRender.prototype.drawPoly=function(a){return this._setAlpha(1),this._graphics.drawPoly(a),this},b.CanvasRender.prototype.drawShape=function(a){return this._graphics.drawShape(a),this},b.CanvasRender.prototype.startShape=function(){return this._graphics.startShape()},b.CanvasRender.prototype.endShape=function(){return this._graphics.endShape()},b.CanvasRender.prototype.getPixels=function(a){return b.CanvasTexture.get(a).getPixels()},b.CanvasRender.prototype.setPixels=function(a,c){return b.CanvasTexture.get(a).setPixels(c),this},b.CanvasRender.prototype._setupSettings=function(a){var c=b.Render.DEFAULT_SETTINGS;return a.canvas?(this.clearColor=a.clearColor?a.clearColor.clone():c.clearColor.clone(),this.fps=0===a.fps?0:a.fps||c.fps,this.ups=0===a.ups?0:a.ups||c.ups,this._displayCanvas=this._canvas=a.canvas,this._transparent=void 0!==a.transparent?!!a.transparent:c.transparent,this._autoClear=void 0!==a.autoClear?!!a.autoClear:c.autoClear,this._antialias=void 0!==a.antialias?!!a.antialias:c.antialias,b.Browser.ie&&(this._canvas.style["-ms-content-zooming"]="none",this._canvas.style["-ms-touch-action"]="none"),void(this._contextMenu||(this._canvas.oncontextmenu=function(){return!1}))):b.error("Can not create render, settings.canvas is not defined")},b.CanvasRender.prototype._setupProps=function(){this._currentMatrix=new b.Matrix,this._clearMatrixTemp=new b.Matrix,this._clearColorTemp=new b.Color,this._target=null},b.CanvasRender.prototype._setupBounds=function(){this._bounds=new b.Rect,this._boundsScroll=new b.Point},b.CanvasRender.prototype._updateBounds=function(){var a=this._canvas.getBoundingClientRect();this._bounds.set(a.left,a.top,a.width,a.height),this._boundsScroll.set(b.Screen.scrollX,b.Screen.scrollY)},b.CanvasRender.prototype._createContext=function(){var a={alpha:this._transparent};return this._displayContext=this._context=this._canvas.getContext?this._canvas.getContext("2d",a):null,this._context?(this._hasResetTransform=!!this._context.resetTransform,b.CanvasRender._initSmoothing(this._context),b.CanvasRender._initBlendModes(),!0):b.error("This browser does not support canvas. Try using another browser")},b.CanvasRender.prototype._setupViewport=function(a){var c=a.width||b.Screen.availWidth,d=a.height||b.Screen.availHeight;this.resize(c,d)},b.CanvasRender.prototype._setupManagers=function(){this._graphics=new b.CanvasGraphics(this)},b.CanvasRender.prototype._registerRender=function(){this.id=b.Render._uid++,b.Render.renders[this.id]=this},b.CanvasRender.prototype._setupFrame=function(){this._lastUpdateTime=0,this._lastRenderTime=0,this._frameBind=this._onFrame.bind(this),this._onFrame(0)},b.CanvasRender.prototype._onFrame=function(a){if(this._frameBind){requestAnimationFrame(this._frameBind,this._canvas);var b=this.root,c=a-this._lastUpdateTime,d=a-this._lastRenderTime;this.ups&&b&&b.update&&(60===this.ups||c>=1/this.ups*900)&&(b.update(this,c),this._lastUpdateTime=a),this.fps&&b&&b.render&&(60===this.fps||d>=1/this.fps*900)&&(this._resetState(),b.render(this,d),this._lastRenderTime=a)}},b.CanvasRender.prototype._resetState=function(){this._setAlpha(1),this._setScaleMode(b.Render.SCALE_DEFAULT),this.blendMode(b.Render.BLEND_NORMAL),this.transform(b.Matrix.IDENTITY);var a=b.Render.DEFAULT_GRAPHICS;this.fillColor(a.fillColor),this.lineColor(a.lineColor),this.lineWidth(a.lineWidth),this._autoClear&&this.clear()},b.CanvasRender.prototype._setAlpha=function(a){a=a||1,this._currentAlpha!==a&&(this._currentAlpha=a,this._context.globalAlpha=a)},b.CanvasRender.prototype._setScaleMode=function(a){a=a||b.Render.SCALE_DEFAULT,this._currentScaleMode!==a&&b.CanvasRender._smoothProperty&&(this._currentScaleMode=a,this._context[b.CanvasRender._smoothProperty]=a===b.Render.SCALE_LINEAR)},b.CanvasRender._blendModesSupported=function(){if(void 0!==b.CanvasRender._blendModesSupport)return b.CanvasRender._blendModesSupport;var a=document.createElement("canvas");a.width=1,a.height=1;var c=a.getContext("2d");return c.fillStyle="#000",c.fillRect(0,0,1,1),c.globalCompositeOperation="multiply",c.fillStyle="#fff",c.fillRect(0,0,1,1),b.CanvasRender._blendModesSupport=0===c.getImageData(0,0,1,1).data[0],b.CanvasRender._blendModesSupport},b.CanvasRender._initBlendModes=function(){if(!b.CanvasRender._blendModes){var a=this._blendModesSupported(),c={};c[b.Render.BLEND_NONE]="source-over",c[b.Render.BLEND_NORMAL]="source-over",c[b.Render.BLEND_ADD]="lighter",c[b.Render.BLEND_MULTIPLY]=a?"multiply":"source-over",c[b.Render.BLEND_SCREEN]=a?"screen":"source-over",b.CanvasRender._blendModes=c}},b.CanvasRender._initSmoothing=function(a){if(void 0===b.CanvasRender._smoothProperty){b.CanvasRender._smoothProperty=!1;for(var c=["","webkit","moz","o"],d=0,e=c.length;e>d&&!this._smoothProperty;++d){var f=c[d]+"imageSmoothingEnabled";f in a&&(b.CanvasRender._smoothProperty=f)}}},b.WebglShader=function(a,b){this._render=a,this._settings=b,this._restore(),a._addRestore(this)},b.WebglShader.SAMPLER=0,b.WebglShader.MATRIX=1,b.WebglShader.BYTE=2,b.WebglShader.UNSIGNED_BYTE=3,b.WebglShader.SHORT=4,b.WebglShader.UNSIGNED_SHORT=5,b.WebglShader.INT=6,b.WebglShader.UNSIGNED_INT=7,b.WebglShader.FLOAT=8,b.WebglShader.prototype.destroy=function(){this._render._removeRestore(this),this._render._context.deleteProgram(this.program),this._render=null,this._settings=null,this._program=null,this._attributes=null,this._uniforms=null,this._size=0},b.WebglShader.prototype._restore=function(){var a=this._render._context,c=this._settings,d=b.WebglShader._createProgram(a,c.vertex,c.fragment);a.useProgram(d),this._attributes=[],this._uniforms=[];var e,f,g;this._size=0;for(e in c.attributes)f=c.attributes[e],this._attributes.push(e),g={},g.location=a.getAttribLocation(d,e),g.type=b.WebglShader._getType(a,f[0]),g.count=f[1],g.normalized=!!f[2],g.size=b.WebglShader._getSize(a,f[0])*g.count,this._size+=g.size,this[e]=g;for(e in c.uniforms)f=c.uniforms[e],this._uniforms.push(e),g={},g.location=a.getUniformLocation(d,e),g.type=b.WebglShader._getType(a,f[0]),g.count=f[1],g.values=this.setUniformValues.bind(this,g),g.vector=this.setUniformVector.bind(this,g),g.matrix=this.setUniformMatrix.bind(this,g),g.texture=this.setUniformTexture.bind(this,g),this[e]=g;this._program=d},b.WebglShader.prototype.setUniformValues=function(){var a=arguments.length;if(!(2>a)){var b=this._render._context,c=arguments[0],d=c.type;if(d===b.BYTE||d===b.UNSIGNED_BYTE||d===b.SHORT||d===b.UNSIGNED_SHORT||d===b.SHORT||d===b.INT||d===b.UNSIGNED_INT)switch(c.count){case 1:b.uniform1i(c.location,arguments[1]);break;case 2:b.uniform2i(c.location,arguments[1],arguments[2]);break;case 3:b.uniform3i(c.location,arguments[1],arguments[2],arguments[3]);break;case 4:b.uniform4i(c.location,arguments[1],arguments[2],arguments[3],arguments[4])}else if(d===b.FLOAT)switch(c.count){case 1:b.uniform1f(c.location,arguments[1]);break;case 2:b.uniform2f(c.location,arguments[1],arguments[2]);break;case 3:b.uniform3f(c.location,arguments[1],arguments[2],arguments[3]);break;case 4:b.uniform4f(c.location,arguments[1],arguments[2],arguments[3],arguments[4])}}},b.WebglShader.prototype.setUniformVector=function(a,b){var c=this._render._context,d=a.type;d===c.BYTE||d===c.UNSIGNED_BYTE||d===c.SHORT||d===c.UNSIGNED_SHORT||d===c.SHORT||d===c.INT||d===c.UNSIGNED_INT?c["uniform"+a.count+"iv"](a.location,b):d===c.FLOAT&&c["uniform"+a.count+"if"](a.location,b)},b.WebglShader.prototype.setUniformMatrix=function(a,b,c){this._render._context["uniformMatrix"+Math.max(2,a.count)+"fv"](a.location,c===!0,b.array())},b.WebglShader.prototype.setUniformTexture=function(a,b,c){var d=this._render._context;d.activeTexture(d["TEXTURE"+b]),d.bindTexture(d.TEXTURE_2D,c),d.uniform1i(a.location,b)},b.WebglShader.prototype.use=function(){var a,b=this._render._context,c=0;b.useProgram(this._program);for(var d=0,e=this._attributes.length;e>d;++d)a=this[this._attributes[d]],b.enableVertexAttribArray(a.location),b.vertexAttribPointer(a.location,a.count,a.type,a.normalized,this._size,c),c+=a.size},b.WebglShader._createProgram=function(a,c,d){var e=a.createProgram();return a.attachShader(e,b.WebglShader._compileShader(a,a.VERTEX_SHADER,c)),a.attachShader(e,b.WebglShader._compileShader(a,a.FRAGMENT_SHADER,d)),a.linkProgram(e),a.getProgramParameter(e,a.LINK_STATUS)||a.isContextLost()?e:b.error("Program filed to link:",a.getProgramInfoLog(e))},b.WebglShader._compileShader=function(a,c,d){var e=a.createShader(c);return a.shaderSource(e,"string"==typeof d?d:d.join("\n")),a.compileShader(e),a.getShaderParameter(e,a.COMPILE_STATUS)||a.isContextLost()?e:b.error("Could not compile shader:",a.getShaderInfoLog(e))},b.WebglShader._getType=function(a,c){switch(c){case b.WebglShader.BYTE:return a.BYTE;case b.WebglShader.UNSIGNED_BYTE:return a.UNSIGNED_BYTE;case b.WebglShader.SHORT:return a.SHORT;case b.WebglShader.UNSIGNED_SHORT:return a.UNSIGNED_SHORT;case b.WebglShader.INT:return a.INT;case b.WebglShader.UNSIGNED_INT:return a.UNSIGNED_INT;case b.WebglShader.FLOAT:return a.FLOAT;case b.WebglShader.MATRIX:return c;case b.WebglShader.SAMPLER:return c}},b.WebglShader._getSize=function(a,c){switch(c){case b.WebglShader.BYTE:return 1;case b.WebglShader.UNSIGNED_BYTE:return 1;case b.WebglShader.SHORT:return 2;case b.WebglShader.UNSIGNED_SHORT:return 2;case b.WebglShader.INT:return 4;case b.WebglShader.UNSIGNED_INT:return 4;case b.WebglShader.FLOAT:return 4}},b.WebglShader.PRIMITIVE={name:"primitive",fragment:["precision lowp float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],vertex:["attribute vec2 aPosition;","attribute vec4 aColor;","uniform vec2 uProjection;","varying vec4 vColor;","const vec2 cOffset = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4(aPosition / uProjection + cOffset, 0.0, 1.0);","   vColor = aColor;","}"],attributes:{aPosition:[b.WebglShader.FLOAT,2],aColor:[b.WebglShader.UNSIGNED_BYTE,4,!0]},uniforms:{uProjection:[b.WebglShader.FLOAT,2],uOffset:[b.WebglShader.FLOAT,2]}},b.WebglShader.SPRITE={name:"sprite",fragment:["precision lowp float;","varying vec2 vUV;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vUV) * vColor;","}"],vertex:["attribute vec2 aPosition;","attribute vec2 aUV;","attribute vec4 aColor;","uniform vec2 uProjection;","varying vec2 vUV;","varying vec4 vColor;","const vec2 cOffset = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4(aPosition / uProjection + cOffset, 0.0, 1.0);","   vUV = aUV;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],attributes:{aPosition:[b.WebglShader.FLOAT,2],aUV:[b.WebglShader.FLOAT,2],aColor:[b.WebglShader.UNSIGNED_BYTE,4,!0]},uniforms:{uProjection:[b.WebglShader.FLOAT,2],uSampler:[b.WebglShader.SAMPLER,1],uOffset:[b.WebglShader.FLOAT,2]}},b.WebglGraphics=function(a){this._render=a,this._smooth=5,this._currentShader=null,this._vertexSize=3,this._maxVertexCount=6e3,this._vertexCount=0,this._indexCount=0,this._indices=new Uint16Array(2*this._maxVertexCount),this._vertices=new ArrayBuffer(this._maxVertexCount*this._vertexSize*4),this._positions=new Float32Array(this._vertices),this._colors=new Uint32Array(this._vertices),this._minShapeSize=4,this._defaultBlendMode=b.Render.BLEND_NORMAL,this._states=new Uint16Array(this._maxVertexCount/this._minShapeSize),this._stateCount=0,this._stateBlendModes=new Uint8Array(this._maxVertexCount/this._minShapeSize),this._stateBlendModeLast=-1,this._shape=null,this._shapeIndex=0,this._shapeVertex=0,this._shapeMatrix=new b.Matrix,this._currentFillColor=b.Render.DEFAULT_GRAPHICS.fillColor.clone(),this._currentLineColor=b.Render.DEFAULT_GRAPHICS.lineColor.clone(),this._currentLineWidth=b.Render.DEFAULT_GRAPHICS.lineWidth,this._restore(),a._addRestore(this)},b.WebglGraphics.prototype.destroy=function(){this._render._removeRestore(this);var a=this._render._context;a.destroyBuffer(this._vertexBuffer),a.destroyBuffer(this._indexBuffer),this._indices=null,this._vertices=null,this._currentShader=null,this._render=null,this._states=null,this._stateBlendModes=null,this._shapeMatrix=null,this._currentFillColor=null,this._currentLineColor=null},b.WebglGraphics.prototype._restore=function(){var a=this._render._context;this._vertexBuffer=a.createBuffer(),this._indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._indexBuffer),a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this._indices,a.DYNAMIC_DRAW),a.bufferData(a.ARRAY_BUFFER,this._vertices,a.DYNAMIC_DRAW)},b.WebglGraphics.prototype.flush=function(){if(!this._vertexCount)return!1;var a=this._render,c=a._context;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this._indexBuffer),c.bindBuffer(c.ARRAY_BUFFER,this._vertexBuffer);var d=this._currentShader;d||(d=this._currentShader=a._getShader(b.WebglShader.PRIMITIVE)),d!==a._getShader()&&a._setShader(d),this._vertexCount>.5*this._maxVertexCount?(c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,this._indices),c.bufferSubData(c.ARRAY_BUFFER,0,this._vertices)):(c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,this._indices.subarray(0,this._indexCount)),c.bufferSubData(c.ARRAY_BUFFER,0,this._positions.subarray(0,this._vertexCount*this._vertexSize)));for(var e=this._states,f=this._stateBlendModes,g=0,h=0,i=0,j=this._stateCount;j>i;++i)a._applyBlendMode(f[i]),h=e[i],c.drawElements(c.TRIANGLES,h-g,c.UNSIGNED_SHORT,2*g),g=h;return this._stateBlendModeLast=this._defaultBlendMode,this._stateCount=0,this._vertexCount=0,this._indexCount=0,!0},b.WebglGraphics.prototype.fillColor=function(a){return void 0===a||this._currentFillColor.equal(a?a:b.Color.TRANSPARENT)?this._currentFillColor:this._currentFillColor.set(a?a:b.Color.TRANSPARENT)},b.WebglGraphics.prototype.lineColor=function(a){return void 0===a||this._currentLineColor.equal(a?a:b.Color.TRANSPARENT)?this._currentLineColor:this._currentLineColor.set(a?a:b.Color.TRANSPARENT)},b.WebglGraphics.prototype.lineWidth=function(a){return void 0===a||null===a||0>a?this._currentLineWidth:this._currentLineWidth=a},b.WebglGraphics.prototype.startShape=function(){return this._shape=new b.Shape,this._shapeIndex=this._indexCount,this._shapeVertex=this._vertexCount,this._shapeState=this._stateCount,this._shape},b.WebglGraphics.prototype.endShape=function(){var a=this._shape;if(!a)return null;if(this._vertexCount-this._shapeVertex===0)return this._shape=null,this._shapeIndex=0,this._shapeVertex=0,this._shapeState=0,a;var b=this._indexCount-this._shapeIndex,c=this._vertexCount-this._shapeVertex,d=this._stateCount-this._shapeState;return a._indices=new Uint16Array(this._indices.subarray(this._shapeIndex,b)),a._vertices=new Float32Array(this._positions.subarray(this._shapeVertex,c*this._vertexSize)),a._states=new Uint16Array(this._states.subarray(this._shapeState,d)),a._blends=new Uint8Array(this._stateBlendModes.subarray(this._shapeState,d)),this._indexCount-=b,this._vertexCount-=c,this._stateCount-=d,this._shape=null,this._shapeIndex=0,this._shapeVertex=0,this._shapeState=0,a},b.WebglGraphics.prototype.drawShape=function(a){if(!a.items||!a.items.length)return!1;var c,d,e,f=this._render,g=this._shapeMatrix.set(f._currentMatrix),h=b.Matrix.IDENTITY,i=this._currentFillColor,j=this._currentLineColor,k=this._currentLineWidth,l=f._currentBlendMode;if(!a._indices||!a._vertices){this._shapeIndex=this._indexCount,this._shapeVertex=this._vertexCount,this._shapeState=this._stateCount;var m,n=a.items,o=b.Shape;for(c=0,d=n.length;d>c;++c)switch(m=n[c],e=m.shape,f._currentMatrix.set(m.matrix?m.matrix:h),f._currentBlendMode=m.blendMode,this._currentFillColor=m.fillColor,this._currentLineColor=m.lineColor,this._currentLineWidth=m.lineWidth,m.type){case o.LINE:this.drawLine(e.x1,e.y1,e.x2,e.y2);break;case o.RECT:this.drawRect(e.x,e.y,e.width,e.height);break;case o.CIRCLE:this.drawCircle(e.x,e.y,e.radius);break;case o.ELLIPSE:this.drawEllipse(e.x,e.y,e.width,e.height);break;case o.ARC:this.drawArc(e.x,e.y,e.radius,e.startAngle,e.endAngle,e.antiClockwise);break;case o.POLY:this.drawPoly(e.points)}this._shape=a,this.endShape(),this._currentFillColor=i,this._currentLineColor=j,this._currentLineWidth=k,f._currentBlendMode=l,f._currentMatrix.set(g)}this._maxVertexCount-this._vertexCount<a._vertices.length&&this.flush();var p,q;for(q=this._indices,e=a._indices,c=e.length+1,p=this._indexCount+c,this._indexCount=p-1;c;)q[--p]=e[--c];if(q=this._positions,e=a._vertices,c=e.length,p=this._vertexCount+c,this._vertexCount=p,g.identity())for(;c;)q[--p]=e[--c];else for(var r,s,t=g.a,u=g.b,v=g.c,w=g.d,x=g.tx,y=g.ty;c>0;)q[--p]=e[--c],s=e[--c],r=e[--c],q[--p]=v*r+w*s+y,q[--p]=t*r+u*s+x;for(q=this._states,e=a._states,c=e.length,p=this._stateCount+c;c;)q[--p]=e[--c];for(q=this._stateBlendModes,e=a._blends,c=e.length,p=this._stateCount+c;c;)q[--p]=e[--c];return this._stateCount+=e.length,this._vertexCount>=this._maxVertexCount&&this.flush(),!0},b.WebglGraphics.prototype.drawLine=function(a,c,d,e){var f=this._currentLineColor,g=this._currentLineWidth;if(!g||!f||!f.a)return!1;if(a===d&&c===e)return!1;this._maxVertexCount-this._vertexCount<4&&this.flush();var h=this._render._currentMatrix,i=this._render._currentBlendMode;this._shape&&this._shape.add(h,b.Shape.types.LINE,new b.Line(a,c,d,e),null,f,g,i);var j=f.packedABGR,k=.5*g,l=h.a,m=h.b,n=h.c,o=h.d,p=h.tx,q=h.ty,r=this._vertexCount,s=r*this._vertexSize,t=this._indexCount,u=this._positions,v=this._colors,w=this._indices,x=e-c,y=a-d,z=Math.sqrt(x*x+y*y);return x=x/z*k,y=y/z*k,u[s++]=l*(a-x)+m*(c-y)+p,u[s++]=n*(a-x)+o*(c-y)+q,v[s++]=j,u[s++]=l*(a+x)+m*(c+y)+p,u[s++]=n*(a+x)+o*(c+y)+q,v[s++]=j,u[s++]=l*(d+x)+m*(e+y)+p,u[s++]=n*(d+x)+o*(e+y)+q,v[s++]=j,u[s++]=l*(d-x)+m*(e-y)+p,u[s++]=n*(d-x)+o*(e-y)+q,v[s++]=j,w[t++]=r+0,w[t++]=r+1,w[t++]=r+2,w[t++]=r+0,w[t++]=r+3,w[t++]=r+2,r+=4,this._vertexCount=r,this._indexCount=t,this._saveState(i),this._vertexCount>=this._maxVertexCount&&this.flush(),!0},b.WebglGraphics.prototype.drawRect=function(a,c,d,e){var f=this._currentFillColor,g=this._currentLineColor,h=this._currentLineWidth;if(!(f&&f.a||h&&g&&g.a))return!1;if(0===d||0===e)return!1;this._maxVertexCount-this._vertexCount<12&&this.flush();var i=this._render._currentMatrix,j=this._render._currentBlendMode;this._shape&&this._shape.add(i,b.Shape.types.RECT,new b.Rect(a,c,d,e),f,g,h,j);var k,l,m,n,o=i.a,p=i.b,q=i.c,r=i.d,s=i.tx,t=i.ty,u=this._vertexCount,v=u*this._vertexSize,w=this._indexCount,x=this._positions,y=this._colors,z=this._indices;if(f&&f.a&&(n=f.packedABGR,k=v,x[v++]=o*a+p*c+s,x[v++]=q*a+r*c+t,y[v++]=n,x[v++]=o*(a+d)+p*c+s,x[v++]=q*(a+d)+r*c+t,y[v++]=n,x[v++]=o*(a+d)+p*(c+e)+s,x[v++]=q*(a+d)+r*(c+e)+t,y[v++]=n,x[v++]=o*a+p*(c+e)+s,x[v++]=q*a+r*(c+e)+t,y[v++]=n,z[w++]=u+0,z[w++]=u+1,z[w++]=u+2,z[w++]=u+0,z[w++]=u+3,z[w++]=u+2,u+=4),h&&g&&g.a){for(n=g.packedABGR,m=.5*h,k=v,x[v++]=o*(a-m)+p*(c-m)+s,x[v++]=q*(a-m)+r*(c-m)+t,y[v++]=n,x[v++]=o*(a+m)+p*(c+m)+s,x[v++]=q*(a+m)+r*(c+m)+t,y[v++]=n,x[v++]=o*(a-m+d)+p*(c+m)+s,x[v++]=q*(a-m+d)+r*(c+m)+t,y[v++]=n,x[v++]=o*(a+m+d)+p*(c-m)+s,x[v++]=q*(a+m+d)+r*(c-m)+t,y[v++]=n,x[v++]=o*(a+m+d)+p*(c+m+e)+s,x[v++]=q*(a+m+d)+r*(c+m+e)+t,y[v++]=n,x[v++]=o*(a-m+d)+p*(c-m+e)+s,x[v++]=q*(a-m+d)+r*(c-m+e)+t,y[v++]=n,x[v++]=o*(a+m)+p*(c-m+e)+s,x[v++]=q*(a+m)+r*(c-m+e)+t,y[v++]=n,x[v++]=o*(a-m)+p*(c+m+e)+s,x[v++]=q*(a-m)+r*(c+m+e)+t,y[v++]=n,l=0;4>l;++l)l?(z[w++]=u+0,z[w++]=u+1,z[w++]=u+2,z[w++]=u+0,z[w++]=u+3,z[w++]=u+2,u+=2):(z[w++]=u+0,z[w++]=u+1,z[w++]=u+6,z[w++]=u+0,z[w++]=u+7,z[w++]=u+6);u+=2}return this._vertexCount=u,this._indexCount=w,this._saveState(j),this._vertexCount>=this._maxVertexCount&&this.flush(),!0},b.WebglGraphics.prototype.drawCircle=function(a,c,d){return this._shape&&this._shape.add(this._render._currentMatrix,b.Shape.types.CIRCLE,new b.Circle(a,c,d),this._currentFillColor,this._currentLineColor,this._currentLineWidth,this._render._currentBlendMode),this._drawEllipse(a,c,2*d,2*d)},b.WebglGraphics.prototype.drawEllipse=function(a,c,d,e){return this._shape&&this._shape.add(this._render._currentMatrix,b.Shape.types.ELLIPSE,new b.Ellipse(a,c,d,e),this._currentFillColor,this._currentLineColor,this._currentLineWidth,this._render._currentBlendMode),this._drawEllipse(a,c,d,e)},b.WebglGraphics.prototype.drawArc=function(a,c,d,e,f,g){var h=this._currentFillColor,i=this._currentLineColor,j=this._currentLineWidth;if(!(h&&h.a||j&&i&&i.a))return!1;if(0===d)return!1;if(e===f)return!1;var k=b.Math.TWO_PI;e>f&&(f=Math.floor(e/k+1)*k+f%k);var l=f-e;if(l>k&&(l%=k),g&&(l-=k),!l)return!1;var m=this._render._currentMatrix,n=this._render._currentBlendMode;this._shape&&this._shape.add(m,b.Shape.types.ARC,new b.Arc(a,c,d,e,f,g),h,i,j,n);var o,p,q,r,s,t,u,v,w,x,y,z=m.a,A=m.b,B=m.c,C=m.d,D=m.tx,E=m.ty,F=this._vertexCount,G=this._indexCount,H=F*this._vertexSize,I=this._positions,J=this._colors,K=this._indices,L=l!==k,M=Math.round(Math.round(this._smooth*Math.sqrt(d))/k*(0>l?-l:l)),N=l/M;if(L&&++M,this._maxVertexCount-this._vertexCount<3*M&&(this.flush(),F=this._vertexCount,G=this._indexCount,H=F*this._vertexSize),h&&h.a)for(o=h.packedABGR,v=d,w=0,e%k!==0&&(s=Math.cos(e),r=Math.sin(e),t=v,v=s*t-r*w,w=r*t+s*w),s=Math.cos(N),r=Math.sin(N),q=F,p=0;M>p;++p)t=v,p&&(v=s*t-r*w,w=r*t+s*w),t=v+a,u=w+c,I[H++]=z*t+A*u+D,I[H++]=B*t+C*u+E,J[H++]=o,p>1&&(K[G++]=q,K[G++]=F-1,K[G++]=F),++F;if(j&&i&&i.a)for(o=i.packedABGR,q=F+2*M,j*=.5,v=d-j,w=0,x=d+j,y=0,e%k!==0&&(s=Math.cos(e),r=Math.sin(e),t=v,v=s*t-r*w,w=r*t+s*w,t=x,x=s*t-r*y,y=r*t+s*y),s=Math.cos(N),r=Math.sin(N),p=0;M>p;++p)t=v,p&&(v=s*t-r*w,w=r*t+s*w),t=v+a,u=w+c,I[H++]=z*t+A*u+D,I[H++]=B*t+C*u+E,J[H++]=o,t=x,p&&(x=s*t-r*y,y=r*t+s*y),t=x+a,u=y+c,I[H++]=z*t+A*u+D,I[H++]=B*t+C*u+E,J[H++]=o,p?(K[G++]=F-2,K[G++]=F-1,K[G++]=F,K[G++]=F-1,K[G++]=F+1,K[G++]=F):L||(K[G++]=q-2,K[G++]=q-1,K[G++]=F,K[G++]=q-1,K[G++]=F+1,K[G++]=F),F+=2;return this._vertexCount=F,this._indexCount=G,this._saveState(n),this._vertexCount>=this._maxVertexCount&&this.flush(),!0},b.WebglGraphics.prototype.drawPoly=function(a){var c=a.length,d=this._currentFillColor,e=this._currentLineColor,f=this._currentLineWidth;if(!(!(2>c)&&(d&&d.a||f&&e&&e.a)))return!1;var g,h;if(2===c)return g=a[0],h=a[1],this.drawLine(g.x,g.y,h.x,h.y),!0;var i=this._vertexCount,j=i*this._vertexSize,k=this._indexCount,l=this._positions,m=this._colors,n=this._indices;if(this._maxVertexCount<4*a.length)return!1;this._maxVertexCount-this._vertexCount<4*a.length&&(this.flush(),i=this._vertexCount,k=this._indexCount,j=i*this._vertexSize);var o=this._render._currentMatrix,p=this._render._currentBlendMode;this._shape&&this._shape.add(o,b.Shape.types.POLY,new b.Poly(a),d,e,f,p);var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T=o.a,U=o.b,V=o.c,W=o.d,X=o.tx,Y=o.ty;if(d&&d.a){q=d.packedABGR,A=c,a[0].equal(a[c-1])&&--A,y=j;var Z,$,_,ab,bb,cb,db,eb,fb,gb=[];for(gb.length=A,z=0;A>z;++z)gb[z]=z;for(z=0;A>3;){if(Z=gb[(z+0)%A],$=gb[(z+1)%A],_=gb[(z+2)%A],g=a[Z],h=a[$],r=a[_],C=g.x,D=g.y,E=h.x,F=h.y,G=r.x,H=r.y,ab=!1,(D-F)*(G-E)+(E-C)*(H-F)>=0){ab=!0;for(var hb=0;A>hb;++hb)if(S=gb[hb],S!==Z&&S!==$&&S!==_&&(g=a[S],M=G-C,N=H-D,O=E-C,P=F-D,Q=g.x-C,R=g.y-D,bb=M*M+N*N,cb=M*O+N*P,db=M*Q+N*R,eb=O*O+P*P,fb=O*Q+P*R,B=1/(bb*eb-cb*cb),M=(eb*db-cb*fb)*B,N=(bb*fb-cb*db)*B,M>=0&&N>=0&&1>M+N)){ab=!1;break}}if(ab)l[j++]=T*C+U*D+X,l[j++]=V*C+W*D+Y,m[j++]=q,l[j++]=T*E+U*F+X,l[j++]=V*E+W*F+Y,m[j++]=q,l[j++]=T*G+U*H+X,l[j++]=V*G+W*H+Y,m[j++]=q,n[k++]=i+0,n[k++]=i+1,n[k++]=i+2,i+=3,gb.splice((z+1)%A,1),A--,z=0;else if(z++>3*A)break}g=a[gb[0]],h=a[gb[1]],r=a[gb[2]],C=g.x,D=g.y,E=h.x,F=h.y,G=r.x,H=r.y,l[j++]=T*C+U*D+X,l[j++]=V*C+W*D+Y,m[j++]=q,l[j++]=T*E+U*F+X,l[j++]=V*E+W*F+Y,m[j++]=q,l[j++]=T*G+U*H+X,l[j++]=V*G+W*H+Y,m[j++]=q,n[k++]=i+0,n[k++]=i+1,n[k++]=i+2,i+=3}if(f&&e&&e.a){q=e.packedABGR,g=a[0],h=a[c-1];var ib,jb,kb,lb,mb,nb=.5*f,ob=g.x===h.x&&g.y===h.y;for(c-=2,y=j,z=ob?-1:0;c>z;++z)g=-1===z?a[c]:a[z],h=a[z+1],r=a[z+2],s=g.x,t=g.y,u=h.x,v=h.y,w=r.x,x=r.y,M=u-s,N=v-t,O=u-w,P=v-x,Q=s-w,R=t-x,D=s-u,A=Math.sqrt(N*N+D*D),C=N/A*nb,D=D/A*nb,H=w-u,A=Math.sqrt(P*P+H*H),G=P/A*nb,H=H/A*nb,E=C+G,F=D+H,S=P*M-O*N,S?(B=(O*(R-F)-P*(Q-E))/S,I=s-C+B*M,J=t-D+B*N,B=(O*(R+F)-P*(Q+E))/S,K=s+C+B*M,L=t+D+B*N):(I=u-C,J=v-D,K=u+C,L=v+D),M=T*I+U*J+X,N=V*I+W*J+Y,O=T*K+U*L+X,P=V*K+W*L+Y,I=M,J=N,K=O,L=P,O=T*u+U*v+X,P=V*u+W*v+Y,ib=(I-O)*(I-O)+(J-P)*(J-P)>1e4,ib&&(M=T*(u+G)+U*(v+H)+X,N=V*(u+G)+W*(v+H)+Y,O=T*(u-G)+U*(v-H)+X,P=V*(u-G)+W*(v-H)+Y),-1!==z?(z||ob||(l[j++]=T*(s+C)+U*(t+D)+X,l[j++]=V*(s+C)+W*(t+D)+Y,m[j++]=q,l[j++]=T*(s-C)+U*(t-D)+X,l[j++]=V*(s-C)+W*(t-D)+Y,m[j++]=q,i+=2),ib?(l[j++]=K,l[j++]=L,m[j++]=q,l[j++]=O,l[j++]=P,m[j++]=q):(l[j++]=K,l[j++]=L,m[j++]=q,l[j++]=I,l[j++]=J,m[j++]=q),n[k++]=i-2+0,n[k++]=i-2+1,n[k++]=i-2+2,n[k++]=i-2+1,n[k++]=i-2+2,n[k++]=i-2+3,i+=2,ib&&(l[j++]=K,l[j++]=L,m[j++]=q,l[j++]=M,l[j++]=N,m[j++]=q,n[k++]=i-1+0,n[k++]=i-1+1,n[k++]=i-1+2,i+=2),z===c-1&&(ob?(l[j++]=lb,l[j++]=mb):(l[j++]=T*(w-G)+U*(x-H)+X,l[j++]=V*(w-G)+W*(x-H)+Y),m[j++]=q,ob?(l[j++]=jb,l[j++]=kb):(l[j++]=T*(w+G)+U*(x+H)+X,l[j++]=V*(w+G)+W*(x+H)+Y),m[j++]=q,n[k++]=i-2+0,n[k++]=i-2+1,n[k++]=i-2+2,n[k++]=i-2+(ob?0:1),n[k++]=i-2+2,n[k++]=i-2+3,i+=2)):(jb=l[j++]=K,kb=l[j++]=L,m[j++]=q,lb=l[j++]=I,mb=l[j++]=J,m[j++]=q,i+=2)}return this._vertexCount=i,this._indexCount=k,this._saveState(p),this._vertexCount>=this._maxVertexCount&&this.flush(),!0},b.WebglGraphics.prototype._drawEllipse=function(a,c,d,e){var f=this._currentFillColor,g=this._currentLineColor,h=this._currentLineWidth;if(!(f&&f.a||h&&g&&g.a))return!1;if(0===d||0===e)return!1;var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=this._render._currentMatrix,z=this._render._currentBlendMode,A=y.a,B=y.b,C=y.c,D=y.d,E=y.tx,F=y.ty,G=this._vertexCount,H=this._indexCount,I=G*this._vertexSize,J=this._positions,K=this._colors,L=this._indices;if(d*=.5,e*=.5,k=Math.abs(A*d+B*e),l=Math.abs(C*d+D*e),t=Math.round(this._smooth*Math.sqrt(Math.max(d,e))),s=b.Math.TWO_PI/t,v=Math.cos(s),u=Math.sin(s),this._maxVertexCount-this._vertexCount<3*t+1&&(this.flush(),G=this._vertexCount,H=this._indexCount,I=G*this._vertexSize),f&&f.a)for(x=f.packedABGR,w=e/d,J[I++]=A*a+B*c+E,J[I++]=C*a+D*c+F,K[I++]=x,j=G,++G,k=d,l=0,i=0;t>i;++i)m=k,k=v*m-u*l,l=u*m+v*l,m=k+a,n=l*w+c,J[I++]=A*m+B*n+E,J[I++]=C*m+D*n+F,K[I++]=x,L[H++]=j,L[H++]=i?G-1:j+t,L[H++]=G,++G;if(h&&g&&g.a)for(x=g.packedABGR,r=0,j=G+2*t,q=.5*h,d===e&&(k=d-q,l=0,o=d+q,p=0),i=0;t>i;++i)d===e?(m=k,k=v*m-u*l,l=u*m+v*l,m=k+a,n=l+c):(v=Math.cos(r),u=Math.sin(r),m=v*(d+q)+a,n=u*(e+q)+c),J[I++]=A*m+B*n+E,J[I++]=C*m+D*n+F,K[I++]=x,d===e?(m=o,o=v*m-u*p,p=u*m+v*p,m=o+a,n=p+c):(m=v*(d-q)+a,n=u*(e-q)+c),J[I++]=A*m+B*n+E,J[I++]=C*m+D*n+F,K[I++]=x,i?(L[H++]=G-2,L[H++]=G-1,L[H++]=G,L[H++]=G-1,L[H++]=G+1,L[H++]=G):(L[H++]=j-2,L[H++]=j-1,L[H++]=G,L[H++]=j-1,L[H++]=G+1,L[H++]=G),G+=2,r+=s;return this._vertexCount=G,this._indexCount=H,this._saveState(z),this._vertexCount>=this._maxVertexCount&&this.flush(),!0},b.WebglGraphics.prototype._saveState=function(a){return a=a||b.Render.BLEND_NORMAL,a===this._stateBlendModeLast&&this._stateCount?void(this._states[this._stateCount-1]=this._indexCount):(this._states[this._stateCount]=this._indexCount,this._stateBlendModes[this._stateCount]=a,this._stateBlendModeLast=a,void++this._stateCount)},b.WebglTexture=function(a){this.texture=a,this._handles={},this._imageData=null},b.WebglTexture.prototype.destroy=function(){if(this._handles){for(var a in this._handles){var c=b.Render.renders[a],d=this._handles[a];c._removeRestore(this),c._context.deleteTexture(d.texture),d.buffer&&c._context.deleteFramebuffer(d.buffer)}this._handles=null,this.texture=null}},b.WebglTexture.prototype.handle=function(a,b,c){var d=this._handles[a.id];return d&&(b?d.buffer:d.texture)?b?d.buffer:d.texture:c===!1?!1:(this._create(a),a._addRestore(this),b?this._handles[a.id].buffer:this._handles[a.id].texture)},b.WebglTexture.prototype.getPixels=function(a){var b=this.texture,c=b.width*b.height*4;this._imageData&&this._imageData.length===c||(this._imageBuffer=new ArrayBuffer(c),this._imageData=new Uint8Array(this._imageBuffer),this._imageDataClamped=new Uint8ClampedArray(this._imageBuffer));
var d=a._context,e=this.handle(a,!0,!0);d.bindFramebuffer(d.FRAMEBUFFER,e),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,this.handle(a),0),d.readPixels(0,0,b.width,b.height,d.RGBA,d.UNSIGNED_BYTE,this._imageData);var f=a._target;return null===f?d.bindFramebuffer(d.FRAMEBUFFER,null):a.target(f),this._imageDataClamped},b.WebglTexture.prototype.setPixels=function(a,b){a!==this._imageDataClamped&&this._imageDataClamped.set(a);var c=b._context;return c.bindTexture(c.TEXTURE_2D,this.handle(b)),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,this.texture.width,this.texture.height,0,c.RGBA,c.UNSIGNED_BYTE,this._imageData),this},b.WebglTexture.prototype._restore=function(a){this._handles[a.id]&&delete this._handles[a.id]},b.WebglTexture.prototype._create=function(a){var c=a._context,d=this.texture,e=d.scaleMode===b.Render.SCALE_LINEAR?c.LINEAR:c.NEAREST,f=c.createTexture(),g=null;c.bindTexture(c.TEXTURE_2D,f),d.url?(c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,b.CanvasTexture.get(d).handle())):(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,d.width,d.height,0,c.RGBA,c.UNSIGNED_BYTE,null),g=this._createBuffer(c,f,d.width,d.height)),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),d.pot?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE)),c.bindTexture(c.TEXTURE_2D,null),this._handles[a.id]={texture:f,buffer:g}},b.WebglTexture.prototype._createBuffer=function(a,b,c,d){var e=a.createFramebuffer();return e.width=c,e.height=d,a.bindFramebuffer(a.FRAMEBUFFER,e),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0),a.bindFramebuffer(a.FRAMEBUFFER,null),e},b.WebglTexture.get=function(a){return a._extensions.webgl||(a._extensions.webgl=new b.WebglTexture(a)),a._extensions.webgl},b.WebglBatch=function(a){this._render=a,this._currentShader=null,this._vertexSize=5,this._spriteSize=4*this._vertexSize,this._maxSpriteCount=2e3,this._indices=new Uint16Array(6*this._maxSpriteCount),this._vertices=new ArrayBuffer(this._maxSpriteCount*this._spriteSize*4),this._positions=new Float32Array(this._vertices),this._colors=new Uint32Array(this._vertices),this._states=new Uint16Array(this._maxSpriteCount),this._stateCount=0,this._stateBlendModes=new Uint8Array(this._maxSpriteCount),this._stateBlendModeLast=-1,this._stateTextures=[],this._stateTextureLast=null,this._spriteCount=0,this._prepare(),this._restore(),a._addRestore(this)},b.WebglBatch.prototype.destroy=function(){this._render._removeRestore(this);var a=this._render._context;a.destroyBuffer(this._vertexBuffer),a.destroyBuffer(this._indexBuffer),this.texture=null,this._indices=null,this._vertices=null,this._positions=null,this._colors=null,this._currentShader=null,this._render=null,this._states=null,this._stateBlendModes=null,this._stateTextures=null},b.WebglBatch.prototype._prepare=function(){this._stateTextures.length=this._maxSpriteCount;for(var a=this._indices,b=0,c=0,d=a.length;d>b;b+=6,c+=4)a[b+0]=c+0,a[b+1]=c+1,a[b+2]=c+2,a[b+3]=c+0,a[b+4]=c+2,a[b+5]=c+3},b.WebglBatch.prototype._restore=function(){var a=this._render._context;this._vertexBuffer=a.createBuffer(),this._indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._indexBuffer),a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this._indices,a.STATIC_DRAW),a.bufferData(a.ARRAY_BUFFER,this._vertices,a.DYNAMIC_DRAW)},b.WebglBatch.prototype.render=function(a,b,c,d,e,f,g){var h,i,j,k,l=a.texture.width,m=a.texture.height,n=this._render,o=n._currentMatrix,p=n._currentBlendMode,q=o.a,r=o.c,s=o.b,t=o.d,u=o.tx,v=o.ty,w=16777215&g.packedABGR|255*f<<24,x=this._spriteCount*this._spriteSize,y=this._positions,z=this._colors;a.handle(n,!0,!1)?(h=b/l,i=(c+e)/m,j=(b+d)/l,k=c/m):(h=b/l,i=c/m,j=(b+d)/l,k=(c+e)/m),y[x++]=u,y[x++]=v,y[x++]=h,y[x++]=i,z[x++]=w,y[x++]=q*d+u,y[x++]=r*d+v,y[x++]=j,y[x++]=i,z[x++]=w,y[x++]=q*d+s*e+u,y[x++]=t*e+r*d+v,y[x++]=j,y[x++]=k,z[x++]=w,y[x++]=s*e+u,y[x++]=t*e+v,y[x++]=h,y[x++]=k,z[x++]=w,++this._spriteCount,this._saveState(a.handle(n),p),this._spriteCount>=this._maxSpriteCount&&this.flush()},b.WebglBatch.prototype.flush=function(){if(!this._spriteCount)return!1;var a=this._render,c=a._context;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this._indexBuffer),c.bindBuffer(c.ARRAY_BUFFER,this._vertexBuffer);var d=this._currentShader;d||(d=this._currentShader=a._getShader(b.WebglShader.SPRITE)),d!==a._getShader()&&a._setShader(d),this._spriteCount>.5*this._maxSpriteCount?c.bufferSubData(c.ARRAY_BUFFER,0,this._vertices):c.bufferSubData(c.ARRAY_BUFFER,0,this._positions.subarray(0,this._spriteCount*this._spriteSize));for(var e,f=this._states,g=this._stateBlendModes,h=this._stateTextures,i=d.uSampler,j=0,k=0,l=null,m=0,n=this._stateCount;n>m;++m)a._applyBlendMode(g[m]),e=h[m],e!==l&&(i.texture(0,e),l=e),k=f[m],c.drawElements(c.TRIANGLES,k-j,c.UNSIGNED_SHORT,2*j),j=k;for(m=0,n=this._stateCount;n>m;++m)f[m]=null;this._stateTextureLast=null,this._stateBlendModeLast=b.Render.BLEND_NORMAL,this._stateCount=0,this._spriteCount=0},b.WebglBatch.prototype._saveState=function(a,b){return a===this._stateTextureLast&&b===this._stateBlendModeLast&&this._stateCount?void(this._states[this._stateCount-1]=6*this._spriteCount):(this._states[this._stateCount]=6*this._spriteCount,this._stateTextures[this._stateCount]=a,this._stateTextureLast=a,this._stateBlendModes[this._stateCount]=b,this._stateBlendModeLast=b,void++this._stateCount)},b.WebglRender=function(a){this.type=b.Render.RENDER_WEBGL,this.root=null,this._setupSettings(a),this._setupProps(),this._setupRestore(),this._setupBounds(),this._createContext(),this._setupViewport(a),this._setupManagers(),this._resetState(),this._registerRender(),this._setupFrame()},b.WebglRender.prototype.resize=function(a,b){return this.width=a,this.height=b,this._canvas.width=a,this._canvas.height=b,this._projection.x=a/2,this._projection.y=-b/2,this._context.viewport(0,0,a,b),this._updateBounds(),this._updateShaders(),this},b.WebglRender.prototype.destroy=function(){delete b.Render.renders[this.id],this._batch.destroy(),this._batch=null,this._graphics.destroy(),this._graphics=null;for(var a in this._shaders)this._shaders[a].destroy();this._currentShader=null,this._currentMatrix=null,this._targetMatrix=null,this._shaders={},this._canvas.removeEventListener("webglcontextlost",this._contextLostHandle),this._canvas.removeEventListener("webglcontextrestored",this._contextRestoredHandle),this._contextLostHandle=null,this._contextRestoredHandle=null,this._context=null,this._target=null,this._canvas=null,this._projection=null,this._bounds=null,this._boundsScroll=null,this.root=null},b.WebglRender.prototype.bounds=function(){return this._boundsScroll.equal(b.Screen.scrollX,b.Screen.scrollY)||this._updateBounds(),this._bounds},b.WebglRender.prototype.target=function(a){return this._graphics.flush(),this._batch.flush(),a?(this._target=a,this._context.bindFramebuffer(this._context.FRAMEBUFFER,b.WebglTexture.get(a).handle(this,!0)),this._projection.x=a.width/2,this._projection.y=-a.height/2,this._updateShaders(),this._context.viewport(0,0,a.width,a.height)):(this._target=null,this._context.bindFramebuffer(this._context.FRAMEBUFFER,null),this._projection.x=this.width/2,this._projection.y=-this.height/2,this._updateShaders(),this._context.viewport(0,0,this.width,this.height)),this},b.WebglRender.prototype.transform=function(a){return a?(this._currentMatrix.set(a),this._currentMatrix):this._currentMatrix},b.WebglRender.prototype.blendMode=function(a){return a&&b.WebglRender._blendModes[a]?this._currentBlendMode=a:this._currentBlendMode},b.WebglRender.prototype.fillColor=function(a){return this._graphics.fillColor(a)},b.WebglRender.prototype.lineColor=function(a){return this._graphics.lineColor(a)},b.WebglRender.prototype.lineWidth=function(a){return this._graphics.lineWidth(a)},b.WebglRender.prototype.clear=function(a){this._graphics.flush(),this._batch.flush();var b=this._context;if(this._transparent){if(!a&&this.clearColor===!1)return;return b.clearColor(0,0,0,0),b.clear(b.COLOR_BUFFER_BIT),this}return a||(a=this.clearColor),a&&a.a?(b.clearColor(a.r,a.g,a.b,a.a),b.clear(b.COLOR_BUFFER_BIT),this):this},b.WebglRender.prototype.drawTexture=function(a,c,d,e){return a.ready?(this._graphics.flush(),this._batch.render(b.WebglTexture.get(a),c?c.x:0,c?c.y:0,c?c.width:a.width,c?c.height:a.height,d||1,e||b.Color.WHITE),this):this},b.WebglRender.prototype.drawLine=function(a,b,c,d){return this._batch.flush(),this._graphics.drawLine(a,b,c,d),this},b.WebglRender.prototype.drawRect=function(a,b,c,d){return this._batch.flush(),this._graphics.drawRect(a,b,c,d),this},b.WebglRender.prototype.drawCircle=function(a,b,c){return this._batch.flush(),this._graphics.drawCircle(a,b,c),this},b.WebglRender.prototype.drawEllipse=function(a,b,c,d){return this._batch.flush(),this._graphics.drawEllipse(a,b,c,d),this},b.WebglRender.prototype.drawArc=function(a,b,c,d,e,f){return this._batch.flush(),this._graphics.drawArc(a,b,c,d,e,f),this},b.WebglRender.prototype.drawPoly=function(a){return this._batch.flush(),this._graphics.drawPoly(a),this},b.WebglRender.prototype.drawShape=function(a){return this._batch.flush(),this._graphics.drawShape(a),this},b.WebglRender.prototype.startShape=function(){return this._graphics.startShape()},b.WebglRender.prototype.endShape=function(){return this._graphics.endShape()},b.WebglRender.prototype.getPixels=function(a){return this._target===a&&(this._batch.flush(),this._graphics.flush()),b.WebglTexture.get(a).getPixels(this)},b.WebglRender.prototype.setPixels=function(a,c){return b.WebglTexture.get(a).setPixels(c,this),this},b.WebglRender.prototype._getShader=function(a){if(!a)return this._currentShader;if(this._shaders[a.name])return this._shaders[a.name];var c=new b.WebglShader(this,a);return c.uProjection.values(this._projection.x,this._projection.y),this._shaders[a.name]=c,c},b.WebglRender.prototype._setShader=function(a){this._currentShader!==a&&(a.use(),this._currentShader=a)},b.WebglRender.prototype._updateShaders=function(){var a=this._shaders;for(var b in a){var c=a[b];c.uProjection&&(c.use(),c.uProjection.values(this._projection.x,this._projection.y))}this._currentShader&&this._currentShader.use()},b.WebglRender.prototype._loseContext=function(a){var c=this._context.getExtension("WEBGL_lose_context");return c?(b.log("Killing context in render with id [",this.id,"]"),c.loseContext(),setTimeout(function(){b.log("Restoring context in render with id [",this.id,"]"),c.restoreContext()}.bind(this),1e3|a),!0):(b.log("Lose context extension not supported"),!1)},b.WebglRender.prototype._setupSettings=function(a){var c=b.Render.DEFAULT_SETTINGS;return a.canvas?(this.clearColor=a.clearColor?a.clearColor.clone():c.clearColor.clone(),this.fps=0===a.fps?0:a.fps||c.fps,this.ups=0===a.ups?0:a.ups||c.ups,this._canvas=a.canvas,this._transparent=void 0!==a.transparent?!!a.transparent:c.transparent,this._autoClear=void 0!==a.autoClear?!!a.autoClear:c.autoClear,this._antialias=void 0!==a.antialias?!!a.antialias:c.antialias,b.Browser.ie&&(this._canvas.style["-ms-content-zooming"]="none",this._canvas.style["-ms-touch-action"]="none"),void(this._contextMenu||(this._canvas.oncontextmenu=function(){return!1}))):b.error("Can't create render, settings.canvas is not defined")},b.WebglRender.prototype._setupProps=function(){this._projection=new b.Point,this._target=null,this._currentMatrix=new b.Matrix,this._currentShader=null,this._targetMatrix=new b.Matrix,this._shaders={}},b.WebglRender.prototype._setupRestore=function(){this._contextLost=!1,this._restoreObjects=[],this._contextLostHandle=this._onContextLost.bind(this),this._contextRestoredHandle=this._onContextRestored.bind(this),this._canvas.addEventListener("webglcontextlost",this._contextLostHandle,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestoredHandle,!1)},b.WebglRender.prototype._addRestore=function(a){return a._restore?-1!==this._restoreObjects.indexOf(a)?!1:(this._restoreObjects.push(a),!0):b.error("Object has no _restore method for context lost handling")},b.WebglRender.prototype._removeRestore=function(a){var b=this._restoreObjects.indexOf(a);return-1!==b?(this._restoreObjects.splice(b,1),!0):!1},b.WebglRender.prototype._restore=function(){for(var a=0,b=this._restoreObjects.length;b>a;++a)this._restoreObjects[a]._restore(this)},b.WebglRender.prototype._onContextLost=function(a){a.preventDefault(),this._contextLost=!0},b.WebglRender.prototype._onContextRestored=function(){this._createContext()},b.WebglRender.prototype._setupBounds=function(){this._bounds=new b.Rect,this._boundsScroll=new b.Point},b.WebglRender.prototype._updateBounds=function(){var a=this._canvas.getBoundingClientRect();this._bounds.set(a.left,a.top,a.width,a.height),this._boundsScroll.set(b.Screen.scrollX,b.Screen.scrollY)},b.WebglRender.prototype._createContext=function(){var a={depth:!1,alpha:this._transparent,premultipliedAlpha:this._transparent,antialias:this._antialias,stencil:!1,preserveDrawingBuffer:!this.autoClear},c="This browser does not support webGL. Try using the canvas render";try{this._context=this._canvas.getContext("experimental-webgl",a)||this._canvas.getContext("webgl",a)}catch(d){return b.error(c)}if(!this._context)return b.error(c);var e=this._context;e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.colorMask(!0,!0,!0,!0),b.WebglRender._initBlendModes(e),this._currentShader=null,this._currentBlendMode=b.Render.BLEND_NORMAL,this._applyBlendMode(this._currentBlendMode),this._restore(),this._contextLost=!1},b.WebglRender.prototype._setupViewport=function(a){var c=a.width||b.Screen.availWidth,d=a.height||b.Screen.availHeight;this.resize(c,d)},b.WebglRender.prototype._setupManagers=function(){this._batch=new b.WebglBatch(this),this._graphics=new b.WebglGraphics(this)},b.WebglRender.prototype._registerRender=function(){this.id=b.Render._uid++,b.Render.renders[this.id]=this},b.WebglRender.prototype._setupFrame=function(){this._lastUpdateTime=0,this._lastRenderTime=0,this._frameBind=this._onFrame.bind(this),this._onFrame(0)},b.WebglRender.prototype._onFrame=function(a){if(this._frameBind){requestAnimationFrame(this._frameBind,this._canvas);var b=this.root,c=a-this._lastUpdateTime,d=a-this._lastRenderTime;this.ups&&b&&b.update&&(60===this.ups||c>=1/this.ups*900)&&(b.update(this,c),this._lastUpdateTime=a),this.fps&&b&&b.render&&(60===this.fps||d>=1/this.fps*900)&&(this._resetState(),b.render(this,d),this._graphics.flush(),this._batch.flush(),this._lastRenderTime=a)}},b.WebglRender.prototype._resetState=function(){this.blendMode(b.Render.BLEND_NORMAL),this.transform(b.Matrix.IDENTITY);var a=b.Render.DEFAULT_GRAPHICS;this.fillColor(a.fillColor),this.lineColor(a.lineColor),this.lineWidth(a.lineWidth),this._autoClear&&this.clear()},b.WebglRender.prototype._applyBlendMode=function(a){if(this._applyedBlendMode!==a&&b.WebglRender._blendModes){this._applyedBlendMode=a;var c=b.WebglRender._blendModes[a];c&&this._context.blendFunc(c[0],c[1])}},b.WebglRender._initBlendModes=function(a){if(void 0===b.WebglRender._blendModes){var c={};c[b.Render.BLEND_NONE]=[a.ONE,a.ZERO],c[b.Render.BLEND_NORMAL]=[a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA],c[b.Render.BLEND_ADD]=[a.ONE,a.ONE],c[b.Render.BLEND_MULTIPLY]=[a.DST_COLOR,a.ONE_MINUS_SRC_ALPHA],c[b.Render.BLEND_SCREEN]=[a.ONE,a.ONE_MINUS_SRC_COLOR],b.WebglRender._blendModes=c}},b.MouseEvent=function(){this._type=0,this._button=0,this._position=new b.Point(0,0),this._wheel=new b.Point(0,0)},Object.defineProperty(b.MouseEvent.prototype,"type",{get:function(){return this._type}}),Object.defineProperty(b.MouseEvent.prototype,"button",{get:function(){return this._button}}),Object.defineProperty(b.MouseEvent.prototype,"x",{get:function(){return this._position.x}}),Object.defineProperty(b.MouseEvent.prototype,"y",{get:function(){return this._position.y}}),Object.defineProperty(b.MouseEvent.prototype,"wheelX",{get:function(){return this._wheel.x}}),Object.defineProperty(b.MouseEvent.prototype,"wheelY",{get:function(){return this._wheel.y}}),b.MouseEvent.prototype._set=function(a,b,c,d,e,f){this._type=a,this._button=b,this._position.set(c,d),this._wheel.set(e,f)},b.MouseEvent.prototype._reset=function(){this._type=0,this._button=0,this._position.set(0,0),this._wheel.set(0,0)},b.Mouse=function(){this._button=0,this._position=new b.Point(0,0),this._wheel=new b.Point(0,0),this._event=new b.MouseEvent,this._initialize()},b.Mouse.prototype.any=function(a,c){return!(a.type!==b.Mouse.UP&&a.type!==b.Mouse.DOWN&&a.type!==b.Mouse.MOVE||c&&a.button!==c)},b.Mouse.prototype.up=function(a,c){return a.type===b.Mouse.UP&&(!c||a.button===c)},b.Mouse.prototype.down=function(a,c){return a.type===b.Mouse.DOWN&&(!c||a.button===c)},b.Mouse.prototype.move=function(a,c){return a.type===b.Mouse.MOVE&&(!c||a.button===c)},b.Mouse.prototype.wheel=function(a){return a.type===b.Mouse.WHEEL},Object.defineProperty(b.Mouse.prototype,"button",{get:function(){return this._button}}),Object.defineProperty(b.Mouse.prototype,"x",{get:function(){return this._position.x}}),Object.defineProperty(b.Mouse.prototype,"y",{get:function(){return this._position.y}}),Object.defineProperty(b.Mouse.prototype,"wheelX",{get:function(){return this._wheel.x}}),Object.defineProperty(b.Mouse.prototype,"wheelY",{get:function(){return this._wheel.y}}),b.Mouse.prototype._initialize=function(){b.Browser.any&&(window.addEventListener("mouseover",this._onOver.bind(this),!0),window.addEventListener("mouseout",this._onOut.bind(this),!0),window.addEventListener("mouseup",this._onUp.bind(this),!0),window.addEventListener("mousedown",this._onDown.bind(this),!0),window.addEventListener("mousemove",this._onMove.bind(this),!0),"onwheel"in window||b.Browser.ie&&"WheelEvent"in window?window.addEventListener("wheel",this._onWheel.bind(this),!0):"onmousewheel"in window?window.addEventListener("mousewheel",this._onWheel.bind(this),!0):b.Browser.firefox&&"MouseScrollEvent"in window&&window.addEventListener("MozMousePixelScroll",this._onWheel.bind(this),!0))},b.Mouse.prototype._callInput=function(a){var c=b.Render.renders,d=this._event,e=!1;for(var f in c){var g=c[f],h=g.bounds(),i=this._position;g.root&&h.contains(i)&&(d._set(a,this._button,i.x-h.x,i.y-h.y,this._wheel.x,this._wheel.y),g.root.input(d,g),e=!0)}return d._reset(),e},b.Mouse.prototype._onOver=function(a){this._position.set(a.clientX,a.clientY)},b.Mouse.prototype._onOut=function(){this._position.set(0,0)},b.Mouse.prototype._onDown=function(a){this._position.set(a.clientX,a.clientY),this._button=Math.min(a.button+1,3),this._callInput(b.Mouse.DOWN)&&a.preventDefault()},b.Mouse.prototype._onUp=function(a){this._position.set(a.clientX,a.clientY),this._button=Math.min(a.button+1,3),this._callInput(b.Mouse.UP)&&a.preventDefault(),this._button=b.Mouse.NONE},b.Mouse.prototype._onMove=function(a){this._position.set(a.clientX,a.clientY),this._callInput(b.Mouse.MOVE)&&a.preventDefault()},b.Mouse.prototype._onWheel=function(a){void 0!==a.deltaX?this._wheel.set(a.deltaX,a.deltaY):void 0!==a.wheelDeltaX?this._wheel.set(a.wheelDeltaX,a.wheelDeltaY):this._wheel.set(0,a.detail),this._callInput(b.Mouse.WHEEL)&&a.preventDefault()},b.Mouse=new b.Mouse,b.Mouse.NONE=0,b.Mouse.LEFT=1,b.Mouse.MIDDLE=2,b.Mouse.RIGHT=3,b.Mouse.UP=100,b.Mouse.DOWN=101,b.Mouse.MOVE=102,b.Mouse.WHEEL=103,b.KeyboardEvent=function(){this._type=0,this._key=0,this._char=0,this._alt=!1,this._control=!1,this._shift=!1,this._command=!1},Object.defineProperty(b.KeyboardEvent.prototype,"type",{get:function(){return this._type}}),Object.defineProperty(b.KeyboardEvent.prototype,"key",{get:function(){return this._key}}),Object.defineProperty(b.KeyboardEvent.prototype,"char",{get:function(){return this._char}}),Object.defineProperty(b.KeyboardEvent.prototype,"alt",{get:function(){return this._alt}}),Object.defineProperty(b.KeyboardEvent.prototype,"control",{get:function(){return this._control}}),Object.defineProperty(b.KeyboardEvent.prototype,"shift",{get:function(){return this._shift}}),Object.defineProperty(b.KeyboardEvent.prototype,"command",{get:function(){return this._command}}),b.KeyboardEvent.prototype._set=function(a,b,c,d,e,f,g){this._type=a,this._key=b,this._char=c,this._alt=d,this._control=e,this._shift=f,this._command=g},b.KeyboardEvent.prototype._reset=function(){this._type=0,this._key=0,this._char=0,this._alt=!1,this._control=!1,this._shift=!1,this._command=!1},b.Keyboard=function(){this._keys={},this._control=!1,this._alt=!1,this._shift=!1,this._command=!1,this._controls={},this._lastKey=0,this._lastChar=0,this._event=new b.KeyboardEvent,this._initialize()},b.Keyboard.prototype.any=function(a){return a.type===b.Keyboard.UP||a.type===b.Keyboard.DOWN},b.Keyboard.prototype.up=function(a){return a.type===b.Keyboard.UP},b.Keyboard.prototype.down=function(a){return a.type===b.Keyboard.DOWN},b.Keyboard.prototype.key=function(a){return this._keys[a]},Object.defineProperty(b.Keyboard.prototype,"control",{get:function(){return this._control}}),Object.defineProperty(b.Keyboard.prototype,"alt",{get:function(){return this._alt}}),Object.defineProperty(b.Keyboard.prototype,"shift",{get:function(){return this._shift}}),Object.defineProperty(b.Keyboard.prototype,"command",{get:function(){return this._command}}),b.Keyboard.prototype._initialize=function(){for(var a=[33,34,35,36,37,38,39,40,45,46,47,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,8,9,12,16,17,18,20,27,91,93,144],c=0,d=a.length;d>c;++c)this._controls[a[c]]=!0;b.Browser.any&&(window.addEventListener("keydown",this._onDown.bind(this),!0),window.addEventListener("keyup",this._onUp.bind(this),!0),window.addEventListener("keypress",this._onPress.bind(this),!0))},b.Keyboard.prototype._callInput=function(a,c,d){var e=b.Render.renders,f=this._event;f._set(a,c,d,this._alt,this._control,this._shift,this._command);for(var g in e){var h=e[g];h.root&&h.root.input(f,h)}f._reset()},b.Keyboard.prototype._onDown=function(a){var c=a.which||a.keyCode;this._keys[c]=!0,this._controls[c]?(this._lastChar=0,this._callInput(b.Keyboard.DOWN,c,this._lastChar),b.log("Press key:",c,"char:",this._lastChar)):this._lastKey=c},b.Keyboard.prototype._onPress=function(a){this._lastChar=a.charCode,this._callInput(b.Keyboard.DOWN,this._lastKey,this._lastChar),b.log("Press key:",this._lastKey,"char:",this._lastChar)},b.Keyboard.prototype._onUp=function(a){var c=a.which||a.keyCode;this._keys[c]=!1,this._callInput(b.Keyboard.UP,c,this._lastChar),b.log("Up key:",c,"char:",this._lastChar)},b.Keyboard=new b.Keyboard,b.Keyboard.UP=200,b.Keyboard.DOWN=201,b.Keyboard.A="A".charCodeAt(0),b.Keyboard.B="B".charCodeAt(0),b.Keyboard.C="C".charCodeAt(0),b.Keyboard.D="D".charCodeAt(0),b.Keyboard.E="E".charCodeAt(0),b.Keyboard.F="F".charCodeAt(0),b.Keyboard.G="G".charCodeAt(0),b.Keyboard.H="H".charCodeAt(0),b.Keyboard.I="I".charCodeAt(0),b.Keyboard.J="J".charCodeAt(0),b.Keyboard.K="K".charCodeAt(0),b.Keyboard.L="L".charCodeAt(0),b.Keyboard.M="M".charCodeAt(0),b.Keyboard.N="N".charCodeAt(0),b.Keyboard.O="O".charCodeAt(0),b.Keyboard.P="P".charCodeAt(0),b.Keyboard.Q="Q".charCodeAt(0),b.Keyboard.R="R".charCodeAt(0),b.Keyboard.S="S".charCodeAt(0),b.Keyboard.T="T".charCodeAt(0),b.Keyboard.U="U".charCodeAt(0),b.Keyboard.V="V".charCodeAt(0),b.Keyboard.W="W".charCodeAt(0),b.Keyboard.X="X".charCodeAt(0),b.Keyboard.Y="Y".charCodeAt(0),b.Keyboard.Z="Z".charCodeAt(0),b.Keyboard.ZERO="0".charCodeAt(0),b.Keyboard.ONE="1".charCodeAt(0),b.Keyboard.TWO="2".charCodeAt(0),b.Keyboard.THREE="3".charCodeAt(0),b.Keyboard.FOUR="4".charCodeAt(0),b.Keyboard.FIVE="5".charCodeAt(0),b.Keyboard.SIX="6".charCodeAt(0),b.Keyboard.SEVEN="7".charCodeAt(0),b.Keyboard.EIGHT="8".charCodeAt(0),b.Keyboard.NINE="9".charCodeAt(0),b.Keyboard.NUMPAD_0=96,b.Keyboard.NUMPAD_1=97,b.Keyboard.NUMPAD_2=98,b.Keyboard.NUMPAD_3=99,b.Keyboard.NUMPAD_4=100,b.Keyboard.NUMPAD_5=101,b.Keyboard.NUMPAD_6=102,b.Keyboard.NUMPAD_7=103,b.Keyboard.NUMPAD_8=104,b.Keyboard.NUMPAD_9=105,b.Keyboard.NUMPAD_MULTIPLY=106,b.Keyboard.NUMPAD_ADD=107,b.Keyboard.NUMPAD_ENTER=108,b.Keyboard.NUMPAD_SUBTRACT=109,b.Keyboard.NUMPAD_DECIMAL=110,b.Keyboard.NUMPAD_DIVIDE=111,b.Keyboard.F1=112,b.Keyboard.F2=113,b.Keyboard.F3=114,b.Keyboard.F4=115,b.Keyboard.F5=116,b.Keyboard.F6=117,b.Keyboard.F7=118,b.Keyboard.F8=119,b.Keyboard.F9=120,b.Keyboard.F10=121,b.Keyboard.F11=122,b.Keyboard.F12=123,b.Keyboard.F13=124,b.Keyboard.F14=125,b.Keyboard.F15=126,b.Keyboard.COLON=186,b.Keyboard.EQUALS=187,b.Keyboard.UNDERSCORE=189,b.Keyboard.QUESTION_MARK=191,b.Keyboard.TILDE=192,b.Keyboard.OPEN_BRACKET=219,b.Keyboard.BACKWARD_SLASH=220,b.Keyboard.CLOSED_BRACKET=221,b.Keyboard.QUOTES=222,b.Keyboard.BACKSPACE=8,b.Keyboard.TAB=9,b.Keyboard.CLEAR=12,b.Keyboard.ENTER=13,b.Keyboard.SHIFT=16,b.Keyboard.CONTROL=17,b.Keyboard.ALT=18,b.Keyboard.CAPS_LOCK=20,b.Keyboard.ESC=27,b.Keyboard.SPACEBAR=32,b.Keyboard.PAGE_UP=33,b.Keyboard.PAGE_DOWN=34,b.Keyboard.END=35,b.Keyboard.HOME=36,b.Keyboard.ARROW_LEFT=37,b.Keyboard.ARROW_UP=38,b.Keyboard.ARROW_RIGHT=39,b.Keyboard.ARROW_DOWN=40,b.Keyboard.INSERT=45,b.Keyboard.DELETE=46,b.Keyboard.HELP=47,b.Keyboard.NUM_LOCK=144,b.Keyboard.PLUS=43,b.Keyboard.MINUS=45,b.TouchPoint=function(){this._id=0,this._position=new b.Point(0,0)},Object.defineProperty(b.TouchPoint.prototype,"id",{get:function(){return this._id}}),Object.defineProperty(b.TouchPoint.prototype,"x",{get:function(){return this._position.x}}),Object.defineProperty(b.TouchPoint.prototype,"y",{get:function(){return this._position.y}}),b.TouchPoint.prototype._set=function(a,b,c){this._id=a,this._position.set(b,c)},b.TouchPoint.prototype._reset=function(){this._id=0,this._position.set(0,0)},b.TouchList=function(){this._points=[],this._pool=[]},Object.defineProperty(b.TouchList.prototype,"length",{get:function(){return this._points.length}}),b.TouchList.prototype.item=function(a){return void 0===a&&(a=0),a>=0&&a<this._points.length?this._points[a]:void 0},b.TouchList.prototype._resize=function(a){var c,d=this._points,e=this._pool;if(d.length!==a)if(a<d.length){c=0===a?d.length:d.length-a;for(var f=d.splice(0,c);c--;)e.push(f[c])}else for(c=a-d.length;c--;)d.push(e.length?e.pop():new b.TouchPoint)},b.TouchEvent=function(){this._type=0,this._points=new b.TouchList},Object.defineProperty(b.TouchEvent.prototype,"type",{get:function(){return this._type}}),Object.defineProperty(b.TouchEvent.prototype,"points",{get:function(){return this._points}}),b.TouchEvent.prototype._set=function(a,b,c){this._type=a;var d,e=this._points,f=0;e._resize(c.length);for(var g=0,h=c.length;h>g;++g)d=c.item(g),b.contains(d)?e.item(g-f)._set(d.id,d.x-b.x,d.y-b.y):f++;f&&e._resize(e.length-f)},b.TouchEvent.prototype._reset=function(){this._type=0,this._points._resize(0)},b.Touch=function(){this._points=new b.TouchList,this._event=new b.TouchEvent,this._initialize()},b.Touch.prototype.any=function(a){return a.type===b.Touch.UP||a.type===b.Touch.DOWN||a.type===b.Touch.MOVE},b.Touch.prototype.up=function(a){return a.type===b.Touch.UP},b.Touch.prototype.down=function(a){return a.type===b.Touch.DOWN},b.Touch.prototype.move=function(a){return a.type===b.Touch.MOVE},b.Touch.prototype._initialize=function(){b.Browser.any&&("ontouchstart"in document.documentElement?(window.addEventListener("touchstart",this._onTouchStart.bind(this),!0),window.addEventListener("touchend",this._onTouchEnd.bind(this),!0),window.addEventListener("touchmove",this._onTouchMove.bind(this),!0),window.addEventListener("touchleave",this._onTouchLeave.bind(this),!0),window.addEventListener("touchcancel",this._onTouchCancel.bind(this),!0)):window.PointerEvent?(window.addEventListener("pointerdown",this._onPointerDown.bind(this),!0),window.addEventListener("pointermove",this._onPointerMove.bind(this),!0),window.addEventListener("pointerup",this._onPointerUp.bind(this),!0)):window.MSPointerEvent&&(window.addEventListener("MSPointerDown",this._onPointerDown.bind(this),!0),window.addEventListener("MSPointerMove",this._onPointerMove.bind(this),!0),window.addEventListener("MSPointerUp",this._onPointerUp.bind(this),!0)))},b.Touch.prototype._updateTouch=function(a){var b,c=a.touches,d=this._points;d._resize(c.length);for(var e=0,f=c.length;f>e;++e)b=c.item(e),d.item(e)._set(b.identifier,b.clientX,b.clientY)},b.Touch.prototype._callInput=function(a){var c=b.Render.renders,d=this._event,e=!1;for(var f in c){var g=c[f];g.root&&(d._set(a,g.bounds(),this._points),d.points.length&&(g.root.input(d,g),e=!0))}return d._reset(),e},b.Touch.prototype._onPointerDown=function(a){if(void 0===a.pointerType||"touch"===a.pointerType){var c=this._points;c._resize(c.length+1),c.item(c.length-1)._set(a.pointerId,a.clientX,a.clientY),this._callInput(b.Touch.DOWN)&&a.preventDefault()}},b.Touch.prototype._onPointerUp=function(a){if(void 0===a.pointerType||"touch"===a.pointerType){for(var c=this._points,d=0,e=c.length-1;e>d;++d){var f=c.item(d);c.item(d)._set(f.id,f.x,f.y)}c._resize(c.length-1),this._callInput(b.Touch.UP)&&a.preventDefault()}},b.Touch.prototype._onPointerMove=function(a){if(void 0===a.pointerType||"touch"===a.pointerType){for(var c=this._points,d=0,e=c.length;e>d;++d){var f=c.item(d);if(f.id===a.pointerId){f._set(f.id,a.clientX,a.clientY);break}}this._callInput(b.Touch.MOVE)&&a.preventDefault()}},b.Touch.prototype._onTouchStart=function(a){this._updateTouch(a),this._callInput(b.Touch.DOWN)&&a.preventDefault()},b.Touch.prototype._onTouchEnd=function(a){this._updateTouch(a),this._callInput(b.Touch.UP)&&a.preventDefault()},b.Touch.prototype._onTouchMove=function(a){this._updateTouch(a),this._callInput(b.Touch.MOVE)&&a.preventDefault()},b.Touch.prototype._onTouchLeave=function(a){this._updateTouch(a),this._callInput(b.Touch.UP)&&a.preventDefault()},b.Touch.prototype._onTouchCancel=function(a){this._updateTouch(a),this._callInput(b.Touch.UP)&&a.preventDefault()},b.Touch=new b.Touch,b.Touch.UP=300,b.Touch.DOWN=301,b.Touch.MOVE=302,b.Object=function(){this._parent=null},Object.defineProperty(b.Object.prototype,"parent",{get:function(){return this._parent},set:function(a){this._parent!==a&&(this.removeSelf(),a.addChild(this))}}),Object.defineProperty(b.Object.prototype,"length",{get:function(){return this._children?this._children.length:0}}),b.Object.prototype.addChild=function(a,c){this._children||(this._children=[]);var d=this._children;return c|=d.length,0>c||c>d.length?b.error("The index [",c,"] out of bounds"):(c===d.length?d.push(a):d.splice(c,0,a),a._parent=this,a)},b.Object.prototype.removeChild=function(a){if(!this._children)return!1;var c=this._children,d=a||0;if(a instanceof b.Object){if(d=c.indexOf(a),-1===d)return!1}else{if(0>d||d>=c.length)return!1;a=c[d]}return c.splice(d,1),a._parent=null,!0},b.Object.prototype.removeAll=function(){if(!this._children)return!1;for(var a=this._children,b=0,c=a.length;c>b;++b)a[b]._parent=null;return a.length=0,!0},b.Object.prototype.removeSelf=function(){return this._parent?(this._parent.remove(this),!0):!0},b.Object.prototype.getChild=function(a){return this._children?(a=a||0,0>a||a>=this._children.length?void 0:this._children[a]):void 0},b.Object.prototype.addComponent=function(a){var c=a.id;if(!c)return b.error("Component have no property name");if("_"===c.charCodeAt(0))return b.error('Component should not have name with first character "_" [',c,"]");if(this[c])return b.error("Component with name [",c,"] already exist");var d=this[c]=new a(this);return a.prototype.update&&(this._updates?this._updates.push(d):this._updates=[d]),a.prototype.render&&(this._renders?this._renders.push(d):this._renders=[d]),a.prototype.input&&(this._inputs?this._inputs.push(d):this._inputs=[d]),!0},b.Object.prototype.removeComponent=function(a){var b=this[a.id];if(!b)return!1;b.object=null;var c;return this._updates&&(c=this._updates.indexOf(b),-1!==c&&this._updates.splice(c,1)),this._renders&&(c=this._renders.indexOf(b),-1!==c&&this._renders.splice(c,1)),this._inputs&&(c=this._inputs.indexOf(b),-1!==c&&this._inputs.splice(c,1)),delete this[a.id],!0
},b.Object.prototype.destroy=function(){this.removeAll(),this.removeSelf();var a,b;if(b=this._updates){for(a=b.length;a--;)this[b[a]]=null;b.length=0}if(b=this._renders){for(a=b.length;a--;)this[b[a]]=null;b.length=0}if(b=this._inputs){for(a=b.length;a--;)this[b[a]]=null;b.length=0}},b.Object.prototype.update=function(a,b){var c,d,e;if(this._updates)for(e=this._updates,c=0,d=e.length;d>c;++c)e[c].update(a,b);if(e=this._children,e&&e.length)for(c=0,d=e.length;d>c;++c)e[c].update(a,b)},b.Object.prototype.render=function(a,b){var c,d,e;if(this._renders)for(e=this._renders,c=0,d=e.length;d>c;++c)e[c].render(a,b);if(e=this._children,e&&e.length)for(c=0,d=e.length;d>c;++c)e[c].render(a,b)},b.Object.prototype.input=function(a,b){var c,d,e;if(this._inputs)for(e=this._inputs,c=0,d=e.length;d>c;++c)e[c].input(a,b);if(e=this._children,e&&e.length)for(c=0,d=e.length;d>c;++c)e[c].input(a,b)},b.Object.create=function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments));for(var c=new b.Object,d=0,e=a.length;e>d;++d)c.addComponent(a[d]);return c},b.Sprite=function(a){this.object=a,this.texture=null,this.frame=new b.Rect,this.alpha=1,this.tint=b.Color.WHITE.clone(),this.blend=b.Render.BLEND_NORMAL},b.Sprite.id="sprite",b.Sprite.prototype.render=function(a){this.object&&this.object.transform&&this.texture&&this.texture.ready&&this.alpha&&(this.frame.width||this.frame.height||(this.frame.width=this.texture.width,this.frame.height=this.texture.height),a.transform(this.object.transform.matrix),a.blendMode(this.blend),a.drawTexture(this.texture,this.frame,this.alpha,this.tint))},b.Transform=function(a){this.object=a,this.position=new b.Point(0,0),this.scale=new b.Point(1,1),this.pivot=new b.Point(0,0),this.rotation=0,this.matrix=new b.Matrix},b.Transform.id="transform",b.Transform.prototype.update=function(){this.matrix.transform(this.position,this.scale,this.rotation,this.pivot,this.object&&this.object.parent&&this.object.parent.transform?this.object.parent.transform.matrix:b.Matrix.IDENTITY)},b.Transform.prototype.setPosition=function(a,b){this.position.set(a,b)},b.Transform.prototype.setScale=function(a,b){this.scale.set(a,b)},b.Transform.prototype.setPivot=function(a,b){this.pivot.set(a,b)},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.uno=b):"undefined"!=typeof define&&define.amd?define(b):a.uno=b}.call(this);